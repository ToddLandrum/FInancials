*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="gldept.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 200
	InitialSelectedAlias = "gldept"
	Left = 40
	Name = "Dataenvironment"
	Top = 235
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "gldept", ;
		BufferModeOverride = 1, ;
		CursorSource = "gldept", ;
		Database = ..\data\appdata.dbc, ;
		Height = 90, ;
		Name = "Cursor1", ;
		Order = "cdeptno", ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "gldept1", ;
		CursorSource = "gldept", ;
		Database = ..\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Order = "cdeptno", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formenterdepartments AS frmdatamanagerformcustom OF "..\.\custom\cforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="txtDeptno" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblDeptno" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtDesc" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblDesc" UniqueID="" Timestamp="" />

	Caption = "Department Information"
	clistexpression = gldept.cdeptno
	DoCreate = .T.
	Height = 90
	HelpContextID = 358
	lconfirmsave = .T.
	Name = "FormEnterdepartments"
	Width = 400
	cmdatamanager.Name = "cmdatamanager"
	cmlookupmanager.Name = "cmlookupmanager"

	ADD OBJECT 'lblDeptno' AS lblfieldlabelcustom WITH ;
		Alignment = 0, ;
		Caption = "Department Code", ;
		Height = 16, ;
		Left = 54, ;
		Name = "lblDeptno", ;
		Top = 17, ;
		Width = 85
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblDesc' AS lblfieldlabelcustom WITH ;
		Caption = "Department Description", ;
		Height = 16, ;
		Left = 25, ;
		Name = "lblDesc", ;
		Top = 53, ;
		Width = 114
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'txtDeptno' AS txttextboxcustom WITH ;
		ControlSource = "gldept.cdeptno", ;
		Format = "K!", ;
		Height = 20, ;
		Left = 153, ;
		lrequired = .T., ;
		MaxLength = 8, ;
		Name = "txtDeptno", ;
		SelectOnEntry = .T., ;
		Style = 0, ;
		Top = 15, ;
		Width = 67
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtDesc' AS txttextboxcustom WITH ;
		ControlSource = "gldept.cdeptdesc", ;
		Height = 20, ;
		Left = 153, ;
		lrequired = .T., ;
		MaxLength = 30, ;
		Name = "txtDesc", ;
		Top = 51, ;
		Width = 219
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="textbox" />
	
	PROCEDURE list
		LPARAMETERS cWorkarea
		*
		PRIV llOK
		LOCAL lcList, lnRecNo, lStatus
		* Default to the form's primary workarea
		IF EMPTY(m.cWorkarea)
		   m.cWorkarea = THIS.cWorkarea
		ENDIF
		
		IF THIS.FlushControlBuffer()
		   * If this or any child is changed, Validate it and children
		   IF THIS.BeforeNav(m.cWorkarea)
		      THIS.RefreshAll()  && In case BeforeNav() did a Revert()
		
		      llOK = .F.
		      lcList = 'cdeptno\Dept Number,cdeptdesc\Dept Description'
		
		      SELECT gldept
		      lnRecNo = RECNO()
		      COUNT FOR NOT DELETED() TO lnCount
		      IF lnCount = 0
		         RETURN
		      ENDIF
		
		      DO FORM ..\CUSTOM\picklist WITH 'Gldept', lcList, THISFORM.txtDeptno.VALUE, 2,.F.,.T.
		
		      IF NOT llOK
		         SELECT gldept
		         GOTO lnRecNo
		      ENDIF
		
		      THISFORM.RefreshAll()
		   ENDIF
		ENDIF
		
		
	ENDPROC

	PROCEDURE cmdatamanager.afternew
		LPARAMETERS cworkarea
		
		thisform.setnextcontrol(thisform.txtDeptNo)
		
		DODEFAULT(m.cworkarea)
	ENDPROC

	PROCEDURE txtDeptno.Valid
		lcDept = THIS.VALUE
		
		IF NOT EMPTY(lcDept) AND lcDept <> gldept.cdeptno
		   SELECT gldept1
		   SET ORDER TO cdeptno
		   IF SEEK(lcDept)
		      IF THISFORM.omessage.CONFIRM('There is already a department with this department code.  Would you like to view the existing record?')
		         THISFORM.cmdatamanager.revertall()
		         SELECT gldept
		         SET ORDER TO cdeptno
		         LOCATE FOR cDeptno = lcDept
		         THISFORM.REFRESH()
		      ELSE
		         THIS.VALUE = ''
		         RETURN 0
		      ENDIF
		   ENDIF
		   SELECT gldept
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

ENDDEFINE
