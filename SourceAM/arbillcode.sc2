*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="arbillcode.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Relation1" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 200
	Left = 40
	Name = "Dataenvironment"
	Top = 235
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "invhdr", ;
		CursorSource = "invhdr", ;
		Database = ..\data\appdata.dbc, ;
		Filter = "NOT DELETED()", ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "invdet", ;
		CursorSource = "invdet", ;
		Database = ..\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "items", ;
		CursorSource = "items", ;
		Database = ..\data\appdata.dbc, ;
		Filter = "NOT DELETED()", ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 19, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Relation1' AS relation WITH ;
		ChildAlias = "invdet", ;
		ChildOrder = "cbatch", ;
		Name = "Relation1", ;
		ParentAlias = "invhdr", ;
		RelationalExpr = "cbatch"
		*< END OBJECT: BaseClass="relation" />

ENDDEFINE

DEFINE CLASS formarbilljlist AS frmrptcriteria OF "appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Shape1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="opgRange" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblRange" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chklSubtotal" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtInvBeg" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtInvEnd" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chklDetail" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtBegDate" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtEndDate" UniqueID="" Timestamp="" />

	Caption = "Billing Code Summary"
	DataSession = 2
	DoCreate = .T.
	Height = 235
	HelpContextID = 581
	Name = "FormArbilljlist"
	Width = 403
	Swrptcriteriabuttons1.chkSendFile.Alignment = 0
	Swrptcriteriabuttons1.chkSendFile.Name = "chkSendFile"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.cmdPreview.Name = "cmdPreview"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 96
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.TabIndex = 11
	Swrptcriteriabuttons1.Top = 168
	Swrptcriteriabuttons1.ZOrderSet = 1

	ADD OBJECT 'chklDetail' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Include Detail", ;
		Left = 141, ;
		Name = "chklDetail", ;
		TabIndex = 10, ;
		Top = 131, ;
		Value = .F., ;
		Visible = .F.
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chklSubtotal' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Subtotal by Customer", ;
		Left = 141, ;
		Name = "chklSubtotal", ;
		TabIndex = 9, ;
		Top = 103, ;
		Value = .F.
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'Lbllabelcustom1' AS lbllabelcustom WITH ;
		Caption = "-", ;
		FontBold = .T., ;
		FontSize = 10, ;
		Height = 18, ;
		Left = 247, ;
		Name = "Lbllabelcustom1", ;
		TabIndex = 8, ;
		Top = 59, ;
		Width = 6, ;
		ZOrderSet = 9
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom2' AS lbllabelcustom WITH ;
		Caption = "-", ;
		FontBold = .T., ;
		Height = 16, ;
		Left = 247, ;
		Name = "Lbllabelcustom2", ;
		TabIndex = 5, ;
		Top = 33, ;
		Width = 6
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblRange' AS lblfieldlabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Report Range", ;
		Height = 16, ;
		Left = 24, ;
		Name = "lblRange", ;
		TabIndex = 1, ;
		Top = 6, ;
		Width = 68, ;
		ZOrderSet = 3
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'opgRange' AS opgoptiongroupcustom WITH ;
		AutoSize = .T., ;
		BorderStyle = 0, ;
		ButtonCount = 2, ;
		Height = 51, ;
		Left = 27, ;
		Name = "opgRange", ;
		TabIndex = 2, ;
		Top = 30, ;
		Width = 115, ;
		ZOrderSet = 2, ;
		Option1.AutoSize = .T., ;
		Option1.Caption = "Range of Dates", ;
		Option1.FontSize = 8, ;
		Option1.Height = 16, ;
		Option1.Left = 6, ;
		Option1.Name = "optDateRange", ;
		Option1.Top = 5, ;
		Option1.Width = 93, ;
		Option2.AutoSize = .T., ;
		Option2.Caption = "Range of Invoices", ;
		Option2.FontSize = 8, ;
		Option2.Height = 16, ;
		Option2.Left = 5, ;
		Option2.Name = "optInvRange", ;
		Option2.Top = 30, ;
		Option2.Width = 105
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'Shape1' AS shape WITH ;
		BackStyle = 0, ;
		BorderStyle = 1, ;
		Height = 60, ;
		Left = 24, ;
		Name = "Shape1", ;
		SpecialEffect = 0, ;
		Top = 25, ;
		Width = 348, ;
		ZOrderSet = 0
		*< END OBJECT: BaseClass="shape" />

	ADD OBJECT 'txtBegDate' AS dpk WITH ;
		ControlSource = "", ;
		Height = 20, ;
		Left = 144, ;
		Name = "txtBegDate", ;
		TabIndex = 6, ;
		Top = 31, ;
		Width = 75
		*< END OBJECT: ClassLib="..\.\custom\swdate.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtEndDate' AS dpk WITH ;
		ControlSource = "", ;
		Height = 20, ;
		Left = 260, ;
		Name = "txtEndDate", ;
		TabIndex = 7, ;
		Top = 31, ;
		Width = 75
		*< END OBJECT: ClassLib="..\.\custom\swdate.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtInvBeg' AS txttextboxcustom WITH ;
		Enabled = .F., ;
		Height = 20, ;
		InputMask = "XXXXXXXXXX", ;
		Left = 148, ;
		Name = "txtInvBeg", ;
		TabIndex = 6, ;
		Top = 58, ;
		Width = 81, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtInvEnd' AS txttextboxcustom WITH ;
		Enabled = .F., ;
		Height = 20, ;
		InputMask = "XXXXXXXXXX", ;
		Left = 260, ;
		Name = "txtInvEnd", ;
		TabIndex = 7, ;
		Top = 58, ;
		Width = 81, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\.\custom\ccontrol.vcx" BaseClass="textbox" />
	
	PROCEDURE builddata
		*
		*  Builds the data needed for the report
		*
		PARA tnRange, txParm1, txParm2
		
		LOCAL llDetail, llSubtotal
		llDetail = THISFORM.chklDetail.VALUE
		llSubtotal = THISFORM.chklSubtotal.VALUE
		
		WAIT WIND NOWAIT 'Processing Request...Please Wait'
		
		THISFORM.cSortOrder = 'Item ID'
		THISFORM.ctitle1    = ' '
		THISFORM.ctitle2    = ' '
		thisform.cReportName = 'arbillsum.frx'
		
		DO CASE
		   CASE NOT llDetail AND NOT llSubtotal &&  Not subtotaling or including detail
		
		      IF THISFORM.opgRange.VALUE = 1  &&  Date Range
		         THISFORM.cSelectCriteria = 'For Date Range:  ' + DTOC(THISFORM.txtBegDate.VALUE) + ' - ' + DTOC(THISFORM.txtEndDate.VALUE)
		         SELECT invdet.cItemId, ;
		            invdet.cItemDesc, ;
		            SUM(invdet.nQuantity) AS units, ;
		            SUM(invdet.nExtension) AS Amount, ;
		            AVG(invdet.nPrice) AS nPrice  ;
		            FROM invdet, invhdr ;
		            WHERE BETWEEN(invhdr.dInvDate, ;
		            THISFORM.txtBegDate.VALUE, ;
		            THISFORM.txtEndDate.VALUE) ;
		            AND invdet.cBatch = invhdr.cBatch ;
		            AND invdet.cItemId IN (SELECT cItemId FROM items) ;
		            INTO CURSOR billtemp ;
		            ORDER BY invdet.cItemId ;
		            GROUP BY invdet.cItemId
		
		      ELSE THISFORM.opgRange.VALUE = 2  &&  Range of invoices
		         THISFORM.cSelectCriteria = 'For Invoices:  ' + ALLTRIM(THISFORM.txtInvBeg.VALUE) + ' - ' + ALLTRIM(THISFORM.txtInvEnd.VALUE)
		         SELECT invdet.cItemId, ;
		            invdet.cItemDesc, ;
		            SUM(invdet.nQuantity) AS units, ;
		            SUM(invdet.nExtension) AS Amount, ;
		            AVG(invdet.nPrice) AS nPrice  ;
		            FROM invdet, invhdr ;
		            WHERE BETWEEN(invhdr.cInvNum, ;
		            THISFORM.txtInvBeg.VALUE, ;
		            THISFORM.txtInvEnd.VALUE) ;
		            AND invdet.cBatch = invhdr.cBatch ;
		            AND invdet.cItemId IN (SELECT cItemId FROM items) ;
		            INTO CURSOR billtemp ;
		            ORDER BY invdet.cItemId ;
		            GROUP BY invdet.cItemId
		      ENDIF
		
		   CASE llSubtotal AND NOT llDetail  &&  Subtotal by customer, but no detail
		
		      IF THISFORM.opgRange.VALUE = 1  &&  Date Range
		         THISFORM.cSelectCriteria = 'For Date Range:  ' + DTOC(THISFORM.txtBegDate.VALUE) + ' - ' + DTOC(THISFORM.txtEndDate.VALUE)
		         SELECT invdet.cItemId, ;
		            invdet.cItemDesc, ;
		            invhdr.ccustid,  ;
		            custs.cCustName,  ;
		            SUM(invdet.nQuantity) AS units, ;
		            SUM(invdet.nExtension) AS Amount, ;
		            AVG(invdet.nPrice) AS nPrice  ;
		            FROM invdet, invhdr, custs ;
		            WHERE BETWEEN(invhdr.dInvDate, ;
		            THISFORM.txtBegDate.VALUE, ;
		            THISFORM.txtEndDate.VALUE) ;
		            AND invdet.cBatch = invhdr.cBatch ;
		            AND invdet.cItemId IN (SELECT cItemId FROM items) ;
		            AND invhdr.ccustid = custs.ccustid  ;
		            INTO CURSOR billtemp ;
		            ORDER BY invhdr.ccustid,invdet.cItemId ;
		            GROUP BY invhdr.ccustid,invdet.cItemId
		
		      ELSE THISFORM.opgRange.VALUE = 2  &&  Range of invoices
		         THISFORM.cSelectCriteria = 'For Invoices:  ' + ALLTRIM(THISFORM.txtInvBeg.VALUE) + ' - ' + ALLTRIM(THISFORM.txtInvEnd.VALUE)
		         SELECT invdet.cItemId, ;
		            invdet.cItemDesc, ;
		            invhdr.ccustid,  ;
		            custs.cCustName,  ;
		            SUM(invdet.nQuantity) AS units, ;
		            SUM(invdet.nExtension) AS Amount, ;
		            AVG(invdet.nPrice) AS nPrice  ;
		            FROM invdet, invhdr, custs ;
		            WHERE BETWEEN(invhdr.cInvNum, ;
		            THISFORM.txtInvBeg.VALUE, ;
		            THISFORM.txtInvEnd.VALUE) ;
		            AND invdet.cBatch = invhdr.cBatch ;
		            AND invdet.cItemId IN (SELECT cItemId FROM items) ;
		            AND invhdr.ccustid = custs.ccustid  ;
		            INTO CURSOR billtemp ;
		            ORDER BY invhdr.ccustid,invdet.cItemId ;
		            GROUP BY invhdr.ccustid,invdet.cItemId
		      ENDIF
		      
		      THISFORM.cSortOrder = 'Customer ID, Item ID'
		      thisform.cReportName = 'arbillsum1.frx'
		
		   CASE llSubtotal AND llDetail  &&  Subtotal by customer, and include detail
		
		      IF THISFORM.opgRange.VALUE = 1  &&  Date Range
		         THISFORM.cSelectCriteria = 'For Date Range:  ' + DTOC(THISFORM.txtBegDate.VALUE) + ' - ' + DTOC(THISFORM.txtEndDate.VALUE)
		         SELECT invdet.cItemId, ;
		            invdet.cItemDesc, ;
		            invhdr.ccustid,  ;
		            custs.cCustName,  ;
		            invhdr.cInvNum,  ;
		            invhdr.dInvDate,  ;
		            invdet.nQuantity AS units, ;
		            invdet.nExtension AS Amount, ;
		            invdet.nPrice AS nPrice  ;
		            FROM invdet, invhdr, custs ;
		            WHERE BETWEEN(invhdr.dInvDate, ;
		            THISFORM.txtBegDate.VALUE, ;
		            THISFORM.txtEndDate.VALUE) ;
		            AND invdet.cBatch = invhdr.cBatch ;
		            AND invdet.cItemId IN (SELECT cItemId FROM items) ;
		            AND invhdr.ccustid = custs.ccustid  ;
		            INTO CURSOR billtemp ;
		            ORDER BY invhdr.ccustid,invhdr.dInvDate,invdet.cItemId
		
		      ELSE THISFORM.opgRange.VALUE = 2  &&  Range of invoices
		         THISFORM.cSelectCriteria = 'For Invoices:  ' + ALLTRIM(THISFORM.txtInvBeg.VALUE) + ' - ' + ALLTRIM(THISFORM.txtInvEnd.VALUE)
		         SELECT invdet.cItemId, ;
		            invdet.cItemDesc, ;
		            invhdr.ccustid,  ;
		            custs.cCustName,  ;
		            invhdr.cInvNum,  ;
		            invhdr.dInvDate,  ;
		            invdet.nQuantity AS units, ;
		            invdet.nExtension AS Amount, ;
		            invdet.nPrice AS nPrice  ;
		            FROM invdet, invhdr, custs ;
		            WHERE BETWEEN(invhdr.cInvNum, ;
		            THISFORM.txtInvBeg.VALUE, ;
		            THISFORM.txtInvEnd.VALUE) ;
		            AND invdet.cBatch = invhdr.cBatch ;
		            AND invdet.cItemId IN (SELECT cItemId FROM items) ;
		            AND invhdr.ccustid = custs.ccustid  ;
		            INTO CURSOR billtemp ;
		            ORDER BY invhdr.ccustid,invhdr.dInvDate,invdet.cItemId
		      ENDIF
		
		      THISFORM.cSortOrder = 'Customer ID, Invoice Date, Item ID'
		      thisform.cReportName = 'arbillsum2.frx'
		
		ENDCASE
		
		WAIT CLEAR
		
		SELECT billtemp
		IF RECC() > 0
		   RETURN .T.
		ELSE
		   RETURN .F.
		ENDIF
		
		
	ENDPROC

	PROCEDURE Init
		DODEFAULT()
		*
		*  Initialize the date and invoice number controls
		*
		thisform.txtBegDate.value = DATE() - 30
		thisform.txtEndDate.value = DATE()
		
		SELECT invhdr
		SET ORDER TO cinvnum
		GO TOP
		thisform.txtInvBeg.value = cinvnum
		GO BOTT
		thisform.txtInvEnd.value = cinvnum
		
		thisform.opgRange.value = 1
		
		
		
	ENDPROC

	PROCEDURE chklSubtotal.Click
		DODEFAULT()
		
		IF THIS.VALUE
		   THISFORM.chklDetail.VISIBLE = .T.
		ELSE
		   THISFORM.chklDetail.VALUE = .F.
		   THISFORM.chklDetail.VISIBLE = .F.
		ENDIF
		
	ENDPROC

	PROCEDURE opgRange.optDateRange.Click
		thisform.txtBegDate.enabled = .t.
		thisform.txtEndDate.enabled = .t.
		thisform.txtInvBeg.enabled = .f.
		thisform.txtInvEnd.enabled = .f.
	ENDPROC

	PROCEDURE opgRange.optDateRange.GotFocus
		THISFORM.opgRange.VALUE = 1
		this.click()
		
	ENDPROC

	PROCEDURE opgRange.optInvRange.Click
		thisform.txtBegDate.enabled = .f.
		thisform.txtEndDate.enabled = .f.
		thisform.txtInvBeg.enabled = .t.
		thisform.txtInvEnd.enabled = .t.
	ENDPROC

	PROCEDURE opgRange.optInvRange.GotFocus
		THISFORM.opgRange.VALUE = 2
		this.click()
	ENDPROC

	PROCEDURE opgRange.Valid
		DO CASE
		   CASE this.value = 1
		      thisform.txtInvBeg.Enabled    = .F.
		      thisform.txtInvEnd.Enabled    = .F.
		      thisform.txtBegDate.Enabled = .T.
		      thisform.txtEndDate.Enabled   = .T.
		   CASE this.value = 2
		      thisform.txtInvBeg.Enabled    = .T.
		      thisform.txtInvEnd.Enabled    = .T.
		      thisform.txtBegDate.Enabled = .F.
		      thisform.txtEndDate.Enabled   = .F.
		ENDCASE         
		      
	ENDPROC

	PROCEDURE txtBegDate.dropdown
		DODEFAULT()
		thisform.setnextcontrol(this)
		
	ENDPROC

	PROCEDURE txtEndDate.dropdown
		DODEFAULT()
		thisform.setnextcontrol(this)
		
	ENDPROC

	PROCEDURE txtInvBeg.InteractiveChange
		thisform.opgRange.value = 2
		thisform.opgRange.refresh()
	ENDPROC

	PROCEDURE txtInvEnd.InteractiveChange
		thisform.opgRange.value = 2
		thisform.opgRange.refresh()
	ENDPROC

ENDDEFINE
