*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="arcuststm.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor9" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 341
	Left = 2
	Name = "Dataenvironment"
	Top = 356
	Width = 555

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "custs", ;
		CursorSource = "custs", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "invhdr", ;
		CursorSource = "invhdr", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 225, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "terms", ;
		CursorSource = "terms", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "custown", ;
		CursorSource = "custown", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor4", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor5' AS cursor WITH ;
		Alias = "aropt", ;
		CursorSource = "aropt", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 153, ;
		Name = "Cursor5", ;
		Top = 137, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor6' AS cursor WITH ;
		Alias = "arpmtdet", ;
		CursorSource = "arpmtdet", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 445, ;
		Name = "Cursor6", ;
		Top = 282, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor7' AS cursor WITH ;
		Alias = "arpmthdr", ;
		CursorSource = "arpmthdr", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor7", ;
		Top = 140, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor8' AS cursor WITH ;
		Alias = "arpmthdr1", ;
		CursorSource = "arpmthdr", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 430, ;
		Name = "Cursor8", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor9' AS cursor WITH ;
		Alias = "arpmtdet1", ;
		CursorSource = "arpmtdet", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor9", ;
		Top = 260, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formarcuststm AS frmrptcriteria OF "appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblEndID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblBegID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbltextcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="opgDate" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtdStmtDate" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chklNotes" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chklJIB" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkSelected" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblSelected" UniqueID="" Timestamp="" />

	Caption = "Customer Statements"
	DataSession = 2
	DoCreate = .T.
	Height = 360
	HelpContextID = 582
	Name = "FormArcuststm"
	Width = 388
	Swrptcriteriabuttons1.CHKEXPORT.Alignment = 0
	Swrptcriteriabuttons1.CHKEXPORT.Name = "CHKEXPORT"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.cmdPreview.Name = "cmdPreview"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 71
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.TabIndex = 11
	Swrptcriteriabuttons1.Top = 298
	Swrptcriteriabuttons1.ZOrderSet = 0

	ADD OBJECT 'chklJIB' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Include JIB Balances", ;
		Left = 133, ;
		Name = "chklJIB", ;
		TabIndex = 10, ;
		Top = 261, ;
		Value = .F.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chklNotes' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Include Notes from invoice", ;
		Left = 133, ;
		Name = "chklNotes", ;
		TabIndex = 9, ;
		Top = 237, ;
		Value = .T.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkSelected' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Choose Selected Customers", ;
		Left = 134, ;
		Name = "chkSelected", ;
		TabIndex = 5, ;
		Top = 112, ;
		Value = .F.
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'lblBegID' AS lbllabelcustom WITH ;
		Caption = "Beginning Cust ID:", ;
		Height = 16, ;
		Left = 15, ;
		Name = "lblBegID", ;
		TabIndex = 7, ;
		Top = 138, ;
		Width = 89, ;
		ZOrderSet = 4
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblEndID' AS lbllabelcustom WITH ;
		Caption = "Ending Cust ID:", ;
		Height = 16, ;
		Left = 15, ;
		Name = "lblEndID", ;
		TabIndex = 8, ;
		Top = 189, ;
		Width = 74, ;
		ZOrderSet = 3
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom1' AS lbllabelcustom WITH ;
		Caption = "Statement Date:", ;
		Height = 16, ;
		Left = 15, ;
		Name = "Lbllabelcustom1", ;
		TabIndex = 2, ;
		Top = 26, ;
		Width = 78, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblSelected' AS lbllabelcustom WITH ;
		Caption = "All IDs Selected", ;
		ForeColor = 0,0,255, ;
		Left = 133, ;
		Name = "lblSelected", ;
		TabIndex = 12, ;
		Top = 175, ;
		Visible = .F.
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbltextcustom1' AS lbltextcustom WITH ;
		Caption = "Base Statements On:", ;
		Left = 15, ;
		Name = "Lbltextcustom1", ;
		TabIndex = 4, ;
		Top = 61
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'opgDate' AS opgoptiongroupcustom WITH ;
		AutoSize = .T., ;
		BorderStyle = 0, ;
		ButtonCount = 2, ;
		Left = 133, ;
		Name = "opgDate", ;
		TabIndex = 3, ;
		Top = 55, ;
		Option1.Caption = "Due Date", ;
		Option1.FontSize = 8, ;
		Option1.Height = 17, ;
		Option1.Left = 5, ;
		Option1.Name = "Option1", ;
		Option1.Top = 5, ;
		Option1.Width = 61, ;
		Option2.Caption = "Invoice Date", ;
		Option2.FontSize = 8, ;
		Option2.Height = 17, ;
		Option2.Left = 5, ;
		Option2.Name = "Option2", ;
		Option2.Top = 24, ;
		Option2.Width = 79
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 133, ;
		Name = "Swrptlook1", ;
		TabIndex = 6, ;
		Top = 135, ;
		ZOrderSet = 1, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		TxtBegID.clistexpression = custown.ccustid, ;
		TxtBegID.clistworkarea = custown, ;
		TxtBegID.Name = "TxtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		TxtEndID.clistexpression = custown.ccustid, ;
		TxtEndID.clistworkarea = custown, ;
		TxtEndID.Name = "TxtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />

	ADD OBJECT 'txtdStmtDate' AS dpk WITH ;
		Height = 20, ;
		Left = 133, ;
		Name = "txtdStmtDate", ;
		TabIndex = 1, ;
		Top = 24, ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\swdate.vcx" BaseClass="textbox" />
	
	PROCEDURE builddata
		*!*	LOCAL tdDate, tcCust1, tcCust2
		
		tdDate  = THISFORM.txtdStmtDate.VALUE
		tcCust1 = THISFORM.swrptlook1.txtBegID.VALUE
		tcCust2 = THISFORM.swrptlook1.txtEndID.VALUE
		tnDate = thisform.opgDate.value
		tnMinBal = aropt.nMinBal
		tlNegBal = aropt.lNegBal
		tlMinBalCk = aropt.lMinBalCk
		tlInvDayCk = aropt.lInvDayCk
		tnInvDay = aropt.nInvDay
		tlNotes = thisform.chklNotes.Value
		tlJIB   = thisform.chklJIB.value
		llSelected = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT ccustid AS cid FROM custown ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(ccustid,tcCust1,tcCust2) ;
		      ORDER BY cid
		ENDIF
		
		THISFORM.cTitle1 = ''
		THISFORM.cTitle2 = ''
		THISFORM.cSelectCriteria = ''
		THISFORM.cSortOrder = ''
		
		IF FILE(m.goapp.cRptsFolder+'custstmt.frx')
		   thisform.cReportName = m.goapp.cRptsFolder+'custstmt'
		ELSE    
		   THISFORM.cReportName = 'source\arcuststm'
		ENDIF    
		
		*!*	* Check on the existence of the application object
		*!*	* if it doesn't exist, we're running in development
		*!*	* mode and need to initialize the company address info.
		IF TYPE('m.goApp') = 'O'
		   m.paddr1 = m.goApp.cAddress1
		   m.paddr2 = m.goApp.cAddress2
		   m.paddr3 = m.goApp.cAddress3
		ELSE
		   m.paddr1 = 'PO Box 223'
		   m.paddr2 = 'Wooster, OH  44691'
		   m.paddr3 = ''
		ENDIF
		
		*!*	*
		*!*	*  Create the work cursor
		*!*	*
		CREATE CURSOR arstmt ;
		   (cCustId    C(10), ;
		   cCustName  C(40), ;
		   cBatch     c(8),  ;
		   cbAddr1    C(40), ;
		   cbAddr2    C(40), ;
		   cbAddr3    C(40), ;
		   paddr1     C(40), ;
		   paddr2     C(40), ;
		   paddr3     C(40), ;
		   dStmtDate  D,     ;
		   cInvNum    C(15), ;
		   dInvDate   D,     ;
		   dDueDate   D,     ;
		   cReference C(20), ;
		   mNotes     m,  ;
		   nInvTot    N(12,2), ;
		   nInvBal    N(12,2))
		INDEX ON cCustId+DTOS(dDueDate) TAG custdue
		
		IF araged(tcCust1,tcCust2,tdDate,.T.,tnDate,.f.,.f.,.f.,tlJIB,llSelected)
		   SELE arstmt
		   APPEND FROM DBF('custbal')
		
		*!*	   SELE arstmt
		*!*	   IF NOT tlNegBal  &&  Drop out negative balance invoices if the option in AR options is not chosen
		*!*	      DELE FOR nInvBal < 0
		*!*	   ENDIF
		   IF tlMinBalCk = .T. AND tnMinBal > 0  && If 'Balance at Least' box is chosen, and a number is plugged in
		      DELE FOR nInvBal < tnMinBal
		   ENDIF
		   IF tlInvDayCk = .T. AND tnInvDay > 0  &&  If 'Invoice at least' box is chosen, and a number of days is entered
		      DELE FOR dDueDate + tnInvDay >= tdDate
		   ENDIF
		   
		   IF tlNotes  &&  Including Invoice Notes
		      SELECT arstmt
		      SCAN
		         SELECT invhdr
		         LOCATE FOR cBatch = arstmt.cBatch
		         IF FOUND() AND lPrintNotes  &&  This should respect the same setting as the invoice
		            replace arstmt.mNotes WITH invhdr.mNotes
		         ENDIF
		      endscan      
		   ENDIF
		   
		   COUNT FOR NOT DELETED() TO lnCount
		   IF lnCount > 0
		      RETURN .T.
		   ELSE
		      RETURN .F.
		   ENDIF
		ELSE
		   RETURN .F.
		ENDIF
		
		
	ENDPROC

	PROCEDURE Init
		DODEFAULT()
		SELECT custown
		SET SAFETY OFF
		SELECT custown
		INDEX ON ccustid TAG ccustid
		SET ORDER TO ccustid
		
		GO TOP
		
		THISFORM.swrptlook1.txtBegID.VALUE = ccustid
		THISFORM.swrptlook1.txtBegName.VALUE = ccustname
		
		GO BOTTOM
		THISFORM.swrptlook1.txtEndID.VALUE = ccustid
		THISFORM.swrptlook1.txtEndName.VALUE = ccustname
		
		
		
	ENDPROC

	PROCEDURE chkSelected.Click
		IF this.Value
		   DO FORM commonsource\selected-ids WITH 'CUSTOMER' LINKED 
		   lnCount = RECCOUNT('selected')
		   thisform.lblselected.Caption = TRANSFORM(lnCount) + ' Customers Selected'
		   thisform.lblselected.Visible = .T.
		   thisform.lblbegID.Visible = .F.
		   thisform.lblendID.Visible = .F.
		   thisform.swrptlook1.Visible = .F.
		ELSE
		   thisform.lblselected.Visible = .F.
		   thisform.lblbegID.Visible = .T.
		   thisform.lblendID.Visible = .T.
		   thisform.swrptlook1.Visible = .T.
		ENDIF 
	ENDPROC

	PROCEDURE opgDate.Init
		IF DODEFAULT()
		   THIS.VALUE = 1
		ENDIF
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .T.
		lcList = 'ccustid\ID,ccustname\Name,ctype\Type'
		
		SET SAFETY OFF
		SELECT custown
		INDEX ON ccustid TAG ccustid
		INDEX ON ccustname TAG ccustname
		INDEX ON ctype TAG ctype
		
		DO FORM ..\CUSTOM\picklist WITH 'Custown', lcList, thisform.swrptlook1.txtbegid.value, 3, .f., .t.
		
		IF llOK
		   THISFORM.swrptlook1.txtBegID.VALUE   = custown.ccustid
		   THISFORM.swrptlook1.txtBegID.REFRESH()
		   THISFORM.swrptlook1.txtBegName.VALUE = custown.ccustname
		   THISFORM.swrptlook1.txtBegName.REFRESH()
		   THISFORM.setnextcontrol(THISFORM.swrptlook1.txtBegID)
		ENDIF
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .T.
		lcList = 'ccustid\ID,ccustname\Name,ctype\Type'
		
		SET SAFETY OFF
		SELECT custown
		INDEX ON ccustid TAG ccustid
		INDEX ON ccustname TAG ccustname
		INDEX ON ctype TAG ctype
		
		DO FORM ..\custom\picklist WITH 'Custown', lcList, thisform.swrptlook1.txtendid.value, 3, .f., .t.
		
		IF llOK
		   thisform.swrptlook1.txtEndID.value   = custown.ccustid
		   thisform.swrptlook1.txtEndID.refresh()
		   thisform.swrptlook1.txtEndName.value = custown.ccustname
		   thisform.swrptlook1.txtEndName.refresh()
		   thisform.setnextcontrol(thisform.swrptlook1.txtEndID)
		ENDIF   
		
	ENDPROC

	PROCEDURE Swrptlook1.TxtBegID.Valid
		SELECT custown
		SET ORDER TO ccustid
		IF SEEK(THIS.VALUE)
		   THISFORM.swrptlook1.txtBegName.SET('value',custown.ccustname)
		ELSE
		   THISFORM.swrptlook1.txtBegName.SET('value','')
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE Swrptlook1.TxtEndID.Valid
		SELECT custown
		SET ORDER TO ccustid
		IF SEEK(THIS.VALUE)
		   THISFORM.swrptlook1.txtEndName.SET('value',custown.ccustname)
		ELSE
		   THISFORM.swrptlook1.txtEndName.SET('value','')
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE txtdStmtDate.Init
		this.Value = DATE()
		
		DODEFAULT()
	ENDPROC

ENDDEFINE
