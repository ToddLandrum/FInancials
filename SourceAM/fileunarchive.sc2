*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="fileunarchive.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor9" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor11" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor12" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor13" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor14" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 571
	Left = 21
	Name = "Dataenvironment"
	Top = 294
	Width = 704

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "coa", ;
		CursorSource = "coa", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor10' AS cursor WITH ;
		Alias = "appmthdr", ;
		CursorSource = "appmthdr", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor10", ;
		Top = 260, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor11' AS cursor WITH ;
		Alias = "invhdr", ;
		CursorSource = "invhdr", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor11", ;
		Top = 315, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor12' AS cursor WITH ;
		Alias = "invdet", ;
		CursorSource = "invdet", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor12", ;
		Top = 315, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor13' AS cursor WITH ;
		Alias = "arpmtdet", ;
		CursorSource = "arpmtdet", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 426, ;
		Name = "Cursor13", ;
		Top = 265, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor14' AS cursor WITH ;
		Alias = "arpmthdr", ;
		CursorSource = "arpmthdr", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 531, ;
		Name = "Cursor14", ;
		Top = 263, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "coabal", ;
		BufferModeOverride = 5, ;
		CursorSource = "coabal", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "glmaster", ;
		CursorSource = "glmaster", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 289, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "glopt", ;
		CursorSource = "glopt", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor4", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor5' AS cursor WITH ;
		Alias = "wellhist", ;
		CursorSource = "wellhist", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 146, ;
		Name = "Cursor5", ;
		Top = 139, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor6' AS cursor WITH ;
		Alias = "disbhist", ;
		CursorSource = "disbhist", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 288, ;
		Name = "Cursor6", ;
		Top = 142, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor7' AS cursor WITH ;
		Alias = "appurchd", ;
		CursorSource = "appurchd", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 438, ;
		Name = "Cursor7", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor8' AS cursor WITH ;
		Alias = "appurchh", ;
		CursorSource = "appurchh", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 430, ;
		Name = "Cursor8", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor9' AS cursor WITH ;
		Alias = "appmtdet", ;
		CursorSource = "appmtdet", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor9", ;
		Top = 260, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formfilearchive AS frmdatamanagerformcustom OF "..\custom\cforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Lbltextcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swyear1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdClose" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdExit" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Glmaint" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Dzip" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbltextcustom2" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: archive
		*m: backup
		*m: unarchive
		*p: oprogress
	*</DefinedPropArrayMethod>

	Caption = "Un-Archive Data"
	DoCreate = .T.
	Height = 235
	HelpContextID = 479
	lcloseonescape = .T.
	Name = "Formfilearchive"
	Visible = .T.
	Width = 337
	cmdatamanager.Name = "cmdatamanager"
	cmlookupmanager.Name = "cmlookupmanager"

	ADD OBJECT 'cmdClose' AS cmdcommandbuttoncustom WITH ;
		Caption = "\<Un-Archive", ;
		FontSize = 8, ;
		Height = 33, ;
		Left = 82, ;
		Name = "cmdClose", ;
		Top = 164, ;
		Width = 80
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'cmdExit' AS cmdcommandbuttoncustom WITH ;
		Caption = "\<Exit", ;
		Default = .T., ;
		FontSize = 8, ;
		Height = 33, ;
		Left = 174, ;
		Name = "cmdExit", ;
		Top = 164, ;
		Width = 80
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Dzip' AS olecontrol WITH ;
		Height = 13, ;
		Left = 12, ;
		Name = "Dzip", ;
		Top = 36, ;
		Width = 1
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\windows\system32\dzactx.dll" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADXkMaS+skBAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7AAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAGcAAAAAAAAAAwAAAP7///8GAAAABAAAAAUAAAD+/////v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9PDp0OuHrREZQAAKAkjy7wAAMAAE8DAABPAwAACAACAAAAAAAIAAIAAAAAAAsAAAALAAAACAACAAAAAAALAAAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAIAQAAAATWFqb3JTdGF0dXNGbGFnAAUAAABMAQAAABcAAABOb0RpcmVjdG9yeUVudHJpZXNGbGFnAAUAAAAIAAIAAAAAAAsAAAALAAAACAACAAAAAAALAP//CwAAAAsAAAALAP//CwAAAAsAAAACAAUACwAAAAsAAAALAAAACwAAAAsAAAALAP//CwAAAAsAAAALAAAACwAAAAsAAAALAAAACAACAAAAAAALAAAACAACAAAAAAALAAAACAACAAAAAAALAAAACAACAAAAAAAIAAIAAAAAAAgAAgAAAAAAAwAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAQAAABUAAABOb0RpcmVjdG9yeU5hbWVzRmxhZwAFAAAATAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" />

	ADD OBJECT 'Glmaint' AS glmaint WITH ;
		Left = 216, ;
		Name = "Glmaint", ;
		Top = 0
		*< END OBJECT: ClassLib="..\custom\swgl.vcx" BaseClass="custom" />

	ADD OBJECT 'Lbltextcustom1' AS lbltextcustom WITH ;
		Caption = "Un-Archive Calendar Year:", ;
		FontSize = 8, ;
		Left = 80, ;
		Name = "Lbltextcustom1", ;
		Top = 124
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbltextcustom2' AS lbltextcustom WITH ;
		AutoSize = .T., ;
		Caption = "Un-archiving inserts the individual records from the archived data into the main data tables, and removes the summarized information.  Un-archiving will increase the size of your data files and may slow down processing speed.", ;
		FontSize = 9, ;
		Height = 92, ;
		Left = 51, ;
		Name = "Lbltextcustom2", ;
		Top = 12, ;
		Width = 234, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Swyear1' AS swyear WITH ;
		Left = 219, ;
		Name = "Swyear1", ;
		Top = 122
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="textbox" />
	
	PROCEDURE archive
	ENDPROC

	PROCEDURE backup
	ENDPROC

	PROCEDURE Error
		LPARAMETERS nerror,cmethod,nline
		
		IF txnlevel() > 0
		   ROLLBACK
		ENDIF
		
		DODEFAULT(nerror,cmethod,nline)   
	ENDPROC

	PROCEDURE Init
		IF DODEFAULT()
		   _VFP.AutoYield = .F.
		ENDIF   
		
	ENDPROC

	PROCEDURE unarchive
		**************************************************
		*  Un-Archive the GLMASTER file
		**************************************************
		WAIT WIND NOWAIT 'Processing GL Master File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCGLMASTER' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCGLMASTER' + lcYear + '.dbf' IN 0 ALIAS arcglmaster  &&  Use the archived GLMASTER file
		   SELECT glmaster
		   SET ORDER to cidglma
		   SELECT arcglmaster  &&  Add archived data entries back into the glmaster file
		   SCAN
		      SCATTER memvar
		      SET DELETED off
		      SELECT glmaster
		      DO WHILE SEEK(m.cidglma)
		         m.cidglma = THISFORM.oRegistry.IncrementCounter('%Shared.Counters.Glmaster')
		      ENDDO
		      SET DELETED ON 
		      INSERT INTO glmaster FROM MEMVAR 
		   ENDSCAN 
		   SELECT glmaster
		   GO TOP
		   SCAN FOR 'ARCHIVED DATA' $ UPPER(cDesc) and ALLTRIM(STR(YEAR(ddate))) = lcYear  &&  Remove summary entries
		      DELETE NEXT 1
		   ENDSCAN
		   SELECT arcglmaster
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCGLMASTER' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the WELLHIST file
		**************************************************
		WAIT WIND NOWAIT 'Processing Well History File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCWELLHIST' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCWELLHIST' + lcYear + '.dbf' IN 0 ALIAS arcwellhist  &&  Use the archived WELLHIST file
		   SELECT wellhist
		   APPEND FROM DBF('arcwellhist')  &&  Add archived data entries back into the wellhist file
		   GO TOP
		   SCAN FOR LEFT(cidwhst,1) = 'A' AND hyear+hperiod = lcYear + '12' AND hdate = CTOD('12/31/' + lcYear)  &&  Remove summary entries
		      DELETE NEXT 1
		   ENDSCAN
		   SELECT arcwellhist
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCWELLHIST' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the DISBHIST file
		**************************************************
		WAIT WIND NOWAIT 'Processing Owner History File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCDISBHIST' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCDISBHIST' + lcYear + '.dbf' IN 0 ALIAS arcdisbhist  &&  Use the archived DISBHIST file
		   SELECT disbhist
		   APPEND FROM DBF('arcdisbhist')  &&  Add archived data entries back into the disbhist file
		   GO TOP
		   SCAN FOR LEFT(ciddisb,1) = 'A' AND hyear+hperiod = lcYear + '12' AND hdate = CTOD('12/31/' + lcYear)  &&  Remove summary entries
		      DELETE NEXT 1
		   ENDSCAN
		   SELECT arcdisbhist
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCDISBHIST' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the APPURCHH file
		**************************************************
		WAIT WIND NOWAIT 'Processing Bills File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPURCHH' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPURCHH' + lcYear + '.dbf' IN 0 ALIAS ARCAPPURCHH  &&  Use the archived APPURCHH file
		   SELECT appurchh
		   APPEND FROM DBF('ARCAPPURCHH')  &&  Add archived data entries back into the appurchh file
		   SELECT ARCAPPURCHH
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPURCHH' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the APPURCHD file
		**************************************************
		WAIT WIND NOWAIT 'Processing Bill Details File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPURCHD' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPURCHD' + lcYear + '.dbf' IN 0 ALIAS ARCAPPURCHD  &&  Use the archived APPURCHD file
		   SELECT appurchd
		   APPEND FROM DBF('ARCAPPURCHD')  &&  Add archived data entries back into the appurchd file
		   SELECT ARCAPPURCHD
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPURCHD' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the APPMTDET file
		**************************************************
		WAIT WIND NOWAIT 'Processing Bill Payments File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPMTDET' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPMTDET' + lcYear + '.dbf' IN 0 ALIAS ARCAPPMTDET  &&  Use the archived APPMTDET file
		   SELECT appmtdet
		   APPEND FROM DBF('ARCAPPMTDET')  &&  Add archived data entries back into the appmtdet file
		   SELECT ARCAPPMTDET
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCAPPMTDET' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the INVHDR file
		**************************************************
		WAIT WIND NOWAIT 'Processing Invoice Header File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCINVHDR' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCINVHDR' + lcYear + '.dbf' IN 0 ALIAS ARCINVHDR  &&  Use the archived INVHDR file
		   SELECT invhdr
		   APPEND FROM DBF('ARCINVHDR')  &&  Add archived data entries back into the invhdr file
		   SELECT ARCINVHDR
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCINVHDR' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the INVDET file
		**************************************************
		WAIT WIND NOWAIT 'Processing Invoice Detail File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCINVDET' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCINVDET' + lcYear + '.dbf' IN 0 ALIAS ARCINVDET  &&  Use the archived INVDET file
		   SELECT invdet
		   APPEND FROM DBF('ARCINVDET')  &&  Add archived data entries back into the invdet file
		   SELECT ARCINVDET
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCINVDET' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the ARPMTDET file
		**************************************************
		WAIT WIND NOWAIT 'Processing Invoice Payment File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCARPMTDET' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCARPMTDET' + lcYear + '.dbf' IN 0 ALIAS ARCARPMTDET  &&  Use the archived ARPMTDET file
		   SELECT arpmtdet
		   APPEND FROM DBF('ARCARPMTDET')  &&  Add archived data entries back into the arpmtdet file
		   SELECT ARCARPMTDET
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCARPMTDET' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		
		**************************************************
		*  Un-Archive the ARPMTHDR file
		**************************************************
		WAIT WIND NOWAIT 'Processing Invoice Payment File'
		
		IF NOT FILE(ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCARPMTHDR' + lcYear + '.dbf')
		   THISFORM.oMessage.Warning('This year does not appear to have been archived.')
		   RETURN 0
		ELSE
		   USE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCARPMTHDR' + lcYear + '.dbf' IN 0 ALIAS ARCARPMTHDR  &&  Use the archived ARPMTHDR file
		   SELECT arpmthdr
		   APPEND FROM DBF('ARCARPMTHDR')  &&  Add archived data entries back into the arpmthdr file
		   SELECT ARCARPMTHDR
		   USE  &&  Close the archived file so that it can be deleted
		   DELETE FILE ALLTRIM(m.goApp.cDataFilePath) + 'ARCHIVE\ARCARPMTHDR' + lcYear + '.*'  &&  Get rid of it
		ENDIF
		
		WAIT CLEAR
		
		llok = .F.
		BEGIN TRANSACTION
		SELE glmaster
		llok = TABLEUPDATE(.T.)
		IF llok
		   SELE wellhist
		   llok = TABLEUPDATE(.T.)
		   IF llok
		      SELE disbhist
		      llok = TABLEUPDATE(.T.)
		      IF llok
		         SELE appurchh
		         llok = TABLEUPDATE(.T.)
		         IF llok
		            SELE appurchd
		            llok = TABLEUPDATE(.T.)
		            IF llok
		               SELE appmtdet
		               llok = TABLEUPDATE(.T.)
		               IF llok
		                  SELE invhdr
		                  llok = TABLEUPDATE(.T.)
		                  IF llok
		                     SELE invdet
		                     llok = TABLEUPDATE(.T.)
		                     IF llok
		                        SELE arpmtdet
		                        llok = TABLEUPDATE(.T.)
		                        IF llok
		                           SELE arpmthdr
		                           llok = TABLEUPDATE(.T.)
		                        ENDIF
		                     ENDIF
		                  ENDIF
		               ENDIF
		            ENDIF
		         ENDIF
		      ENDIF
		   ENDIF
		ENDIF
		IF llok
		   END TRANSACTION
		   THISFORM.omessage.DISPLAY(lcYear + ' was successfully unarchived.')
		ELSE
		   ROLLBACK
		   THISFORM.omessage.severe('Unable to Archive Data. All Files have been reset.')
		ENDIF
		
		
		
	ENDPROC

	PROCEDURE Unload
		_VFP.AutoYield = .T.
		
		DODEFAULT()
	ENDPROC

	PROCEDURE cmdClose.Click
		public lcYear
		
		lcYear = ThisForm.Swyear1.value
		
		*
		*  Ask to make sure the user wants to un-archive this year.
		*
		IF NOT THISFORM.oMessage.CONFIRM('Are you sure you want to un-archive year ' + lcYear + '?')
		   WAIT WIND NOWAIT 'Un-archive of year ' + lcYear + ' cancelled...'
		   RETURN
		ENDIF
		
		thisform.UnArchive()
	ENDPROC

	PROCEDURE cmdExit.Click
		thisform.release()
	ENDPROC

	PROCEDURE Dzip.ZipMajorStatus
		*** ActiveX Control Event ***
		LPARAMETERS itemname, percent, cancel
		
		thisform.oProgress.SetProgressMessage(itemname)
		thisform.oProgress.UpdateProgress(percent)
	ENDPROC

ENDDEFINE
