*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="dmgasbaladj.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Relation1" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 200
	Left = 64
	Name = "Dataenvironment"
	Top = 448
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "gasown", ;
		CursorSource = "gasown", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "gasuse", ;
		CursorSource = "gasuse", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "investor", ;
		CursorSource = "investor", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "gasinv", ;
		CursorSource = "gasinv", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 448, ;
		Name = "Cursor4", ;
		Top = 180, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Relation1' AS relation WITH ;
		ChildAlias = "gasinv", ;
		ChildOrder = "cmeterno", ;
		Name = "Relation1", ;
		ParentAlias = "gasown", ;
		RelationalExpr = "cmeterno"
		*< END OBJECT: BaseClass="relation" />

ENDDEFINE

DEFINE CLASS frmdmgasbaladj AS frmdatamanagerformcustom OF "..\..\dmie_rv\custom\cforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="lblDdate" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtCmeterno" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblCmeterno" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtcOwnerID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtNused" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblNused" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdLookOwner" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtcOwnerName" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtdDate" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: getownername
	*</DefinedPropArrayMethod>

	Caption = "Adjust House Gas Usage Balance"
	cworkarea = gasuse
	DoCreate = .T.
	Height = 202
	Name = "frmDMGasBalAdj"
	Width = 452
	_memberdata = <VFPData>
		<memberdata name="getownername" display="GetOwnerName"/>
		</VFPData>
	cmdatamanager.Name = "cmdatamanager"
	cmdatamanager.TabIndex = 1
	cmlookupmanager.Name = "cmlookupmanager"
	Mwresize1.lblHighLight.Name = "lblHighLight"
	Mwresize1.lblShading.Name = "lblShading"
	Mwresize1.Left = 348
	Mwresize1.Name = "Mwresize1"
	Mwresize1.TabIndex = 11
	Mwresize1.Top = 228

	ADD OBJECT 'cmdLookOwner' AS cmdcommandbuttoncustom WITH ;
		Caption = "Owner", ;
		Left = 48, ;
		Name = "cmdLookOwner", ;
		TabIndex = 2, ;
		Top = 32
		*< END OBJECT: ClassLib="..\..\dmie_rv\custom\ccontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'lblCmeterno' AS lblfieldlabelcustom WITH ;
		Caption = "Meter No", ;
		Height = 16, ;
		Left = 56, ;
		Name = "lblCmeterno", ;
		TabIndex = 6, ;
		Top = 73, ;
		Width = 45
		*< END OBJECT: ClassLib="..\..\dmie_rv\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblDdate' AS lblfieldlabelcustom WITH ;
		Caption = "Date", ;
		Height = 16, ;
		Left = 56, ;
		Name = "lblDdate", ;
		TabIndex = 8, ;
		Top = 112, ;
		Width = 24
		*< END OBJECT: ClassLib="..\..\dmie_rv\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblNused' AS lblfieldlabelcustom WITH ;
		Caption = "Amt Used", ;
		Height = 16, ;
		Left = 56, ;
		Name = "lblNused", ;
		TabIndex = 10, ;
		Top = 151, ;
		Width = 49
		*< END OBJECT: ClassLib="..\..\dmie_rv\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'txtCmeterno' AS txttextboxcustom WITH ;
		ControlSource = "gasuse.cmeterno", ;
		Height = 20, ;
		Left = 135, ;
		MaxLength = 15, ;
		Name = "txtCmeterno", ;
		TabIndex = 5, ;
		Top = 71, ;
		Width = 111
		*< END OBJECT: ClassLib="..\..\dmie_rv\custom\ccontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtcOwnerID' AS txtquickfill WITH ;
		clistexpression = gasown.cownerid, ;
		clistworkarea = gasown, ;
		ControlSource = "gasuse.cownerid", ;
		Height = 20, ;
		InputMask = "XXXXXXXXXX", ;
		lautoremember = .F., ;
		Left = 135, ;
		lrequired = .T., ;
		MaxLength = 10, ;
		Name = "txtcOwnerID", ;
		TabIndex = 3, ;
		Top = 35, ;
		Width = 79, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\custom\cgadget.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtcOwnerName' AS txttextboxcustom WITH ;
		BackColor = 212,208,200, ;
		Height = 20, ;
		lautoremember = .F., ;
		Left = 219, ;
		Name = "txtcOwnerName", ;
		TabIndex = 4, ;
		Top = 35, ;
		Width = 192, ;
		ZOrderSet = 89
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtdDate' AS dpk WITH ;
		ControlSource = "gasuse.ddate", ;
		Height = 20, ;
		Left = 136, ;
		Name = "txtdDate", ;
		TabIndex = 7, ;
		Top = 108, ;
		Width = 69, ;
		ZOrderSet = 25
		*< END OBJECT: ClassLib="..\custom\swdate.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtNused' AS txtnumeric WITH ;
		ControlSource = "gasuse.nused", ;
		Height = 21, ;
		Left = 135, ;
		Name = "txtNused", ;
		TabIndex = 9, ;
		Top = 149, ;
		Width = 83
		*< END OBJECT: ClassLib="..\..\dmie_rv\common\cmgadget.vcx" BaseClass="textbox" />
	
	PROCEDURE first
		LPARAMETERS cWorkarea
		*
	ENDPROC

	PROCEDURE getownername
		swselect('investor')
		
		LOCATE FOR cownerid = thisform.txtcownerid.Value
		IF FOUND()
		   thisform.txtcownername.Value = investor.csortfield
		   thisform.txtcownername.Refresh()
		ENDIF 
	ENDPROC

	PROCEDURE Init
		
		IF DODEFAULT()
		   thisform.new()
		ENDIF 
	ENDPROC

	PROCEDURE last
		LPARAMETERS cWorkarea
		
		*
	ENDPROC

	PROCEDURE next
		LPARAMETERS cWorkarea
		*
	ENDPROC

	PROCEDURE prior
		LPARAMETERS cWorkarea
		*
	ENDPROC

	PROCEDURE cmdatamanager.beforeupdate
		LPARAMETERS cWorkareaList, lCurrentRecordOnly
		
		
		m.cidgasinv = thisform.oregistry.incrementcounter('%Shared.Counters.Batch')
		m.cinvtoken = m.cidgasinv        
		
		SELECT gasuse 
		REPLACE gasuse.ccharge WITH 'Usage Adjustment', ;
		        gasuse.dinvdate WITH gasuse.ddate, ;
		        gasuse.cinvtoken WITH m.cinvtoken ;
		        
		 
		 m.cownerid = thisform.txtcownerid.Value
		 m.cmeterno = thisform.txtcmeterno.Value
		 m.dinvdate = thisform.txtddate.Value
		 
		 STORE '' TO m.cinvum, m.cidterm, m.ccurrent
		 STORE 0 TO  m.nprice, m.npriceadj, m.ntotal, m.nbalance, m.npmts, m.ndisctot, m.ncharge, m.npressure
		 
		 INSERT INTO gasinv FROM MEMVAR 
		        
		
		
	ENDPROC

	PROCEDURE cmdLookOwner.Click
		LPARAMETERS cWorkarea
		*
		PRIV llOK
		LOCAL lcList, lnRecNo, lStatus
		LOCAL llOK, llReturn, lnCount, loError
		
		llReturn = .T.
		
		TRY
		* Default to the form's primary workarea
		   IF EMPTY(m.cWorkarea)
		      m.cWorkarea = THISFORM.cWorkarea
		   ENDIF
		
		   IF USED('temp')
		      USE IN temp
		   ENDIF
		   IF USED('temp1')
		      USE IN temp1
		   ENDIF
		
		   llOK   = .T.
		   lcList = 'cOwnerID\Owner ID,cOwnName\Owner Name,cMeterNo\Meter Number,cDescription/cdescrip\Description'
		
		   SELECT  gasown.cOwnerID,;
				   investor.cSortField AS cOwnName,;
				   gasown.cMeterNo,;
				   gasown.cDescription  ;
			   FROM gasown, investor ;
			   INTO CURSOR temp1 ;
			   WHERE gasown.cOwnerID = investor.cOwnerID
		
		   SELECT temp1
		   USE DBF('temp1') AGAIN IN 0 ALIAS temp
		   SELECT temp
		   INDEX ON cOwnerID TAG cOwnerID
		   INDEX ON cOwnName TAG cOwnName
		   INDEX ON cMeterNo TAG cMeterNo
		   INDEX ON cDescription TAG cDescrip
		
		   SELECT gasown
		   lnRecNo = RECNO()
		   COUNT FOR NOT DELETED() TO lnCount
		   IF lnCount = 0
		      llReturn = .T.
		      EXIT
		   ENDIF
		
		   DO FORM ..\CUSTOM\picklist WITH 'temp', lcList, gasown.cOwnerID, 4, .T., .T.
		
		   IF llOK
		      SELECT gasown
		      LOCATE FOR cMeterNo = temp.cMeterNo AND cOwnerID = temp.cOwnerID
		      THISFORM.txtCownerid.set('VALUE', gasown.cOwnerID)
		      THISFORM.txtcmeterno.set('VALUE',gasown.cMeterNo)
		      THISFORM.txtcownerName.VALUE = temp.cOwnName
		      thisform.txtddate.set('Value',DATE())
		      thisform.txtnused.set('Value',0)
		      thisform.setnextcontrol(thisform.txtddate)
		   ENDIF
		CATCH TO loError
		   llReturn = .F.
		   DO errorlog WITH 'List', loError.LINENO, 'House Gas Adjustment', loError.ERRORNO, loError.MESSAGE, '', loError
		   MESSAGEBOX('Unable to process the list at this time. Check the System Log found under Other Reports for more information.' + CHR(10) + CHR(10) + ;
		        'Contact SherWare Support for help at support@sherware.com', 16, 'Problem Encountered')
		ENDTRY
		
		RETURN llReturn
		
		
	ENDPROC

	PROCEDURE txtCmeterno.When
		RETURN .f.
	ENDPROC

	PROCEDURE txtcOwnerID.GotFocus
		ON KEY LABEL F2 _screen.activeform.cmdLookOwner.Click()
	ENDPROC

	PROCEDURE txtcOwnerID.InteractiveChange
		IF DODEFAULT()
		   SELECT investor
		   LOCATE FOR cownerid == this.Value
		   IF FOUND()
		      thisform.txtcownerName.Value = investor.csortfield
		   ELSE
		      thisform.txtcownerName.Value = ''
		   ENDIF
		ENDIF          
	ENDPROC

	PROCEDURE txtcOwnerID.LostFocus
		ON KEY LABEL f2
		
	ENDPROC

	PROCEDURE txtcOwnerID.Valid
		IF DODEFAULT()
		   SELECT gasown
		   LOCATE FOR cOwnerID = THIS.VALUE
		   IF FOUND()
		      THISFORM.txtCownerid.set('VALUE', gasown.cOwnerID)
		      THISFORM.txtcmeterno.set('VALUE', gasown.cMeterNo)
		      THISFORM.txtddate.set('VALUE',DATE())
		      THISFORM.txtnused.set('VALUE',0)
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE txtcOwnerName.When
		RETURN .F.
	ENDPROC

ENDDEFINE
