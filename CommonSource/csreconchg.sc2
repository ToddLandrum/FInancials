*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="csreconchg.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 200
	Left = 1
	Name = "Dataenvironment"
	Top = 220
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "checkrec", ;
		CursorSource = "checkrec", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "checks", ;
		CursorSource = "checks", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "coa", ;
		CursorSource = "coa", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS frmcsreconchg AS frmdatamanagerformcustom OF "..\custom\cforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="txtdDate1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbltextcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swlookupbutton1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbltextcustom2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdChangeDate" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdExit" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtcAcctNo" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblAcctDesc" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblAcct" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtdDate2" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*p: lcacctno
	*</DefinedPropArrayMethod>

	Caption = "Change Reconciliation Date"
	cworkarea = 
	DoCreate = .T.
	Height = 248
	HelpContextID = 138
	lnonewask = .T.
	Name = "frmcsreconchg"
	Width = 362
	cmdatamanager.Name = "cmdatamanager"
	cmlookupmanager.Name = "cmlookupmanager"

	ADD OBJECT 'cmdChangeDate' AS cmdcommandbuttoncustom WITH ;
		Caption = "\<Change Date", ;
		Height = 29, ;
		Left = 98, ;
		Name = "cmdChangeDate", ;
		TabIndex = 8, ;
		Top = 207, ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'cmdExit' AS cmdcommandbuttoncustom WITH ;
		Caption = "E\<xit", ;
		Height = 29, ;
		Left = 190, ;
		Name = "cmdExit", ;
		TabIndex = 9, ;
		Top = 207, ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'lblAcct' AS lbllabelcustom WITH ;
		Caption = "Account No", ;
		Left = 86, ;
		Name = "lblAcct", ;
		Top = 81
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblAcctDesc' AS lbllabelcustom WITH ;
		Caption = "lblAcctDesc", ;
		Left = 172, ;
		Name = "lblAcctDesc", ;
		TabIndex = 11, ;
		Top = 109
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbltextcustom1' AS lbltextcustom WITH ;
		Caption = "Reconciliation Date:", ;
		Left = 49, ;
		Name = "Lbltextcustom1", ;
		Top = 50
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbltextcustom2' AS lbltextcustom WITH ;
		Caption = "Change To:", ;
		Left = 88, ;
		Name = "Lbltextcustom2", ;
		TabIndex = 5, ;
		Top = 144
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Swlookupbutton1' AS swlookupbutton WITH ;
		Left = 146, ;
		Name = "Swlookupbutton1", ;
		TabIndex = 4, ;
		Top = 48
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'txtcAcctNo' AS txttextboxcustom WITH ;
		BackColor = 212,208,200, ;
		Enabled = .T., ;
		Format = "", ;
		Height = 20, ;
		Left = 172, ;
		Name = "txtcAcctNo", ;
		TabIndex = 6, ;
		Top = 78, ;
		Width = 85
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtdDate1' AS txttextboxcustom WITH ;
		BackColor = 212,208,200, ;
		Enabled = .T., ;
		Format = "D", ;
		Height = 20, ;
		Left = 172, ;
		Name = "txtdDate1", ;
		Top = 48, ;
		Width = 85
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtdDate2' AS dpk WITH ;
		ControlSource = "", ;
		Height = 20, ;
		Left = 172, ;
		lmorethan90 = .T., ;
		Name = "txtdDate2", ;
		TabIndex = 7, ;
		Top = 142, ;
		Visible = .T., ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\swdate.vcx" BaseClass="textbox" />
	
	PROCEDURE Activate
		IF DODEFAULT()
		    IF NOT m.goApp.lAMVersion
		        THISFORM.txtcacctno.VISIBLE = .F.
		        THISFORM.lblacctdesc.VISIBLE = .F.
		        thisform.lblacct.visible = .f.
		    ELSE
		        THISFORM.txtcacctno.VISIBLE = .T.
		        THISFORM.lblacctdesc.VISIBLE = .T.
		        thisform.lblacct.visible = .t.
		    ENDIF
		ENDIF
		
	ENDPROC

	PROCEDURE cmdChangeDate.Click
		LOCAL ldDate1, ldDate2
		ldDate1 = THISFORM.txtDdate1.VALUE
		ldDate2 = THISFORM.txtDdate2.VALUE
		
		IF NOT m.goapp.lAMVersion &&  Disbursement Manager, so don't confirm acctno
		   IF THISFORM.oMessage.CONFIRM('Are you sure you want to switch the reconciliation for ' + DTOC(THISFORM.txtDdate1.VALUE) +  ;
		         ' to ' + DTOC(THISFORM.txtDdate2.VALUE) + '?')
		      SELECT checkrec
		      LOCATE FOR drecdate = ldDate1
		      IF FOUND()
		         REPLACE drecdate WITH ldDate2
		         SELECT checks
		         REPLACE drecdate WITH ldDate2 FOR drecdate = ldDate1
		         thisform.txtdDate1.set('value',ldDate2)
		         thisform.oMessage.display('Reconciliation changed successfully.')
		         SELECT checkrec
		         =TABLEUPDATE()
		      ELSE  &&  Should never get here
		         THISFORM.oMessage.warning('Invalid date or account passed...')
		      ENDIF
		   ENDIF
		ELSE
		   IF THISFORM.oMessage.CONFIRM('Are you sure you want to switch the reconciliation for ' + DTOC(THISFORM.txtDdate1.VALUE) +  ;
		         ' to ' + DTOC(THISFORM.txtDdate2.VALUE) + ' for account ' + THISFORM.lcAcctno + '?')
		      SELECT checkrec
		      LOCATE FOR drecdate = ldDate1 AND cacctno = THISFORM.lcAcctno
		      IF FOUND()
		         REPLACE drecdate WITH ldDate2
		         SELECT checks
		         REPLACE drecdate WITH ldDate2 FOR (drecdate = ldDate1 AND cacctno = THISFORM.lcAcctno)
		         thisform.txtdDate1.set('value',ldDate2)
		         thisform.oMessage.display('Reconciliation changed successfully.')
		         SELECT checkrec
		         =TABLEUPDATE()
		      ELSE  &&  Should never get here
		         THISFORM.oMessage.warning('Invalid date or account passed...')
		      ENDIF
		   ENDIF
		ENDIF
		
		
	ENDPROC

	PROCEDURE cmdExit.Click
		thisform.release()
	ENDPROC

	PROCEDURE lblAcctDesc.Init
		IF DODEFAULT()
		   SELECT checkrec
		   SET ORDER TO drecdate
		   GO BOTT
		   lcAcctNo = cAcctNo
		   SELE coa
		   LOCATE FOR cAcctNo = lcAcctNo
		   IF FOUND()
		      this.caption = cacctdesc
		   ELSE
		      this.caption = 'Unknown'
		   ENDIF      
		ENDIF
		
	ENDPROC

	PROCEDURE Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		IF NOT m.goApp.lAMVersion  &&  Disbursement Manager Only
		    llOK = .T.
		    lcList = 'drecdate,nopenbal,nendbal'
		    SELE checkrec
		    SET ORDER TO reckey ASCE
		
		    DO FORM ..\CUSTOM\picklist WITH 'Checkrec', lcList, THISFORM.txtdDate1.VALUE, 3
		
		    IF llOK
		        THISFORM.txtdDate1.SET('value',checkrec.drecdate)
		    ENDIF
		
		ELSE  &&  Accounting Manager
		    llOK = .T.
		    lcList = 'drecdate,cacctno,nopenbal,nendbal'
		    SELE checkrec
		    SET ORDER TO reckey ASCE
		
		    DO FORM ..\CUSTOM\picklist WITH 'Checkrec', lcList, THISFORM.txtdDate1.VALUE, 4
		
		    IF llOK
		        THISFORM.txtdDate1.SET('value',checkrec.drecdate)
		        THISFORM.lcacctno = checkrec.cacctno
		        THISFORM.txtcacctno.SET('value',checkrec.cacctno)
		        SELE coa
		        LOCATE FOR cacctno = THISFORM.lcacctno
		        IF FOUND()
		            THISFORM.lblacctdesc.CAPTION = cacctdesc
		        ELSE
		            THISFORM.lblacctdesc.CAPTION = 'Unknown'
		        ENDIF
		    ENDIF
		ENDIF
		
	ENDPROC

	PROCEDURE txtcAcctNo.Init
		IF DODEFAULT()
		   SELECT checkrec
		   SET ORDER TO drecdate
		   GO BOTT
		   THIS.VALUE = checkrec.cacctno
		   THISFORM.lcacctno = checkrec.cacctno
		ENDIF
		
	ENDPROC

	PROCEDURE txtcAcctNo.When
		return .f.
	ENDPROC

	PROCEDURE txtdDate1.Init
		IF DODEFAULT()
		   SELECT checkrec
		   SET ORDER TO drecdate
		   GO BOTT
		   THIS.VALUE = checkrec.drecdate
		ENDIF
		
	ENDPROC

	PROCEDURE txtdDate1.When
		return .f.
	ENDPROC

	PROCEDURE txtdDate2.dropdown
		DODEFAULT()
		thisform.setnextcontrol(this)
		
	ENDPROC

ENDDEFINE
