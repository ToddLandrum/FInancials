*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="dmroytd.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor8" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 347
	Left = 40
	Name = "Dataenvironment"
	Top = 235
	Width = 567

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "investor", ;
		CursorSource = "investor", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 9, ;
		Name = "Cursor1", ;
		Top = 16, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "disbhist", ;
		CursorSource = "disbhist", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "options", ;
		CursorSource = "options", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "wells", ;
		CursorSource = "wells", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor4", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor5' AS cursor WITH ;
		Alias = "wellhist", ;
		CursorSource = "wellhist", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor5", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor6' AS cursor WITH ;
		Alias = "welltots", ;
		BufferModeOverride = 5, ;
		CursorSource = "welltots", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor6", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor7' AS cursor WITH ;
		Alias = "owntots", ;
		BufferModeOverride = 5, ;
		CursorSource = "owntots", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor7", ;
		Top = 260, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor8' AS cursor WITH ;
		Alias = "wellinv", ;
		CursorSource = "wellinv", ;
		Database = ..\newdbc\appdata.dbc, ;
		Height = 90, ;
		Left = 430, ;
		Name = "Cursor8", ;
		Top = 140, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formdmroytd AS frmrptcriteria OF "..\source\appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="chkSepOwner" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkShowNet" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="swByWhat" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblEndWell" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblBegWell" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblEndID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblBegID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkSelected" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblSelected" UniqueID="" Timestamp="" />

	Caption = "Owner YTD and ITD Totals"
	DoCreate = .T.
	Height = 477
	HelpContextID = 225
	Name = "FormDmroytd"
	Width = 444
	Swrptcriteriabuttons1.chkExport.Alignment = 0
	Swrptcriteriabuttons1.chkExport.Name = "chkExport"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.CMDPREVIEW.Name = "CMDPREVIEW"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 88
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.TabIndex = 11
	Swrptcriteriabuttons1.Top = 400
	Swrptcriteriabuttons1.ZOrderSet = 0

	ADD OBJECT 'chkSelected' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Choose Selected Owners", ;
		Left = 138, ;
		Name = "chkSelected", ;
		TabIndex = 3, ;
		Top = 92, ;
		Value = .F.
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkSepOwner' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Start a New Page for Each Owner", ;
		Height = 16, ;
		Left = 137, ;
		Name = "chkSepOwner", ;
		TabIndex = 9, ;
		Top = 339, ;
		Width = 184, ;
		ZOrderSet = 1
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkShowNet' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Show Net Revenue Received", ;
		Height = 16, ;
		Left = 137, ;
		Name = "chkShowNet", ;
		TabIndex = 10, ;
		Top = 364, ;
		Width = 160, ;
		ZOrderSet = 2
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'lblBegID' AS lbllabelcustom WITH ;
		Caption = "First Owner:", ;
		Height = 16, ;
		Left = 64, ;
		Name = "lblBegID", ;
		TabIndex = 5, ;
		Top = 115, ;
		Width = 63, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblBegWell' AS lbllabelcustom WITH ;
		Caption = "Beginning Well:", ;
		Height = 16, ;
		Left = 52, ;
		Name = "lblBegWell", ;
		TabIndex = 12, ;
		Top = 229, ;
		Visible = .T., ;
		Width = 75, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblEndID' AS lbllabelcustom WITH ;
		Caption = "Last Owner:", ;
		Height = 16, ;
		Left = 64, ;
		Name = "lblEndID", ;
		TabIndex = 6, ;
		Top = 167, ;
		Width = 63, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblEndWell' AS lbllabelcustom WITH ;
		Caption = "Ending Well:", ;
		Height = 16, ;
		Left = 67, ;
		Name = "lblEndWell", ;
		TabIndex = 13, ;
		Top = 279, ;
		Visible = .T., ;
		Width = 60, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom1' AS lbllabelcustom WITH ;
		Caption = "Report By:", ;
		Height = 16, ;
		Left = 74, ;
		Name = "Lbllabelcustom1", ;
		TabIndex = 2, ;
		Top = 18, ;
		Width = 53, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblSelected' AS lbllabelcustom WITH ;
		Caption = "All Owners Selected", ;
		ForeColor = 0,0,255, ;
		Left = 156, ;
		Name = "lblSelected", ;
		TabIndex = 7, ;
		Top = 150, ;
		Visible = .F.
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'swByWhat' AS swrptownerid_ownername WITH ;
		Left = 132, ;
		Name = "swByWhat", ;
		TabIndex = 1, ;
		Top = 12, ;
		ZOrderSet = 3, ;
		OwnerID.Left = 5, ;
		OwnerID.Name = "OwnerID", ;
		OwnerID.Top = 5, ;
		OwnerID.Value = 1, ;
		OwnerName.Left = 5, ;
		OwnerName.Name = "OwnerName", ;
		OwnerName.Top = 28
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 137, ;
		Name = "Swrptlook1", ;
		TabIndex = 4, ;
		Top = 112, ;
		ZOrderSet = 3, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		txtBegID.clistexpression = investor.cownerid, ;
		txtBegID.clistworkarea = investor, ;
		txtBegID.Name = "txtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		txtEndID.clistexpression = investor.cownerid, ;
		txtEndID.clistworkarea = investor, ;
		txtEndID.Name = "txtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />

	ADD OBJECT 'Swrptlook2' AS swrptlook WITH ;
		Left = 137, ;
		Name = "Swrptlook2", ;
		TabIndex = 8, ;
		Top = 225, ;
		Visible = .T., ;
		ZOrderSet = 3, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		txtBegID.clistexpression = wells.cwellid, ;
		txtBegID.clistworkarea = wells, ;
		txtBegID.Name = "txtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		txtEndID.clistexpression = wells.cwellid, ;
		txtEndID.clistworkarea = wells, ;
		txtEndID.Name = "txtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />
	
	PROCEDURE builddata
		LOCAL tcOwner1, tcOwner2, tntnByWhat, tlShowNet, tlSepOwner, tcWell1, tcWell2
		LOCAL llReturn, loError
		LOCAL lDirTot
		LOCAL tcYear, tnByWhat
		
		llReturn = .T.
		
		TRY
		   swclose('ownertot')
		   swclose('ownertot1')
		
		   tcOwner1   = THISFORM.swrptlook1.txtBegID.VALUE
		   tcOwner2   = THISFORM.swrptlook1.txtEndID.VALUE
		   tcWell1    = THISFORM.swrptlook2.txtBegID.VALUE
		   tcWell2    = THISFORM.swrptlook2.txtEndID.VALUE
		   tnByWhat   = THISFORM.swByWhat.VALUE
		   tlShowNet  = THISFORM.chkShowNet.VALUE
		   tlSepOwner = THISFORM.chkSepOwner.VALUE
		   llSelected  = THISFORM.chkselected.VALUE
		
		   IF NOT llSelected
		      SELECT cownerid AS cid FROM investor ;
		         INTO CURSOR SELECTED ;
		         WHERE BETWEEN(cownerid,tcOwner1,tcOwner2) ;
		         ORDER BY cid
		   ENDIF
		
		   THISFORM.cSelectCriteria = 'Owners: ' + ALLTRIM(tcOwner1) + ' - ' + ALLTRIM(tcOwner2)
		
		   WAIT WIND NOWAIT 'Processing Report Request....Please Wait.'
		
		   tcYear = STR(YEAR(DATE()), 4)
		*   IF THISFORM.oMessage.CONFIRM('Should the YTD and ITD totals be recalculated before the report is run?')
		   llReturn = Calcytditd(DATE(), '**', .T.)
		   IF NOT llReturn
		      EXIT
		   ENDIF
		*   ENDIF
		
		   swselect('options')
		   m.lDirTot = lDirTot
		
		   SELECT  owntots.*, SPACE(10) AS cPageBreak, SPACE(40) AS cWellName, 000.0000000 AS nWorkInt, investor.csortfield AS cownname, m.lDirTot AS lDirTot ;
		      FROM owntots, investor  ;
		      WHERE owntots.cownerid IN (SELECT cid FROM SELECTED) ;
		      AND owntots.cownerid = investor.cownerid ;
		      AND BETWEEN(owntots.cWellID, tcWell1, tcWell2)  ;
		      INTO CURSOR ownertot READWRITE  ;
		      ORDER BY owntots.cownerid, owntots.cWellID
		
		   SELE ownertot
		   SCAN
		      swselect('wellinv')
		      LOCA FOR cownerid = ownertot.cownerid AND cWellID = ownertot.cWellID  ;
		         AND cTypeInv = ownertot.cTypeInv
		      IF FOUND()
		         IF wellinv.nRevOil <> 0
		            REPLACE ownertot.nWorkInt WITH wellinv.nRevOil
		         ELSE
		            REPLACE ownertot.nWorkInt WITH wellinv.nRevGas
		         ENDIF
		      ELSE
		         REPLACE ownertot.nWorkInt WITH 000.0000000
		      ENDIF
		      SELE wells
		      LOCA FOR cWellID = ownertot.cWellID
		      IF FOUND()
		         REPL ownertot.cWellName WITH cWellName
		      ELSE
		         SELECT ownertot
		         REPL ownertot.cWellName WITH 'Unknown Well'
		      ENDIF
		   ENDSCAN
		
		   DO CASE
		      CASE tnByWhat = 1    && owner id
		         THISFORM.cSortOrder = 'Owner ID'
		         SELECT ownertot
		         INDEX ON cownerid + cWellID TAG rptorder
		      CASE tnByWhat = 2    && owner name
		         THISFORM.cSortOrder = 'Owner Name'
		         SELECT ownertot
		         INDEX ON cownname + cWellID TAG rptorder
		   ENDCASE
		
		   DO CASE
		      CASE NOT tlShowNet
		         THISFORM.cReportName = 'dmrowntot1'
		      CASE tlShowNet
		         THISFORM.cReportName = 'dmrowntot3'
		   ENDCASE
		
		   IF tlSepOwner
		      SELECT ownertot
		      REPLACE cPageBreak WITH cownerid ALL
		   ENDIF
		
		   THISFORM.cTitle1 = 'Owner Production Totals'
		   THISFORM.cTitle2 = 'Year-to-Date and Inception-to-Date'
		
		* Change the interests to decimal interests if preference set
		   llReturn = DecimalInts('ownertot')
		
		   SELECT ownertot
		   IF RECC() > 0
		      llReturn = .T.
		   ELSE
		      llReturn = .F.
		   ENDIF
		CATCH TO loError
		   llReturn = .F.
		   DO errorlog WITH 'BuildData', loError.LINENO, 'Owner YTD/ITD Report', loError.ERRORNO, loError.MESSAGE
		   MESSAGEBOX('Unable to process the report at this time. Check the System Log found under Other Reports for more information.' + CHR(10) + CHR(10) + ;
		      'Contact SherWare Support for help at support@sherware.com', 16, 'Problem Encountered')
		ENDTRY
		
		* Reset the global cancel flag in case we canceled.
		m.goApp.lCanceled = .F.
		
		RETURN llReturn
		
		
	ENDPROC

	PROCEDURE Init
		IF DODEFAULT()
		   SELECT investor
		   SET ORDER TO cownerid
		   GO TOP
		
		   THISFORM.swrptlook1.txtBegName.VALUE = cownname
		   THISFORM.swrptlook1.txtBegID.VALUE = cownerid
		   GO BOTTOM
		
		   THISFORM.swrptlook1.txtEndName.VALUE = cownname
		   THISFORM.swrptlook1.txtEndID.VALUE = cownerid
		   
		   SELECT wells
		   SET ORDER to cwellid
		   GO top
		   thisform.swrptlook2.txtBegID.Value = cwellid
		   thisform.swrptlook2.txtBegName.Value = cwellname
		   
		   GO bott
		   thisform.swrptlook2.txtEndID.Value = cwellid
		   thisform.swrptlook2.txtEndName.Value = cwellname
		
		   THISFORM.chkSepOwner.VALUE = .F.
		   THISFORM.chkShowNet.VALUE  = .F.
		
		ENDIF
		
	ENDPROC

	PROCEDURE chkSelected.Click
		IF this.Value
		   DO FORM commonsource\selected-ids WITH 'OWNER' LINKED 
		   lnCount = RECCOUNT('selected')
		   thisform.lblselected.Caption = TRANSFORM(lnCount) + ' Owners Selected'
		   thisform.lblselected.Visible = .T.
		   thisform.lblbegID.Visible = .F.
		   thisform.lblendID.Visible = .F.
		   thisform.swrptlook1.Visible = .F.
		ELSE
		   thisform.lblselected.Visible = .F.
		   thisform.lblbegID.Visible = .T.
		   thisform.lblendID.Visible = .T.
		   thisform.swrptlook1.Visible = .T.
		ENDIF 
	ENDPROC

	PROCEDURE swByWhat.OwnerID.GotFocus
		THIS.VALUE = 1
		
	ENDPROC

	PROCEDURE swByWhat.OwnerName.GotFocus
		THIS.VALUE = 2
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cownerid,csortfield'
		
		DO FORM ..\custom\picklist WITH 'Investor', lcList, thisform.swrptlook1.txtbegid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtBegId.value = cOwnerID
		   thisform.swrptlook1.txtBegName.value = cOwnname
		   thisform.swrptlook1.txtBegId.refresh()
		   thisform.swrptlook1.txtBegName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(thisform.swrptlook1.txtBegId)
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cownerid,csortfield'
		
		DO FORM ..\custom\picklist WITH 'Investor', lcList, thisform.swrptlook1.txtendid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtEndId.value = cOwnerID
		   thisform.swrptlook1.txtEndName.value = cOwnname
		   thisform.swrptlook1.txtEndId.refresh()
		   thisform.swrptlook1.txtEndName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(thisform.swrptlook1.txtEndId)
		
	ENDPROC

	PROCEDURE Swrptlook2.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		
		lcList = 'cwellid,cwellname'
		
		DO FORM ..\CUSTOM\picklist WITH 'Wells', lcList, 'cwellid', 2
		
		IF llok  &&  If an owner/vendor was selected
		   thisform.swrptlook2.txtbegid.value = cwellid
		   thisform.swrptlook2.txtbegname.value = cwellname
		   thisform.swrptlook2.txtbegid.refresh()
		   thisform.swrptlook2.txtbegname.refresh()
		ENDIF   
		
		
	ENDPROC

	PROCEDURE Swrptlook2.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		
		lcList = 'cwellid,cwellname'
		
		DO FORM ..\CUSTOM\picklist WITH 'Wells', lcList, 'cwellid', 2
		
		IF llok  &&  If an owner/vendor was selected
		   thisform.swrptlook2.txtendid.value = cwellid
		   thisform.swrptlook2.txtendname.value = cwellname
		   thisform.swrptlook2.txtendid.refresh()
		   thisform.swrptlook2.txtendname.refresh()
		ENDIF   
		
		
	ENDPROC

	PROCEDURE Swrptlook2.txtBegID.GotFocus
		ON KEY LABEL F2 _screen.activeform.swrptlook2.swlookupbutton1.Click()
		
	ENDPROC

	PROCEDURE Swrptlook2.txtEndID.GotFocus
		ON KEY LABEL F2 _screen.activeform.swrptlook2.swlookupbutton1.Click()
		
	ENDPROC

ENDDEFINE
