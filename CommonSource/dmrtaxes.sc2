*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="dmrtaxes.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor7" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 475
	Left = 47
	Name = "Dataenvironment"
	Top = 409
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "groups", ;
		CursorSource = "groups", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "wells", ;
		CursorSource = "wells", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "wellhist", ;
		CursorSource = "wellhist", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "sevtax", ;
		CursorSource = "sevtax", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor4", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor5' AS cursor WITH ;
		Alias = "options", ;
		CursorSource = "options", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor5", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor6' AS cursor WITH ;
		Alias = "sysctl", ;
		CursorSource = "sysctl", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor6", ;
		Top = 140, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor7' AS cursor WITH ;
		Alias = "income", ;
		CursorSource = "income", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor7", ;
		Top = 260, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formdmrtaxes AS frmrptcriteria OF "..\source\appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="LblBegPeriod" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblEndPeriod" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="opgReportBy" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swyear1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swyear2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swperiod1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swperiod2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="OpgQuarters" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swgroup1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblBegYear" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblEndYear" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblBegID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblEndID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblGroup" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="swstates" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkProdPeriod" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cboTaxType" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkNoTable" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkExcludeNoProd" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkAPINo" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkSelected" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblSelected" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: calctax1		&& Calculates tax 1
		*m: calctax1qtr		&& Calculate tax 1 by quarter
		*m: calctax2		&& calculate taxes 2
		*m: calctax2qtr		&& Calculate tax 2 by quarter
		*m: calctax3		&& Calculates tax 3
		*m: calctax3qtr		&& Calculates Tax 3 by Quarter
		*m: calctax4		&& Calculates Tax 4
		*m: calctax4qtr		&& Calculates Tax 4 by Quarter
		*p: ctaxtype		&& Tax Type parameter passed to the form.
		*p: odist		&& Distproc object holder
		*p: owellinv
	*</DefinedPropArrayMethod>

	Caption = "Severance/Production Tax Reports"
	DoCreate = .T.
	Height = 576
	HelpContextID = 597
	Name = "FormDmrtaxes"
	owellinv = .NULL.
	Width = 476
	_memberdata = <VFPData>
		<memberdata name="owellinv" display="oWellInv"/>
		</VFPData>
	Swrptcriteriabuttons1.chkExport.Alignment = 0
	Swrptcriteriabuttons1.chkExport.Name = "chkExport"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.cmdPreview.Name = "cmdPreview"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 110
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.TabIndex = 28
	Swrptcriteriabuttons1.Top = 501
	Swrptcriteriabuttons1.ZOrderSet = 1

	ADD OBJECT 'cboTaxType' AS cbocomboboxcustom WITH ;
		BoundColumn = 2, ;
		Height = 20, ;
		Left = 288, ;
		Name = "cboTaxType", ;
		TabIndex = 2, ;
		Top = 20, ;
		Width = 108
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="combobox" />

	ADD OBJECT 'chkAPINo' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		AutoSize = .T., ;
		Caption = "Include API No", ;
		Height = 16, ;
		Left = 70, ;
		Name = "chkAPINo", ;
		TabIndex = 9, ;
		Top = 129, ;
		Value = .F., ;
		Width = 86, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkExcludeNoProd' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		AutoSize = .T., ;
		Caption = "Exclude Wells With No Production During Period", ;
		Height = 16, ;
		Left = 70, ;
		Name = "chkExcludeNoProd", ;
		TabIndex = 12, ;
		Top = 215, ;
		Value = .T., ;
		Width = 246, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkNoTable' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		AutoSize = .T., ;
		Caption = "Include Taxes Withheld by Purchaser (Not From a Tax Table)", ;
		Height = 16, ;
		Left = 70, ;
		Name = "chkNoTable", ;
		TabIndex = 11, ;
		Top = 187, ;
		Value = .F., ;
		Width = 307, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkProdPeriod' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		AutoSize = .T., ;
		Caption = "Use Production Period as Selection Criteria. Otherwise, report is based on accounting date from the Well History file.", ;
		Height = 30, ;
		Left = 70, ;
		Name = "chkProdPeriod", ;
		TabIndex = 10, ;
		Top = 151, ;
		Width = 317, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkSelected' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Choose Selected Wells", ;
		Left = 159, ;
		Name = "chkSelected", ;
		TabIndex = 21, ;
		Top = 323, ;
		Value = .F.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'lblBegID' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "First Well:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 93, ;
		Name = "lblBegID", ;
		TabIndex = 23, ;
		Top = 356, ;
		Width = 49, ;
		ZOrderSet = 16
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblBegPeriod' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Period:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 214, ;
		Name = "LblBegPeriod", ;
		TabIndex = 16, ;
		Top = 255, ;
		Visible = .F., ;
		Width = 35, ;
		ZOrderSet = 2
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblBegYear' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Year:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 113, ;
		Name = "LblBegYear", ;
		TabIndex = 15, ;
		Top = 255, ;
		Width = 29, ;
		ZOrderSet = 14
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblEndID' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Last Well:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 93, ;
		Name = "lblEndID", ;
		TabIndex = 25, ;
		Top = 408, ;
		Width = 49, ;
		ZOrderSet = 17
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblEndPeriod' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Period:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 214, ;
		Name = "LblEndPeriod", ;
		TabIndex = 20, ;
		Top = 279, ;
		Visible = .F., ;
		Width = 35, ;
		ZOrderSet = 3
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblEndYear' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Ending Year:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 78, ;
		Name = "LblEndYear", ;
		TabIndex = 19, ;
		Top = 279, ;
		Visible = .F., ;
		Width = 64, ;
		ZOrderSet = 15
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblGroup' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Group:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 107, ;
		Name = "LblGroup", ;
		TabIndex = 27, ;
		Top = 457, ;
		Width = 35, ;
		ZOrderSet = 18
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom1' AS lbllabelcustom WITH ;
		BackStyle = 1, ;
		Caption = "Report By", ;
		FontBold = .T., ;
		Left = 132, ;
		Name = "Lbllabelcustom1", ;
		TabIndex = 5, ;
		Top = 51
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom2' AS lbllabelcustom WITH ;
		BackStyle = 1, ;
		Caption = "Quarter", ;
		FontBold = .T., ;
		Left = 50, ;
		Name = "Lbllabelcustom2", ;
		TabIndex = 7, ;
		Top = 84
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom3' AS lbllabelcustom WITH ;
		Caption = "Well Product Tax Table:", ;
		Left = 42, ;
		Name = "Lbllabelcustom3", ;
		TabIndex = 3, ;
		Top = 22
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom4' AS lbllabelcustom WITH ;
		Caption = "Tax Type", ;
		Left = 235, ;
		Name = "Lbllabelcustom4", ;
		TabIndex = 4, ;
		Top = 22
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblSelected' AS lbllabelcustom WITH ;
		Caption = "All Owners Selected", ;
		ForeColor = 0,0,255, ;
		Left = 177, ;
		Name = "lblSelected", ;
		TabIndex = 24, ;
		Top = 381, ;
		Visible = .F.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'OpgQuarters' AS opgoptiongroupcustom WITH ;
		BorderStyle = 1, ;
		ButtonCount = 4, ;
		Height = 35, ;
		Left = 43, ;
		Name = "OpgQuarters", ;
		TabIndex = 8, ;
		Top = 90, ;
		Width = 373, ;
		Option1.AutoSize = .T., ;
		Option1.Caption = "1st (Jan - Mar)", ;
		Option1.FontSize = 8, ;
		Option1.Height = 16, ;
		Option1.Left = 5, ;
		Option1.Name = "Q1", ;
		Option1.Top = 11, ;
		Option1.Width = 89, ;
		Option2.AutoSize = .T., ;
		Option2.Caption = "2nd (Apr - Jun)", ;
		Option2.FontSize = 8, ;
		Option2.Height = 16, ;
		Option2.Left = 96, ;
		Option2.Name = "Q2", ;
		Option2.Top = 11, ;
		Option2.Width = 92, ;
		Option3.AutoSize = .T., ;
		Option3.Caption = "3rd (Jul - Sep)", ;
		Option3.FontSize = 8, ;
		Option3.Height = 16, ;
		Option3.Left = 192, ;
		Option3.Name = "Q3", ;
		Option3.Top = 11, ;
		Option3.Width = 87, ;
		Option4.AutoSize = .T., ;
		Option4.Caption = "4th (Oct - Dec)", ;
		Option4.FontSize = 8, ;
		Option4.Height = 16, ;
		Option4.Left = 281, ;
		Option4.Name = "Q4", ;
		Option4.Top = 11, ;
		Option4.Width = 90
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'opgReportBy' AS opgoptiongroupcustom WITH ;
		ButtonCount = 2, ;
		Height = 36, ;
		Left = 126, ;
		Name = "opgReportBy", ;
		TabIndex = 6, ;
		Top = 57, ;
		Width = 184, ;
		Option1.AutoSize = .T., ;
		Option1.Caption = "Quarter", ;
		Option1.FontSize = 8, ;
		Option1.Height = 16, ;
		Option1.Left = 11, ;
		Option1.Name = "Option1", ;
		Option1.Top = 12, ;
		Option1.Width = 55, ;
		Option2.AutoSize = .T., ;
		Option2.Caption = "Period Range", ;
		Option2.FontSize = 8, ;
		Option2.Height = 16, ;
		Option2.Left = 88, ;
		Option2.Name = "Option2", ;
		Option2.Top = 12, ;
		Option2.Width = 82
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'Swgroup1' AS swgroup WITH ;
		Left = 157, ;
		Name = "Swgroup1", ;
		TabIndex = 26, ;
		Top = 455, ;
		ZOrderSet = 12
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="combobox" />

	ADD OBJECT 'Swperiod1' AS swperiod WITH ;
		Height = 20, ;
		Left = 256, ;
		MaxLength = 2, ;
		Name = "Swperiod1", ;
		TabIndex = 14, ;
		Top = 253, ;
		Visible = .F., ;
		Width = 24, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'Swperiod2' AS swperiod WITH ;
		Height = 20, ;
		Left = 256, ;
		MaxLength = 2, ;
		Name = "Swperiod2", ;
		TabIndex = 18, ;
		Top = 277, ;
		Visible = .F., ;
		Width = 24, ;
		ZOrderSet = 8
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 157, ;
		Name = "Swrptlook1", ;
		TabIndex = 22, ;
		Top = 351, ;
		ZOrderSet = 5, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		txtBegID.clistexpression = wells.cwellid, ;
		txtBegID.clistworkarea = wells, ;
		txtBegID.Name = "txtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		txtEndID.clistexpression = wells.cwellid, ;
		txtEndID.clistworkarea = wells, ;
		txtEndID.Name = "txtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />

	ADD OBJECT 'swstates' AS cbocomboboxcustom WITH ;
		BoundColumn = 1, ;
		BoundTo = .F., ;
		ColumnCount = 1, ;
		ControlSource = "", ;
		FontName = "Courier New", ;
		Height = 20, ;
		Left = 158, ;
		Margin = 2, ;
		Name = "swstates", ;
		RowSource = "", ;
		RowSourceType = 0, ;
		TabIndex = 1, ;
		Top = 20, ;
		Width = 45
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="combobox" />

	ADD OBJECT 'Swyear1' AS swyear WITH ;
		Height = 20, ;
		Left = 157, ;
		MaxLength = 4, ;
		Name = "Swyear1", ;
		TabIndex = 13, ;
		Top = 253, ;
		Width = 40, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'Swyear2' AS swyear WITH ;
		Height = 20, ;
		Left = 157, ;
		MaxLength = 4, ;
		Name = "Swyear2", ;
		TabIndex = 17, ;
		Top = 277, ;
		Visible = .F., ;
		Width = 40, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="textbox" />
	
	PROCEDURE builddata
		LOCAL tcPeriod, tcYear, tcGroup, tcWellID1, tcWellID2, tlProdPeriod
		publ ln3rdParty
		*  These parms don't matter. They just need to be setup
		*  to instantiate the distproc object
		tcYear    = thisform.swyear1.value
		tcPeriod  = thisform.swperiod1.value
		tcWellID1 = wells.cwellid
		tcWellID2 = wells.cwellid
		tcGroup   = LEFT(thisform.swGroup1.value,2)
		tcYear2   = thisform.swyear2.value
		tcPeriod2 = thisform.swPeriod2.value
		tcState    = left(thisform.swStates.value,2)
		tlProdPeriod = thisform.chkProdPeriod.value
		tlNoTable = thisform.chkNoTable.value
		
		lcTax1Desc = ''  &&  Blanked out, but not removed since they're used later - BH 8-6-03
		lcTax2Desc = ''
		lcTax3Desc = ''
		lcTax4Desc = ''
		
		THISFORM.cTaxType = thisform.cboTaxType.value
		
		select wells
		count for wells.lthird_prty AND between(wells.cWellID,tcWellID1,tcWellID2) AND iif(tcGroup <> '**',wells.cGroup = tcGroup,.t.) to ln3rdParty
		
		*
		*  Check to see which type of tax we're reporting on
		*
		DO CASE
		   CASE thisform.cTaxType = '1'   && Severance Tax
		      *
		      *  Check to see if we're reporting by quarter or period
		      *   
		      DO CASE
		         CASE thisform.opgReportBy.value = 1       && Quarter
		            thisform.calctax1qtr()
		            thisform.cTitle1 = 'Quarterly Report for Tax ' + thisform.ctaxtype
		            thisform.cTitle2 = 'For Year ' + tcYear + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            IF thisform.chkapINo.value
		               thisform.cReportName = 'commonsource\dmrtaxqtrp'
		            ELSE
		               thisform.cReportName = 'commonsource\dmrtaxqtr'
		            ENDIF    
		            
		         CASE thisform.opgReportBy.value = 2
		            thisform.calctax1()
		            thisform.cTitle1 = 'Report for Tax ' + thisform.ctaxtype + ' By Well'
		            if tlProdPeriod
		               thisform.cTitle2 = 'For Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            else
		               thisform.cTitle2 = 'For Accounting Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            endif
		            thisform.cReportName = 'commonsource\dmrtaxprd'
		            
		      ENDCASE
		   
		   CASE thisform.cTaxType = '2'   && Production Tax
		      *
		      *  Check to see if we're reporting by quarter or period
		      *   
		      DO CASE
		         CASE thisform.opgReportBy.value = 1       && Quarter
		            thisform.calctax2qtr()      
		            thisform.cTitle1 = 'Quarterly Report for Tax ' + thisform.ctaxtype
		            thisform.cTitle2 = 'For Year ' + tcYear + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            thisform.cReportName = 'commonsource\dmrtaxqtr'
		            
		         CASE thisform.opgReportBy.value = 2
		            thisform.calctax2()
		            thisform.cTitle1 = 'Report for Tax ' + thisform.ctaxtype + ' By Well'
		            if tlProdPeriod
		               thisform.cTitle2 = 'For Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            else
		               thisform.cTitle2 = 'For Accounting Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            endif
		            thisform.cReportName = 'commonsource\dmrtaxprd'
		            
		      ENDCASE
		      
		      CASE thisform.cTaxType = '3'   && Tax 3
		      *
		      *  Check to see if we're reporting by quarter or period
		      *   
		      DO CASE
		         CASE thisform.opgReportBy.value = 1       && Quarter
		            thisform.calctax3qtr()      
		            thisform.cTitle1 = 'Quarterly Report for Tax ' + thisform.ctaxtype
		            thisform.cTitle2 = 'For Year ' + tcYear + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            thisform.cReportName = 'commonsource\dmrtaxqtr'
		            
		         CASE thisform.opgReportBy.value = 2
		            thisform.calctax3()
		            thisform.cTitle1 = 'Report for Tax ' + thisform.ctaxtype + ' By Well'
		            if tlProdPeriod
		               thisform.cTitle2 = 'For Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            else
		               thisform.cTitle2 = 'For Accounting Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            endif
		            thisform.cReportName = 'commonsource\dmrtaxprd'
		            
		      ENDCASE
		   
		      CASE thisform.cTaxType = '4'   && Tax 4
		      *
		      *  Check to see if we're reporting by quarter or period
		      *   
		      DO CASE
		         CASE thisform.opgReportBy.value = 1       && Quarter
		            thisform.calctax4qtr()      
		            thisform.cTitle1 = 'Quarterly Report for Tax ' + thisform.ctaxtype
		            thisform.cTitle2 = 'For Year ' + tcYear + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            thisform.cReportName = 'commonsource\dmrtaxqtr'
		            
		         CASE thisform.opgReportBy.value = 2
		            thisform.calctax4()
		            thisform.cTitle1 = 'Report for Tax ' + thisform.ctaxtype + ' By Well'
		            if tlProdPeriod
		               thisform.cTitle2 = 'For Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            else
		               thisform.cTitle2 = 'For Accounting Period Range ' + tcPeriod+'/'+tcYear + ' through ' + tcPeriod2+'/'+tcYear2 + iif(tcState<>'**',' For Tax Table ' + tcState,' For All Tax Tables')
		            endif
		            thisform.cReportName = 'commonsource\dmrtaxprd'
		            
		      ENDCASE
		   
		ENDCASE   
		
		SELECT taxtemp
		IF RECC() > 0
		   RETURN .T.
		ELSE
		   RETURN .F.
		ENDIF      
	ENDPROC

	PROCEDURE calctax1		&& Calculates tax 1
		LOCAL tcYear1, tcYear2, tcPeriod1, tcPeriod2, tcGroup, tcWell1, tcWell2, tcState
		LOCAL lnMax, lnCount, oProgress
		
		tcYear1   = THISFORM.swyear1.VALUE
		tcYear2   = THISFORM.swyear2.VALUE
		tcPeriod1 = THISFORM.swPeriod1.VALUE
		tcPeriod2 = THISFORM.swPeriod2.VALUE
		tcGroup   = LEFT(THISFORM.swgroup1.VALUE, 2)
		tcWell1   = THISFORM.swrptlook1.txtBegID.VALUE
		tcWell2   = THISFORM.swrptlook1.txtEndID.VALUE
		tcState   = LEFT(THISFORM.swStates.VALUE, 2)
		tlProdPrd = THISFORM.chkProdPeriod.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWell1,tcWell2) ;
		      ORDER BY cid
		ENDIF
		
		
		CREATE CURSOR taxtemp ;
		    (cwellid    C(10), ;
		      cwellname  C(10), ;
		      cpermit1   c(20), ;
		      hyear      C(4), ;
		      hperiod    C(2), ;
		      ngasinc    N(12, 2), ;
		      noilinc    N(12, 2), ;
		      nothinc    N(12, 2), ;
		      ntotbbl    N(12, 4), ;
		      ntotmcf    N(12, 4), ;
		      ntototh    N(12, 4), ;
		      ntotbbltax N(12, 2), ;
		      ntotmcftax N(12, 2), ;
		      ntotothtax N(12, 2))
		
		
		IF tlNoTable
		    IF tlProdPrd
				SELECT  wellhist.cwellid, ;
						wells.cwellname, ;
		            wells.cpermit1, ;
						wellhist.hyear, ;
						wellhist.hperiod, ;
						wellhist.cdeck, ;
						SUM(wellhist.nGrossGas) AS ngasinc, ;
						SUM(wellhist.nGrossOil) AS noilinc, ;
						SUM(wellhist.nothinc) AS nothinc, ;
						SUM(wellhist.ntotbbl) AS ntotbbl, ;
						SUM(wellhist.ntotmcf) AS ntotmcf, ;
						SUM(wellhist.ntotprod) AS ntototh, ;
						SUM(wellhist.ntotbbltx1) AS ntotbbltx1, ;
						SUM(wellhist.ntotbbltxr + ntotbbltxw) AS nmtoiltax, ;
						SUM(wellhist.ntotmcftxr + ntotmcftxw) AS nmtgastax, ;
						SUM(wellhist.ntotmcftx1) AS ntotmcftx1, ;
						SUM(wellhist.ntotothtx1) AS ntotothtx1, ;
						lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
					FROM wellhist, wells ;
					WHERE BETWEEN(wellhist.hyear + wellhist.hperiod, tcYear1 + tcPeriod1, tcYear2 + tcPeriod2) ;
						AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
						AND wellhist.cwellid = wells.cwellid ;
						AND wellhist.crectype = 'R' ;
						AND NOT wells.lthird_prty  ;
		            AND INLIST(wells.cwellstat,'A','N') ;
						AND IIF(tcState <> '**', wells.cTable = tcState, .T.)  ;
						AND wellhist.cwellid in (SELECT cid FROM selected) ;
					INTO CURSOR temptax READWRITE  ;
					ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
					GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		    ELSE
				SELECT  wellhist.cwellid, ;
						wells.cwellname, ;
		            wells.cpermit1, ;
		            wellhist.cdeck, ;
						ALLT(STR(YEAR(hdate))) AS hyear, ;
						PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiod, ;
						ALLT(STR(YEAR(hdate))) AS hyearx, ;
						PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiodx, ;
						SUM(wellhist.nGrossGas) AS ngasinc, ;
						SUM(wellhist.nGrossOil) AS noilinc, ;
						SUM(wellhist.nothinc) AS nothinc, ;
						SUM(wellhist.ntotbbl) AS ntotbbl, ;
						SUM(wellhist.ntotmcf) AS ntotmcf, ;
						SUM(wellhist.ntotprod) AS ntototh, ;
						SUM(wellhist.ntotbbltx1 + ntotbbltxr + ntotbbltxw) AS ntotbbltx1, ;
						SUM(wellhist.ntotbbltxr + ntotbbltxw) AS nmtoiltax, ;
						SUM(wellhist.ntotmcftxr + ntotmcftxw) AS nmtgastax, ;
						SUM(wellhist.ntotmcftx1 + ntotmcftxr + ntotmcftxw) AS ntotmcftx1, ;
						SUM(wellhist.ntotothtx1) AS ntotothtx1, ;
						lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
					FROM wellhist, wells ;
					WHERE BETWEEN(TRANS(YEAR(hdate)) + PADL(TRANS(MONTH(hdate)), 2, '0'), tcYear1 + tcPeriod1, tcYear2 + tcPeriod2)  ;
						AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
						AND wellhist.cwellid = wells.cwellid ;
						AND wellhist.crectype = 'R' ;
		            AND INLIST(wells.cwellstat,'A','N') ;
						AND NOT wells.lthird_prty  ;
						AND IIF(tcState <> '**', wells.cTable = tcState, .T.)  ;
						AND wellhist.cwellid in (SELECT cid FROM selected);
					INTO CURSOR temptax READWRITE  ;
					ORDER BY wellhist.cwellid, hyearx, hperiodx  ;
					GROUP BY wellhist.cwellid, hyearx, hperiodx
		    ENDIF
		ELSE
		    IF tlProdPrd
				SELECT  wellhist.cwellid, ;
						wells.cwellname, ;
		            wells.cpermit1, ;
						wellhist.hyear, ;
						wellhist.hperiod, ;
						wellhist.cdeck, ;
						SUM(wellhist.nGrossGas) AS ngasinc, ;
						SUM(wellhist.nGrossOil) AS noilinc, ;
						SUM(wellhist.nothinc) AS nothinc, ;
						SUM(wellhist.ntotbbl) AS ntotbbl, ;
						SUM(wellhist.ntotmcf) AS ntotmcf, ;
						SUM(wellhist.ntotprod) AS ntototh, ;
						SUM(wellhist.ntotbbltx1) AS ntotbbltx1, ;
						SUM(wellhist.ntotbbltxr + ntotbbltxw) AS nmtoiltax, ;
						SUM(wellhist.ntotmcftxr + ntotmcftxw) AS nmtgastax, ;
						SUM(wellhist.ntotmcftx1) AS ntotmcftx1, ;
						SUM(wellhist.ntotothtx1) AS ntotothtx1, ;
						lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
					FROM wellhist, wells ;
					WHERE BETWEEN(wellhist.hyear + wellhist.hperiod, tcYear1 + tcPeriod1, tcYear2 + tcPeriod2) ;
						AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
						AND wellhist.cwellid = wells.cwellid ;
						AND wellhist.crectype = 'R' ;
		            AND INLIST(wells.cwellstat,'A','N') ;
						AND NOT wells.lthird_prty  ;
						AND IIF(tcState <> '**', wells.cTable = tcState, .T.)  ;
						AND wellhist.cwellid in (SELECT cid FROM selected);
					INTO CURSOR temptax READWRITE  ;
					ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
					GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		    ELSE
				SELECT  wellhist.cwellid, ;
						wells.cwellname, ;
		            wells.cpermit1, ;
		            wellhist.cdeck, ;
						ALLT(STR(YEAR(hdate))) AS hyear, ;
						PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiod, ;
						ALLT(STR(YEAR(hdate))) AS hyearx, ;
						PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiodx, ;
						SUM(wellhist.nGrossGas) AS ngasinc, ;
						SUM(wellhist.nGrossOil) AS noilinc, ;
						SUM(wellhist.nothinc) AS nothinc, ;
						SUM(wellhist.ntotbbl) AS ntotbbl, ;
						SUM(wellhist.ntotmcf) AS ntotmcf, ;
						SUM(wellhist.ntotprod) AS ntototh, ;
						SUM(wellhist.ntotbbltx1) AS ntotbbltx1, ;
						SUM(wellhist.ntotbbltxr + ntotbbltxw) AS nmtoiltax, ;
						SUM(wellhist.ntotmcftxr + ntotmcftxw) AS nmtgastax, ;
						SUM(wellhist.ntotmcftx1) AS ntotmcftx1, ;
						SUM(wellhist.ntotothtx1) AS ntotothtx1, ;
						lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
					FROM wellhist, wells ;
					WHERE BETWEEN(ALLT(STR(YEAR(hdate))) + PADL(ALLT(STR(MONTH(hdate))), 2, '0'), tcYear1 + tcPeriod1, tcYear2 + tcPeriod2)  ;
						AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
						AND IIF(tcState <> '**', wells.cTable = tcState, NOT EMPTY(wells.cTable))  ;
						AND wellhist.cwellid = wells.cwellid ;
						AND wellhist.crectype = 'R' ;
		            AND INLIST(wells.cwellstat,'A','N') ;
						AND NOT wells.lthird_prty  ;
						AND IIF(tcState <> '**', wells.cTable = tcState, .T.)  ;
						AND wellhist.cwellid in (SELECT cid FROM selected) ;
					INTO CURSOR temptax READWRITE  ;
					ORDER BY wellhist.cwellid, hyearx, hperiodx  ;
					GROUP BY wellhist.cwellid, hyearx, hperiodx
		    ENDIF
		ENDIF
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Tax 1 Taxes by Period...')
		SELECT temptax
		COUNT ALL TO lnMax
		lnCount = 1
		oProgress.SetProgressRange(0, lnMax)
		
		SELECT temptax
		SCAN
		    SCATTER MEMVAR
		    oProgress.UpdateProgress(lnCount)
		    lnCount = lnCount + 1
		
		*  Check the settings for whether the purchaser withholds certain types of taxes, and remove those amounts
		*  from the units reported
		    IF m.lSev1O AND NOT tlNoTable
		        SELECT temptax
		        REPLACE ntotbbl WITH 0, noilinc WITH 0
		        STORE 0 TO m.ntotbbl, m.noilinc, m.ntotbbltx1
		    ENDIF
		    IF m.lSev1G AND NOT tlNoTable
		        SELECT temptax
		        REPLACE ntotmcf WITH 0, ngasinc WITH 0
		        STORE 0 TO m.ntotmcf, m.ngasinc, m.ntotmcftx1
		    ENDIF
		
		    m.ntotbbltax = m.ntotbbltx1
		    m.ntotmcftax = m.ntotmcftx1
		    m.ntotothtax = m.ntotothtx1
		
		    INSERT INTO taxtemp FROM MEMVAR
		ENDSCAN
		
		IF thisform.chkExcludeNoProd.Value = .t.
		   SELECT taxtemp
		   DELETE FOR ngasinc = 0 AND ntotmcftax = 0 ;
		          AND noilinc = 0 AND ntotbbltax = 0 ;
		          AND nothinc = 0 AND ntotothtax = 0
		ENDIF 
		
		
		oProgress.CloseProgress()
		
		
		
		
	ENDPROC

	PROCEDURE calctax1qtr		&& Calculate tax 1 by quarter
		LOCAL tnQuarter, tcYear, tcState, tlCheck, tlProdPrd
		LOCAL lnWellCnt, lcMonth1, lcMonth2, lcMonth3
		
		tnQuarter = THISFORM.opgQuarters.VALUE
		tcYear    = THISFORM.swYear1.VALUE
		tcState   = LEFT(THISFORM.swStates.VALUE, 2)
		tcGroup   = LEFT(THISFORM.swgroup1.VALUE, 2)
		tlProdPrd = THISFORM.chkProdPeriod.VALUE
		tcWellID1 = THISFORM.swrptlook1.txtBegID.VALUE
		tcWellID2 = THISFORM.swrptlook1.txtEndID.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWellID1,tcWellID2) ;
		      ORDER BY cid
		ENDIF
		
		DIME amcf(12)
		DIME abbl(12)
		DIME aoth(12)
		DIME atmcf(12)
		DIME atbbl(12)
		DIME atoth(12)
		DIME atax(12)
		DIME attax(12)
		DIME aquarter(4)
		DIME amonths(12)
		
		amcf  = 0
		abbl  = 0
		aoth  = 0
		atax  = 0
		atmcf = 0
		atbbl = 0
		atoth = 0
		attax = 0
		
		aquarter(1) = 1
		aquarter(2) = 4
		aquarter(3) = 7
		aquarter(4) = 10
		
		amonths(1)  = "Jan"
		amonths(2)  = "Feb"
		amonths(3)  = "Mar"
		amonths(4)  = "Apr"
		amonths(5)  = "May"
		amonths(6)  = "Jun"
		amonths(7)  = "Jul"
		amonths(8)  = "Aug"
		amonths(9)  = "Sep"
		amonths(10) = "Oct"
		amonths(11) = "Nov"
		amonths(12) = "Dec"
		
		CREATE CURSOR taxtemp ;
		    (crptgroup      C(1), ;
		      cwellid        C(10), ;
		      cwellname      C(30), ;
		      cpermit1       c(20), ;
		      cMonth1        C(10), ;
		      nmonth1units   N(12, 2), ;
		      nmonth1dollars N(12, 2),  ;
		      ntax1          N(12, 2), ;
		      cMonth2        C(10), ;
		      nmonth2units   N(12, 2), ;
		      nmonth2dollars N(12, 2),  ;
		      ntax2          N(12, 2), ;
		      cMonth3        C(10), ;
		      nmonth3units   N(12, 2), ;
		      nmonth3dollars N(12, 2),  ;
		      ntax3          N(12, 2))
		INDEX ON crptgroup + cwellid TAG cwellid
		
		DO CASE
		    CASE tnQuarter = 1
		        lcMonth1 = 'January'
		        lcMonth2 = 'February'
		        lcMonth3 = 'March'
		    CASE tnQuarter = 2
		        lcMonth1 = 'April'
		        lcMonth2 = 'May'
		        lcMonth3 = 'June'
		    CASE tnQuarter = 3
		        lcMonth1 = 'July'
		        lcMonth2 = 'August'
		        lcMonth3 = 'September'
		    CASE tnQuarter = 4
		        lcMonth1 = 'October'
		        lcMonth2 = 'November'
		        lcMonth3 = 'December'
		ENDCASE
		
		SELECT  cwellid, cwellname, cpermit1 ;
			FROM wells ;
			WHERE wells.cwellid in (SELECT cid FROM selected)  ;
				AND IIF(tcState <> '**', wells.cTable = tcState, IIF(NOT tlNoTable, NOT EMPTY(cTable) OR wells.lusesev = .T., .T.))  ;
		      AND INLIST(wells.cwellstat,'A','N') ;
				AND lthird_prty = .F. ;
			ORDER BY cwellname ;
			INTO CURSOR taxwells
		
		lnWellCnt = _TALLY
		
		IF lnWellCnt = 0
		    RETURN
		ENDIF
		
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Quarterly Tax 1 Taxes...')
		jMax      = lnWellCnt
		jCount    = 1
		oProgress.SetProgressRange(0, jMax)
		
		SELECT taxwells
		SCAN 
		    lcWellID = cWellID
		    lcWellName = cWellName
		    lcPermit1 = cPermit1
		
		    SELECT wellhist
		    IF tlProdPrd
		        IF tcGroup = '**'
		            SET FILTER TO hyear = tcYear AND cRecType = 'R'
		        ELSE
		            SET FILTER TO hyear = tcYear AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid == lcWellID AND VAL(hperiod) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		
		               IF EMPTY(m.cDeck)
		                  m.cDeck = thisform.oWellInv.DOIDeckNameLookup(m.hyear, m.hperiod, m.cWellID)
		               ENDIF 
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev1O       = lSev1O
		                    m.lSev1G       = lSev1G
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev1O       = .F.
		                    m.lSev1G       = .F.
		                ENDIF
		
		                IF m.lSev1O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL
		                ENDIF
		                IF m.lSev1G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF
		                ENDIF
		
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O1', .F., .T., .T.,.F.,.T., .F.,.F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                       m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O1', .F., .T., .T.,.F.,.T., .F.,.F.,m.cDeck)
		                       m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T.,.F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF    
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G1', .F., .T., .T., .F., .T., .F.,.F.,m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                       m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G1', .F., .T., .T., .T., .F.,.F.,.F.,m.cDeck)
		                       m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF     
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + lcWellID)
		                    APPEND BLANK
		                    REPLACE cwellid   WITH lcWellID, ;
		                        cwellname WITH lcWellName, ;
		                        cPermit1  WITH lcPermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax     = m.ntotbbltx1
		                    lnGasTax     = m.ntotmcftx1
		                    lnOthTax     = m.ntotothtx1
		                ELSE
		                    lnOilTax     = swNetRevenue(m.cwellid, m.ntotbbltx1, 'O1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnGasTax     = swNetRevenue(m.cwellid, m.ntotmcftx1, 'G1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnOthTax     = swNetRevenue(m.cwellid, m.ntotothtx1, 'P1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    m.ntotbbltxr = swNetRevenue(m.cwellid, m.ntotbbltxr, 'O1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    m.ntotbbltxw = swNetRevenue(m.cwellid, m.ntotbbltxw, 'O1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                ENDIF
		
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax + m.ntotbbltxr + m.ntotbbltxw,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax + m.ntotbbltxr + m.ntotbbltxw,  ;
		                            nmonth2dollars WITH nmonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax + m.ntotbbltxr + m.ntotbbltxw,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + lcWellID)
		                    APPEND BLANK
		                    REPLACE cwellid   WITH lcWellID, ;
		                        cwellname WITH lcWellName, ;
		                        cPermit1  WITH lcPermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax + m.ntotmcftxr + m.ntotmcftxw,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax + m.ntotmcftxr + m.ntotmcftxw,  ;
		                            nmonth2dollars WITH nmonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax + m.ntotmcftxr + m.ntotmcftxw,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + lcWellID)
		                    APPEND BLANK
		                    REPLACE cwellid   WITH lcWellID, ;
		                        cwellname WITH lcWellName, ;
		                        cPermit1  WITH lcPermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nmonth2dollars WITH nmonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ELSE
		        SELECT wellhist
		        IF tcGroup = '**'
		            SET FILTER TO  YEAR(hdate) = VAL(tcYear) AND cRecType = 'R'
		        ELSE
		            SET FILTER TO YEAR(hdate) = VAL(tcYear) AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid = lcWellID AND MONTH(hdate) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev1O       = lSev1O
		                    m.lSev1G       = lSev1G
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev1O       = .F.
		                    m.lSev1G       = .F.
		                ENDIF
		
		                IF m.lSev1O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL, m.ntotbbltx1
		                ENDIF
		                IF m.lSev1G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF, m.ntotmcftx1
		                ENDIF
		
		*  If the purchaser withholds taxes on direct pays, remove the bbl and taxes
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O1', .F., .T., .T., .F., .T., .F., .F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T., .F., .T., .F., .F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                       m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O1', .F., .T., .T., .T., .F., .T., .F., m.cDeck)
		                       m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF    
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G1', .F., .T., .T., .F.,.T., .F., .F., m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                       m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G1', .F., .T., .T., .F.,.T., .F.,.F.,m.cDeck)
		                       m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF 
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax     = m.ntotbbltx1
		                    lnGasTax     = m.ntotmcftx1
		                    lnOthTax     = m.ntotothtx1
		                ELSE
		                    lnOilTax     = swNetRevenue(m.cwellid, m.ntotbbltx1, 'O1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnGasTax     = swNetRevenue(m.cwellid, m.ntotmcftx1, 'G1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnOthTax     = swNetRevenue(m.cwellid, m.ntotothtx1, 'P1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    m.ntotbbltxr = swNetRevenue(m.cwellid, m.ntotbbltxr, 'O1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    m.ntotbbltxw = swNetRevenue(m.cwellid, m.ntotbbltxw, 'O1', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + lcWellID)
		                    APPEND BLANK
		                    REPLACE cwellid   WITH lcWellID, ;
		                        cwellname WITH lcWellName, ;
		                        cPermit1  WITH lcPermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax + m.ntotbbltxr + m.ntotbbltxw,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax + m.ntotbbltxr + m.ntotbbltxw,  ;
		                            nmonth2dollars WITH nmonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax + m.ntotbbltxr + m.ntotbbltxw,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + lcWellID)
		                    APPEND BLANK
		                    REPLACE cwellid   WITH lcWellID, ;
		                        cwellname WITH lcWellName, ;
		                        cPermit1  WITH lcPermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax + m.ntotmcftxr + m.ntotmcftxw,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax + m.ntotmcftxr + m.ntotmcftxw,  ;
		                            nmonth2dollars WITH nmonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax + m.ntotmcftxr + m.ntotmcftxw,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + lcWellID)
		                    APPEND BLANK
		                    REPLACE cwellid   WITH lcWellID, ;
		                        cwellname WITH lcWellName, ;
		                        cPermit1  WITH lcPermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nmonth2dollars WITH nmonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ENDIF
		    oProgress.UpdateProgress(jCount)
		    jCount = jCount + 1
		ENDSCAN && taxwells
		
		IF thisform.chkExcludeNoProd.Value = .t.
		   SELECT taxtemp
		   DELETE FOR nmonth1units = 0 AND nmonth1dollars = 0 ;
		          AND nmonth2units = 0 AND nmonth2dollars = 0 ;
		          AND nmonth3units = 0 AND nmonth3dollars = 0
		ENDIF 
		
		oProgress.CloseProgress()
		
		SELECT wellhist
		SET FILTER TO
		
		SELECT taxtemp
		
		
		
	ENDPROC

	PROCEDURE calctax2		&& calculate taxes 2
		LOCAL tcYear1, tcYear2, tcPeriod1, tcPeriod2, tcGroup, tcWell1, tcWell2, tcState
		LOCAL lnMax, lnCount, oProgress
		
		tcYear1   = THISFORM.swyear1.VALUE
		tcYear2   = THISFORM.swyear2.VALUE
		tcPeriod1 = THISFORM.swPeriod1.VALUE
		tcPeriod2 = THISFORM.swPeriod2.VALUE
		tcGroup   = LEFT(THISFORM.swgroup1.VALUE, 2)
		tcWell1   = THISFORM.swrptlook1.txtBegID.VALUE
		tcWell2   = THISFORM.swrptlook1.txtEndID.VALUE
		tcState   = LEFT(THISFORM.swStates.VALUE, 2)
		tlProdPrd = THISFORM.chkProdPeriod.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWell1,tcWell2) ;
		      ORDER BY cid
		ENDIF
		
		
		CREATE CURSOR taxtemp ;
		   (cwellid    C(10), ;
		   cwellname  C(10), ;
		   cpermit1   C(20), ;
		   hyear      C(4), ;
		   hperiod    C(2), ;
		   ngasinc    N(12, 2), ;
		   noilinc    N(12, 2), ;
		   nothinc    N(12, 2), ;
		   ntotbbl    N(12, 4), ;
		   ntotmcf    N(12, 4), ;
		   ntototh    N(12, 4), ;
		   ntotbbltax N(12, 2), ;
		   ntotmcftax N(12, 2), ;
		   ntotothtax N(12, 2))
		
		IF tlNoTable
		   IF tlProdPrd
		      SELECT  wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         wellhist.hyear, ;
		         wellhist.hperiod, ;
		         SUM(wellhist.ngrossgas) AS ngasinc, ;
		         SUM(wellhist.ngrossoil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx2) AS ntotbbltx2, ;
		         SUM(wellhist.ntotmcftx2) AS ntotmcftx2, ;
		         SUM(wellhist.ntotothtx2) AS ntotothtx2, ;
		         lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(wellhist.hyear + wellhist.hperiod, tcYear1 + tcPeriod1, tcYear2 + tcPeriod2) ;
		         AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype = 'R' ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState <> '**', wells.cTable = tcState, .T.)  ;
		         AND NOT wells.lthird_prty  ;
		         AND wellhist.cwellid in (SELECT cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
		         GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		   ELSE
		      SELECT  wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         ALLT(STR(YEAR(hdate))) AS hyear, ;
		         PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiod, ;
		         ALLT(STR(YEAR(hdate))) AS hyearx, ;
		         PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiodx, ;
		         SUM(wellhist.ngrossgas) AS ngasinc, ;
		         SUM(wellhist.ngrossoil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx2) AS ntotbbltx2, ;
		         SUM(wellhist.ntotmcftx2) AS ntotmcftx2, ;
		         SUM(wellhist.ntotothtx2) AS ntotothtx2, ;
		         lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(ALLT(STR(YEAR(hdate))) + PADL(ALLT(STR(MONTH(hdate))), 2, '0'), tcYear1 + tcPeriod1, tcYear2 + tcPeriod2)  ;
		         AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype = 'R' ;
		         AND IIF(tcState <> '**', wells.cTable = tcState, .T.)  ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND wellhist.cwellid in (SELECT cid FROM selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, hyearx, hperiodx  ;
		         GROUP BY wellhist.cwellid, hyearx, hperiodx
		   ENDIF
		ELSE
		   IF tlProdPrd
		      SELECT  wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         wellhist.hyear, ;
		         wellhist.hperiod, ;
		         SUM(wellhist.ngrossgas) AS ngasinc, ;
		         SUM(wellhist.ngrossoil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx2) AS ntotbbltx2, ;
		         SUM(wellhist.ntotmcftx2) AS ntotmcftx2, ;
		         SUM(wellhist.ntotothtx2) AS ntotothtx2, ;
		         lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(wellhist.hyear + wellhist.hperiod, tcYear1 + tcPeriod1, tcYear2 + tcPeriod2) ;
		         AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype = 'R' ;
		         AND IIF(tcState <> '**', wells.cTable = tcState, NOT EMPTY(wells.cTable))  ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND wellhist.cwellid in (SELECT cid FROM selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
		         GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		   ELSE
		      SELECT  wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         ALLT(STR(YEAR(hdate))) AS hyear, ;
		         PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiod, ;
		         ALLT(STR(YEAR(hdate))) AS hyearx, ;
		         PADL(ALLT(STR(MONTH(hdate))), 2, '0') AS hperiodx, ;
		         SUM(wellhist.ngrossgas) AS ngasinc, ;
		         SUM(wellhist.ngrossoil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx2) AS ntotbbltx2, ;
		         SUM(wellhist.ntotmcftx2) AS ntotmcftx2, ;
		         SUM(wellhist.ntotothtx2) AS ntotothtx2, ;
		         lSev1O, lSev2O, lSev3O, lSev4O, lSev1G, lSev2G, lSev3G, lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(ALLT(STR(YEAR(hdate))) + PADL(ALLT(STR(MONTH(hdate))), 2, '0'), tcYear1 + tcPeriod1, tcYear2 + tcPeriod2)  ;
		         AND IIF(tcGroup <> '**', wellhist.cgroup = tcGroup, .T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype = 'R' ;
		         AND IIF(tcState <> '**', wells.cTable = tcState, NOT EMPTY(wells.cTable))  ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND wellhist.cwellid in (SELECT cid FROM selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, hyearx, hperiodx  ;
		         GROUP BY wellhist.cwellid, hyearx, hperiodx
		   ENDIF
		ENDIF
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Tax 2 Taxes by Period...')
		SELECT temptax
		COUNT ALL TO lnMax
		lnCount = 1
		oProgress.SetProgressRange(0, lnMax)
		
		SELECT temptax
		SCAN
		   SCATTER MEMVAR
		   oProgress.UpdateProgress(lnCount)
		   lnCount = lnCount + 1
		
		   *  Check the settings for whether the purchaser withholds certain types of taxes, and remove those amounts
		   *  from the units reported
		   IF m.lSev2O AND NOT tlNoTable
		      SELECT temptax
		      REPLACE ntotbbl WITH 0, noilinc WITH 0
		      STORE 0 TO m.ntotbbl, m.noilinc, m.ntotbbltx2
		   ENDIF
		   IF m.lSev2G AND NOT tlNoTable
		      SELECT temptax
		      REPLACE ntotmcf WITH 0, ngasinc WITH 0
		      STORE 0 TO m.ntotmcf, m.ngasinc, m.ntotmcftx2
		   ENDIF
		
		   m.ntotbbltax = m.ntotbbltx2
		   m.ntotmcftax = m.ntotmcftx2
		   m.ntotothtax = m.ntotothtx2
		   INSERT INTO taxtemp FROM MEMVAR
		ENDSCAN
		
		IF THISFORM.chkExcludeNoProd.VALUE = .T.
		   SELECT taxtemp
		   DELETE FOR ngasinc = 0 AND ntotmcftax = 0 ;
		      AND noilinc = 0 AND ntotbbltax = 0 ;
		      AND nothinc = 0 AND ntotothtax = 0
		ENDIF
		
		oProgress.CloseProgress()
		
		
		
		
	ENDPROC

	PROCEDURE calctax2qtr		&& Calculate tax 2 by quarter
		LOCAL tnQuarter, tcYear, tcState, tlCheck, tlProdPrd
		LOCAL lnWellCnt, lcMonth1, lcMonth2, lcMonth3
		
		tnQuarter = THISFORM.opgQuarters.VALUE
		tcYear    = THISFORM.swYear1.VALUE
		tcState   = LEFT(THISFORM.swStates.VALUE, 2)
		tcGroup   = LEFT(THISFORM.swgroup1.VALUE, 2)
		tlProdPrd = THISFORM.chkProdPeriod.VALUE
		tcWellID1 = THISFORM.swrptlook1.txtBegID.VALUE
		tcWellID2 = THISFORM.swrptlook1.txtEndID.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWellID1,tcWellID2) ;
		      ORDER BY cid
		ENDIF
		
		DIME amcf(12)
		DIME abbl(12)
		DIME aoth(12)
		DIME atmcf(12)
		DIME atbbl(12)
		DIME atoth(12)
		DIME atax(12)
		DIME attax(12)
		DIME aquarter(4)
		DIME amonths(12)
		
		amcf  = 0
		abbl  = 0
		aoth  = 0
		atax  = 0
		atmcf = 0
		atbbl = 0
		atoth = 0
		attax = 0
		
		aquarter(1) = 1
		aquarter(2) = 4
		aquarter(3) = 7
		aquarter(4) = 10
		
		amonths(1)  = "Jan"
		amonths(2)  = "Feb"
		amonths(3)  = "Mar"
		amonths(4)  = "Apr"
		amonths(5)  = "May"
		amonths(6)  = "Jun"
		amonths(7)  = "Jul"
		amonths(8)  = "Aug"
		amonths(9)  = "Sep"
		amonths(10) = "Oct"
		amonths(11) = "Nov"
		amonths(12) = "Dec"
		
		CREATE CURSOR taxtemp ;
		    (crptgroup      C(1), ;
		      cwellid        C(10), ;
		      cwellname      C(30), ;
		      cpermit1       c(20), ;
		      cMonth1        C(10), ;
		      nmonth1units   N(12, 2), ;
		      nmonth1dollars N(12, 2),  ;
		      ntax1          N(12, 2), ;
		      cMonth2        C(10), ;
		      nmonth2units   N(12, 2), ;
		      nMonth2dollars N(12, 2),  ;
		      ntax2          N(12, 2), ;
		      cMonth3        C(10), ;
		      nmonth3units   N(12, 2), ;
		      nmonth3dollars N(12, 2),  ;
		      ntax3          N(12, 2))
		INDEX ON crptgroup + cwellid TAG cwellid
		
		DO CASE
		    CASE tnQuarter = 1
		        lcMonth1 = 'January'
		        lcMonth2 = 'February'
		        lcMonth3 = 'March'
		    CASE tnQuarter = 2
		        lcMonth1 = 'April'
		        lcMonth2 = 'May'
		        lcMonth3 = 'June'
		    CASE tnQuarter = 3
		        lcMonth1 = 'July'
		        lcMonth2 = 'August'
		        lcMonth3 = 'September'
		    CASE tnQuarter = 4
		        lcMonth1 = 'October'
		        lcMonth2 = 'November'
		        lcMonth3 = 'December'
		ENDCASE
		
		SELECT  cwellid, cwellname, cpermit1 ;
			FROM wells ;
			WHERE BETWEEN(cwellid, tcWellID1, tcWellID2)  ;
				AND IIF(tcState <> '**', wells.cTable = tcState, IIF(NOT tlNoTable, NOT EMPTY(cTable) OR wells.lusesev = .T., .T.))  ;
		      AND INLIST(wells.cwellstat,'A','N') ;
				AND lthird_prty = .F. ;
			ORDER BY cwellname ;
			INTO ARRAY awellsev
		
		lnWellCnt = _TALLY
		
		IF lnWellCnt = 0
		    RETURN
		ENDIF
		
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Quarterly Tax 1 Taxes...')
		jMax      = lnWellCnt
		jCount    = 1
		oProgress.SetProgressRange(0, jMax)
		
		FOR i = 1 TO lnWellCnt
		    SELECT wellhist
		    IF tlProdPrd
		        IF tcGroup = '**'
		            SET FILTER TO hyear = tcYear AND cRecType = 'R'
		        ELSE
		            SET FILTER TO hyear = tcYear AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid = awellsev(i, 1) AND VAL(hperiod) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		                
		                IF EMPTY(m.cDeck)
		                  m.cDeck = thisform.oWellInv.DOIDeckNameLookup(m.hyear, m.hperiod, m.cWellID)
		               ENDIF 
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev2O       = lSev2O
		                    m.lSev2G       = lSev2G
		                    m.cpermit1     = cpermit1
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev2O       = .F.
		                    m.lSev2G       = .F.
		                    m.cPermit1     = ''
		                ENDIF
		
		                IF m.lSev2O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL, m.ntotbbltx2
		                ENDIF
		                IF m.lSev2G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF, m.ntotmcftx2
		                ENDIF
		
		*  If the purchaser withholds taxes on direct pays, remove the bbl and taxes
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax = m.ntotbbltx2
		                    lnGasTax = m.ntotmcftx2
		                    lnOthTax = m.ntotothtx2
		                ELSE
		                    lnOilTax = swNetRevenue(m.cwellid, m.ntotbbltx2, 'O2', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnGasTax = swNetRevenue(m.cwellid, m.ntotmcftx2, 'G2', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnOthTax = swNetRevenue(m.cwellid, m.ntotothtx2, 'P2', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ELSE
		        SELECT wellhist
		        IF tcGroup = '**'
		            SET FILTER TO  YEAR(hdate) = VAL(tcYear) AND cRecType = 'R'
		        ELSE
		            SET FILTER TO YEAR(hdate) = VAL(tcYear) AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid = awellsev(i, 1) AND MONTH(hdate) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev2O       = lSev2O
		                    m.lSev2G       = lSev2G
		                    m.cPermit1     = cPermit1
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev2O       = .F.
		                    m.lSev2G       = .F.
		                    m.cPermit1     = ''
		                ENDIF
		
		                IF m.lSev2O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL
		                ENDIF
		                IF m.lSev2G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF
		                ENDIF
		
		*  If the purchaser withholds taxes on direct pays, remove the bbl and taxes
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax = m.ntotbbltx2
		                    lnGasTax = m.ntotmcftx2
		                    lnOthTax = m.ntotothtx2
		                ELSE
		                    lnOilTax = swNetRevenue(m.cwellid, m.ntotbbltx2, 'O2', .F., .T., .T., .F., .T., .F., .T.,  m.cDeck)
		                    lnGasTax = swNetRevenue(m.cwellid, m.ntotmcftx2, 'G2', .F., .T., .T., .F., .T., .F., .T.,  m.cDeck)
		                    lnOthTax = swNetRevenue(m.cwellid, m.ntotothtx2, 'P2', .F., .T., .T., .F., .T., .F., .T.,  m.cDeck)
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ENDIF
		    oProgress.UpdateProgress(jCount)
		    jCount = jCount + 1
		ENDFOR
		
		IF thisform.chkExcludeNoProd.Value = .t.
		   SELECT taxtemp
		   DELETE FOR nmonth1units = 0 AND nmonth1dollars = 0 ;
		          AND nmonth2units = 0 AND nmonth2dollars = 0 ;
		          AND nmonth3units = 0 AND nmonth3dollars = 0
		ENDIF 
		
		oProgress.CloseProgress()
		
		SELECT wellhist
		SET FILTER TO
		
		SELECT taxtemp
		
		
		
	ENDPROC

	PROCEDURE calctax3		&& Calculates tax 3
		LOCAL tcYear1, tcYear2, tcPeriod1, tcPeriod2, tcGroup, tcWell1, tcWell2, tcState
		LOCAL lnMax, lnCount, oProgress
		
		tcYear1    = THISFORM.swyear1.VALUE
		tcYear2    = THISFORM.swyear2.VALUE
		tcPeriod1  = THISFORM.swPeriod1.VALUE
		tcPeriod2  = THISFORM.swPeriod2.VALUE
		tcGroup    = LEFT(THISFORM.swgroup1.VALUE,2)
		tcWell1    = THISFORM.swrptlook1.txtBegID.VALUE
		tcWell2    = THISFORM.swrptlook1.txtEndID.VALUE
		tcState    = LEFT(THISFORM.swStates.VALUE,2)
		tlProdPrd  = THISFORM.chkProdPeriod.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWell1,tcWell2) ;
		      ORDER BY cid
		ENDIF
		
		
		CREATE CURSOR taxtemp ;
		   (cwellid    C(10), ;
		   cwellname  C(10), ;
		   cpermit1   c(20), ;
		   hyear      C(4), ;
		   hperiod    C(2), ;
		   ngasinc    N(12,2), ;
		   noilinc    N(12,2), ;
		   nothinc    N(12,2), ;
		   ntotbbl    N(12,4), ;
		   ntotmcf    N(12,4), ;
		   ntototh    N(12,4), ;
		   ntotbbltax N(12,2), ;
		   ntotmcftax N(12,2), ;
		   ntotothtax N(12,2))
		
		IF tlNoTable
		   IF tlProdPrd
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         wellhist.hyear, ;
		         wellhist.hperiod, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx3) AS ntotbbltx3, ;
		         SUM(wellhist.ntotmcftx3) AS ntotmcftx3, ;
		         SUM(wellhist.ntotothtx3) AS ntotothtx3, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(wellhist.hyear+wellhist.hperiod,tcYear1+tcPeriod1,tcYear2+tcPeriod2) ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState, .T.)  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
		         GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		   ELSE
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         ALLT(STR(YEAR(hdate))) AS hyear, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiod, ;
		         ALLT(STR(YEAR(hdate))) AS hyearx, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiodx, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx3) AS ntotbbltx3, ;
		         SUM(wellhist.ntotmcftx3) AS ntotmcftx3, ;
		         SUM(wellhist.ntotothtx3) AS ntotothtx3, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(ALLT(STR(YEAR(hdate)))+PADL(ALLT(STR(MONTH(hdate))),2,'0'),tcYear1+tcPeriod1,tcYear2+tcPeriod2)  ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState,.T.)  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid,hyearx,hperiodx  ;
		         GROUP BY wellhist.cwellid,hyearx,hperiodx
		   ENDIF
		ELSE
		   IF tlProdPrd
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         wellhist.hyear, ;
		         wellhist.hperiod, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx3) AS ntotbbltx3, ;
		         SUM(wellhist.ntotmcftx3) AS ntotmcftx3, ;
		         SUM(wellhist.ntotothtx3) AS ntotothtx3, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(wellhist.hyear+wellhist.hperiod,tcYear1+tcPeriod1,tcYear2+tcPeriod2) ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState,not EMPTY(wells.cTable))  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
		         GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		   ELSE
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         ALLT(STR(YEAR(hdate))) AS hyear, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiod, ;
		         ALLT(STR(YEAR(hdate))) AS hyearx, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiodx, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx3) AS ntotbbltx3, ;
		         SUM(wellhist.ntotmcftx3) AS ntotmcftx3, ;
		         SUM(wellhist.ntotothtx3) AS ntotothtx3, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(ALLT(STR(YEAR(hdate)))+PADL(ALLT(STR(MONTH(hdate))),2,'0'),tcYear1+tcPeriod1,tcYear2+tcPeriod2)  ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState,not EMPTY(wells.cTable))  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid,hyearx,hperiodx  ;
		         GROUP BY wellhist.cwellid,hyearx,hperiodx
		   ENDIF
		ENDIF
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Tax 3 Taxes by Period...')
		SELECT temptax
		COUNT ALL TO lnMax
		lnCount = 1
		oProgress.SetProgressRange(0,lnMax)
		
		SELECT temptax
		SCAN
		   SCATTER MEMVAR
		   oProgress.UpdateProgress(lnCount)
		   lnCount = lnCount + 1
		   
		   *  Check the settings for whether the purchaser withholds certain types of taxes, and remove those amounts
		   *  from the units reported
		   IF m.lSev3O AND NOT tlNoTable
		      SELECT temptax
		      replace nTotBBL WITH 0, nOilInc WITH 0
		      STORE 0 TO m.nTotBBL,m.nOilInc
		   ENDIF 
		   IF m.lSev3G AND NOT tlNoTable
		      SELECT temptax
		      replace nTotMCF WITH 0, nGasInc WITH 0
		      STORE 0 TO m.nTotMCF, m.nGasInc
		   endif
		   
		   m.ntotbbltax     = m.ntotbbltx3
		   m.ntotmcftax     = m.ntotmcftx3
		   m.ntotothtax     = m.ntotothtx3
		*!*	   IF NOT tlNoTable
		*!*	      m.ngasinc    = swNetRevenue(m.cwellid, m.ngasinc, 'G', .F.)
		*!*	      m.noilinc    = swNetRevenue(m.cwellid, m.noilinc, 'O', .F.)
		*!*	      m.ntotbbl    = swNetRevenue(m.cwellid, m.ntotbbl, 'O1', .F., .T., .F., .T.) 
		*!*	      m.ntotmcf    = swNetRevenue(m.cwellid, m.ntotmcf, 'G1', .F., .T., .F., .T.) 
		*!*	      m.ntotbbltax = swNetRevenue(m.cwellid, m.ntotbbltx3, 'O3', .F.,.T.,.T.,,.T.)
		*!*	      m.ntotmcftax = swNetRevenue(m.cwellid, m.ntotmcftx3, 'G3', .F.,.T.,.T.,,.T.)
		*!*	      m.ntotothtax = swNetRevenue(m.cwellid, m.ntotothtx3, 'P3', .F.,.T.,.T.,,.T.)
		*!*	   ENDIF
		   INSERT INTO taxtemp FROM MEMVAR
		ENDSCAN
		
		IF thisform.chkExcludeNoProd.Value = .t.
		   SELECT taxtemp
		   DELETE FOR ngasinc = 0 AND ntotmcftax = 0 ;
		          AND noilinc = 0 AND ntotbbltax = 0 ;
		          AND nothinc = 0 AND ntotothtax = 0
		ENDIF 
		
		oProgress.CloseProgress()
		
		
		
	ENDPROC

	PROCEDURE calctax3qtr		&& Calculates Tax 3 by Quarter
		LOCAL tnQuarter, tcYear, tcState, tlCheck, tlProdPrd
		LOCAL lnWellCnt, lcMonth1, lcMonth2, lcMonth3
		
		tnQuarter = THISFORM.opgQuarters.VALUE
		tcYear    = THISFORM.swYear1.VALUE
		tcState   = LEFT(THISFORM.swStates.VALUE, 2)
		tcGroup   = LEFT(THISFORM.swgroup1.VALUE, 2)
		tlProdPrd = THISFORM.chkProdPeriod.VALUE
		tcWellID1 = THISFORM.swrptlook1.txtBegID.VALUE
		tcWellID2 = THISFORM.swrptlook1.txtEndID.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWellID1,tcWellID2) ;
		      ORDER BY cid
		ENDIF
		
		DIME amcf(12)
		DIME abbl(12)
		DIME aoth(12)
		DIME atmcf(12)
		DIME atbbl(12)
		DIME atoth(12)
		DIME atax(12)
		DIME attax(12)
		DIME aquarter(4)
		DIME amonths(12)
		
		amcf  = 0
		abbl  = 0
		aoth  = 0
		atax  = 0
		atmcf = 0
		atbbl = 0
		atoth = 0
		attax = 0
		
		aquarter(1) = 1
		aquarter(2) = 4
		aquarter(3) = 7
		aquarter(4) = 10
		
		amonths(1)  = "Jan"
		amonths(2)  = "Feb"
		amonths(3)  = "Mar"
		amonths(4)  = "Apr"
		amonths(5)  = "May"
		amonths(6)  = "Jun"
		amonths(7)  = "Jul"
		amonths(8)  = "Aug"
		amonths(9)  = "Sep"
		amonths(10) = "Oct"
		amonths(11) = "Nov"
		amonths(12) = "Dec"
		
		CREATE CURSOR taxtemp ;
		    (crptgroup      C(1), ;
		      cwellid        C(10), ;
		      cwellname      C(30), ;
		      cpermit1       c(20), ;
		      cMonth1        C(10), ;
		      nmonth1units   N(12, 2), ;
		      nmonth1dollars N(12, 2),  ;
		      ntax1          N(12, 2), ;
		      cMonth2        C(10), ;
		      nmonth2units   N(12, 2), ;
		      nMonth2dollars N(12, 2),  ;
		      ntax2          N(12, 2), ;
		      cMonth3        C(10), ;
		      nmonth3units   N(12, 2), ;
		      nmonth3dollars N(12, 2),  ;
		      ntax3          N(12, 2))
		INDEX ON crptgroup + cwellid TAG cwellid
		
		DO CASE
		    CASE tnQuarter = 1
		        lcMonth1 = 'January'
		        lcMonth2 = 'February'
		        lcMonth3 = 'March'
		    CASE tnQuarter = 2
		        lcMonth1 = 'April'
		        lcMonth2 = 'May'
		        lcMonth3 = 'June'
		    CASE tnQuarter = 3
		        lcMonth1 = 'July'
		        lcMonth2 = 'August'
		        lcMonth3 = 'September'
		    CASE tnQuarter = 4
		        lcMonth1 = 'October'
		        lcMonth2 = 'November'
		        lcMonth3 = 'December'
		ENDCASE
		
		SELECT  cwellid, cwellname, cpermit1 ;
			FROM wells ;
			WHERE wells.cwellid in (SELECT cid FROM selected)  ;
				AND IIF(tcState <> '**', wells.cTable = tcState, IIF(NOT tlNoTable, NOT EMPTY(cTable) OR wells.lusesev = .T., .T.))  ;
		      AND INLIST(wells.cwellstat,'A','N') ;
				AND lthird_prty = .F. ;
			ORDER BY cwellname ;
			INTO ARRAY awellsev
		
		lnWellCnt = _TALLY
		
		IF lnWellCnt = 0
		    RETURN
		ENDIF
		
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Quarterly Tax 1 Taxes...')
		jMax      = lnWellCnt
		jCount    = 1
		oProgress.SetProgressRange(0, jMax)
		
		FOR i = 1 TO lnWellCnt
		    SELECT wellhist
		    IF tlProdPrd
		        IF tcGroup = '**'
		            SET FILTER TO hyear = tcYear AND cRecType = 'R'
		        ELSE
		            SET FILTER TO hyear = tcYear AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid = awellsev(i, 1) AND VAL(hperiod) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		                
		                IF EMPTY(m.cDeck)
		                  m.cDeck = thisform.oWellInv.DOIDeckNameLookup(m.hyear, m.hperiod, m.cWellID)
		               ENDIF 
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev3O       = lSev3O
		                    m.lSev3G       = lSev3G
		                    m.cPermit1 = cPermit1
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev3O       = .F.
		                    m.lSev3G       = .F.
		                    m.cPermit1 = ''
		                ENDIF
		
		                IF m.lSev3O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL, m.ntotbbltx3
		                ENDIF
		                IF m.lSev3G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF, m.ntotmcftx3
		                ENDIF
		
		*  If the purchaser withholds taxes on direct pays, remove the bbl and taxes
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax = m.ntotbbltx3
		                    lnGasTax = m.ntotmcftx3
		                    lnOthTax = m.ntotothtx3
		                ELSE
		                    lnOilTax = swNetRevenue(m.cwellid, m.ntotbbltx3, 'O3', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnGasTax = swNetRevenue(m.cwellid, m.ntotmcftx3, 'G3', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnOthTax = swNetRevenue(m.cwellid, m.ntotothtx3, 'P3', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ELSE
		        SELECT wellhist
		        IF tcGroup = '**'
		            SET FILTER TO  YEAR(hdate) = VAL(tcYear) AND cRecType = 'R'
		        ELSE
		            SET FILTER TO YEAR(hdate) = VAL(tcYear) AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid = awellsev(i, 1) AND MONTH(hdate) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev3O       = lSev3O
		                    m.lSev3G       = lSev3G
		                    m.cPermit1     = cPermit1
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev3O       = .F.
		                    m.lSev3G       = .F.
		                    m.cPermit1     = ''
		                ENDIF
		
		                IF m.lSev3O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL
		                ENDIF
		                IF m.lSev3G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF
		                ENDIF
		
		*  If the purchaser withholds taxes on direct pays, remove the bbl and taxes
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax = m.ntotbbltx3
		                    lnGasTax = m.ntotmcftx3
		                    lnOthTax = m.ntotothtx3
		                ELSE
		                    lnOilTax = swNetRevenue(m.cwellid, m.ntotbbltx3, 'O3', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnGasTax = swNetRevenue(m.cwellid, m.ntotmcftx3, 'G3', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnOthTax = swNetRevenue(m.cwellid, m.ntotothtx3, 'P3', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ENDIF
		    oProgress.UpdateProgress(jCount)
		    jCount = jCount + 1
		ENDFOR
		
		IF thisform.chkExcludeNoProd.Value = .t.
		   SELECT taxtemp
		   DELETE FOR nmonth1units = 0 AND nmonth1dollars = 0 ;
		          AND nmonth2units = 0 AND nmonth2dollars = 0 ;
		          AND nmonth3units = 0 AND nmonth3dollars = 0
		ENDIF 
		
		oProgress.CloseProgress()
		
		SELECT wellhist
		SET FILTER TO
		
		SELECT taxtemp
		
		
		
	ENDPROC

	PROCEDURE calctax4		&& Calculates Tax 4
		LOCAL tcYear1, tcYear2, tcPeriod1, tcPeriod2, tcGroup, tcWell1, tcWell2, tcState
		LOCAL lnMax, lnCount, oProgress
		
		tcYear1    = THISFORM.swyear1.VALUE
		tcYear2    = THISFORM.swyear2.VALUE
		tcPeriod1  = THISFORM.swPeriod1.VALUE
		tcPeriod2  = THISFORM.swPeriod2.VALUE
		tcGroup    = LEFT(THISFORM.swgroup1.VALUE,2)
		tcWell1    = THISFORM.swrptlook1.txtBegID.VALUE
		tcWell2    = THISFORM.swrptlook1.txtEndID.VALUE
		tcState    = LEFT(THISFORM.swStates.VALUE,2)
		tlProdPrd  = THISFORM.chkProdPeriod.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWell1,tcWell2) ;
		      ORDER BY cid
		ENDIF
		
		CREATE CURSOR taxtemp ;
		   (cwellid    C(10), ;
		   cwellname  C(30), ;
		   cpermit1   c(20), ;
		   hyear      C(4), ;
		   hperiod    C(2), ;
		   ngasinc    N(12,2), ;
		   noilinc    N(12,2), ;
		   nothinc    N(12,2), ;
		   ntotbbl    N(12,4), ;
		   ntotmcf    N(12,4), ;
		   ntototh    N(12,4), ;
		   ntotbbltax N(12,2), ;
		   ntotmcftax N(12,2), ;
		   ntotothtax N(12,2))
		
		IF tlNoTable
		   IF tlProdPrd
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         wellhist.hyear, ;
		         wellhist.hperiod, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx4) AS ntotbbltx4, ;
		         SUM(wellhist.ntotmcftx4) AS ntotmcftx4, ;
		         SUM(wellhist.ntotothtx4) AS ntotothtx4, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(wellhist.hyear+wellhist.hperiod,tcYear1+tcPeriod1,tcYear2+tcPeriod2) ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState,.T.)  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
		         GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		   ELSE
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         ALLT(STR(YEAR(hdate))) AS hyear, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiod, ;
		         ALLT(STR(YEAR(hdate))) AS hyearx, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiodx, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx4) AS ntotbbltx4, ;
		         SUM(wellhist.ntotmcftx4) AS ntotmcftx4, ;
		         SUM(wellhist.ntotothtx4) AS ntotothtx4, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(ALLT(STR(YEAR(hdate)))+PADL(ALLT(STR(MONTH(hdate))),2,'0'),tcYear1+tcPeriod1,tcYear2+tcPeriod2)  ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState, .T.)  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid,hyearx,hperiodx  ;
		         GROUP BY wellhist.cwellid,hyearx,hperiodx
		   ENDIF
		ELSE
		   IF tlProdPrd
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         wellhist.hyear, ;
		         wellhist.hperiod, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx4) AS ntotbbltx4, ;
		         SUM(wellhist.ntotmcftx4) AS ntotmcftx4, ;
		         SUM(wellhist.ntotothtx4) AS ntotothtx4, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(wellhist.hyear+wellhist.hperiod,tcYear1+tcPeriod1,tcYear2+tcPeriod2) ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState,not EMPTY(wells.cTable))  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod ;
		         GROUP BY wellhist.cwellid, wellhist.hyear, wellhist.hperiod
		   ELSE
		      SELECT wellhist.cwellid, ;
		         wells.cwellname, ;
		         wells.cpermit1, ;
		         ALLT(STR(YEAR(hdate))) AS hyear, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiod, ;
		         ALLT(STR(YEAR(hdate))) AS hyearx, ;
		         PADL(ALLT(STR(MONTH(hdate))),2,'0') AS hperiodx, ;
		         SUM(wellhist.nGrossGas) AS ngasinc, ;
		         SUM(wellhist.nGrossOil) AS noilinc, ;
		         SUM(wellhist.nothinc) AS nothinc, ;
		         SUM(wellhist.ntotbbl) AS ntotbbl, ;
		         SUM(wellhist.ntotmcf) AS ntotmcf, ;
		         SUM(wellhist.ntotprod) AS ntototh, ;
		         SUM(wellhist.ntotbbltx4) AS ntotbbltx4, ;
		         SUM(wellhist.ntotmcftx4) AS ntotmcftx4, ;
		         SUM(wellhist.ntotothtx4) AS ntotothtx4, ;
		         lSev1O,lSev2O,lSev3O,lSev4O,lSev1G,lSev2G,lSev3G,lSev4G  ;
		         FROM wellhist, wells ;
		         WHERE BETWEEN(ALLT(STR(YEAR(hdate)))+PADL(ALLT(STR(MONTH(hdate))),2,'0'),tcYear1+tcPeriod1,tcYear2+tcPeriod2)  ;
		         AND IIF(tcGroup<>'**',wellhist.cgroup=tcGroup,.T.) ;
		         AND wellhist.cwellid = wells.cwellid ;
		         AND wellhist.crectype='R' ;
		         AND NOT wells.lthird_prty  ;
		         AND INLIST(wells.cwellstat,'A','N') ;
		         AND IIF(tcState<>'**',wells.cTable = tcState,not EMPTY(wells.cTable))  ;
		         AND wellhist.cwellid in (select cid from selected) ;
		         INTO CURSOR temptax READWRITE  ;
		         ORDER BY wellhist.cwellid,hyearx,hperiodx  ;
		         GROUP BY wellhist.cwellid,hyearx,hperiodx
		   ENDIF
		
		ENDIF
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Tax 4 Taxes by Period...')
		SELECT temptax
		COUNT ALL TO lnMax
		lnCount = 1
		oProgress.SetProgressRange(0,lnMax)
		
		*  We've now got all the right wells that need reported on in the temptax cursor.
		*  If reporting by prod period, scan the income table and remove any otax4
		*  entries that have the right period on them, and aren't in run 0.
		*  If reporting by accounting quarter, scan sysctl for runs closed in that
		*  time frame, then scan income and remove any otax4 entries in that run.
		*  Both scenarios are predicated upon the well existing in the temptax cursor, 
		*  so if it doesn't, skip it, since it shouldn't be getting included on the 
		*  report anyway.  So there!
		WAIT WINDOW NOWAIT 'Processing cost-recovery adjustments...'
		IF tlProdPrd
		   SELECT income
		   SCAN FOR BETWEEN(cYear+cPeriod,tcYear1+tcPeriod1,tcYear2+tcPeriod2)  ;
		      AND cSource = 'OTAX4' AND cRevKey = 'COST'
		      SELECT temptax
		      LOCATE FOR cWellID = income.cWellID AND hYear+hPeriod = income.cYear+income.cPeriod
		      IF FOUND()
		         replace temptax.nTotBBLTx4 WITH temptax.nTotBBLTx4 - income.nTotalInc
		      ENDIF 
		   ENDSCAN
		ELSE
		   SELECT sysctl
		   SCAN FOR cTypeClose = 'R' AND BETWEEN(ALLT(STR(YEAR(dAcctDate)))+PADL(ALLT(STR(MONTH(dAcctDate))),2,'0'),tcYear1+tcPeriod1,tcYear2+tcPeriod2)
		      SELECT income
		      SCAN FOR nRunNo = sysctl.nRunNo AND cRunYear = sysctl.cRunYear AND cSource = 'OTAX4' AND cRevKey = 'COST'
		         SELECT temptax
		         LOCATE FOR cWellID = income.cWellID AND hYear+hPeriod = income.cYear+income.cPeriod
		         IF FOUND()
		            replace temptax.nTotBBLTx4 WITH temptax.nTotBBLTx4 - income.nTotalInc
		         ENDIF 
		      ENDSCAN
		   ENDSCAN
		ENDIF 
		   
		
		SELECT temptax
		SCAN
		   SCATTER MEMVAR
		   oProgress.UpdateProgress(lnCount)
		   lnCount = lnCount + 1
		   
		   *  Check the settings for whether the purchaser withholds certain types of taxes, and remove those amounts
		   *  from the units reported
		   IF m.lSev4O AND NOT tlNoTable
		      SELECT temptax
		      replace nTotBBL WITH 0, nOilInc WITH 0
		      STORE 0 TO m.nTotBBL,m.nOilInc
		   ENDIF 
		   IF m.lSev4G AND NOT tlNoTable
		      SELECT temptax
		      replace nTotMCF WITH 0, nGasInc WITH 0
		      STORE 0 TO m.nTotMCF, m.nGasInc
		   endif
		   
		   m.ntotbbltax     = m.ntotbbltx4
		   m.ntotmcftax     = m.ntotmcftx4
		   m.ntotothtax     = m.ntotothtx4
		*!*	   IF NOT tlNoTable
		*!*	      m.ngasinc    = swNetRevenue(m.cwellid, m.ngasinc, 'G', .F.)
		*!*	      m.noilinc    = swNetRevenue(m.cwellid, m.noilinc, 'O', .F.)
		*!*	      m.ntotbbl    = swNetRevenue(m.cwellid, m.ntotbbl, 'O1', .F., .T., .F., .T.) 
		*!*	      m.ntotmcf    = swNetRevenue(m.cwellid, m.ntotmcf, 'G1', .F., .T., .F., .T.) 
		*!*	      m.ntotbbltax = swNetRevenue(m.cwellid, m.ntotbbltx4, 'O4', .F.,.T.,.T.,,.T.)
		*!*	      m.ntotmcftax = swNetRevenue(m.cwellid, m.ntotmcftx4, 'G4', .F.,.T.,.T.,,.T.)
		*!*	      m.ntotothtax = swNetRevenue(m.cwellid, m.ntotothtx4, 'P4', .F.,.T.,.T.,,.T.)
		*!*	   ENDIF
		   INSERT INTO taxtemp FROM MEMVAR
		ENDSCAN
		
		IF thisform.chkExcludeNoProd.Value = .t.
		   SELECT taxtemp
		   DELETE FOR ngasinc = 0 AND ntotmcftax = 0 ;
		          AND noilinc = 0 AND ntotbbltax = 0 ;
		          AND nothinc = 0 AND ntotothtax = 0
		ENDIF 
		
		oProgress.CloseProgress()
		
		
		
	ENDPROC

	PROCEDURE calctax4qtr		&& Calculates Tax 4 by Quarter
		LOCAL tnQuarter, tcYear, tcState, tlCheck, tlProdPrd
		LOCAL lnWellCnt, lcMonth1, lcMonth2, lcMonth3
		
		tnQuarter = THISFORM.opgQuarters.VALUE
		tcYear    = THISFORM.swYear1.VALUE
		tcState   = LEFT(THISFORM.swStates.VALUE, 2)
		tcGroup   = LEFT(THISFORM.swgroup1.VALUE, 2)
		tlProdPrd = THISFORM.chkProdPeriod.VALUE
		tcWellID1 = THISFORM.swrptlook1.txtBegID.VALUE
		tcWellID2 = THISFORM.swrptlook1.txtEndID.VALUE
		tlNoTable = THISFORM.chkNoTable.VALUE
		llSelected  = THISFORM.chkselected.VALUE
		
		IF NOT llSelected
		   SELECT cwellid AS cid FROM wells ;
		      INTO CURSOR SELECTED ;
		      WHERE BETWEEN(cwellid,tcWellID1,tcWellID2) ;
		      ORDER BY cid
		ENDIF
		
		DIME amcf(12)
		DIME abbl(12)
		DIME aoth(12)
		DIME atmcf(12)
		DIME atbbl(12)
		DIME atoth(12)
		DIME atax(12)
		DIME attax(12)
		DIME aquarter(4)
		DIME amonths(12)
		
		amcf  = 0
		abbl  = 0
		aoth  = 0
		atax  = 0
		atmcf = 0
		atbbl = 0
		atoth = 0
		attax = 0
		
		aquarter(1) = 1
		aquarter(2) = 4
		aquarter(3) = 7
		aquarter(4) = 10
		
		amonths(1)  = "Jan"
		amonths(2)  = "Feb"
		amonths(3)  = "Mar"
		amonths(4)  = "Apr"
		amonths(5)  = "May"
		amonths(6)  = "Jun"
		amonths(7)  = "Jul"
		amonths(8)  = "Aug"
		amonths(9)  = "Sep"
		amonths(10) = "Oct"
		amonths(11) = "Nov"
		amonths(12) = "Dec"
		
		CREATE CURSOR taxtemp ;
		    (crptgroup      C(1), ;
		      cwellid        C(10), ;
		      cwellname      C(30), ;
		      cpermit1       c(20), ;
		      cMonth1        C(10), ;
		      nmonth1units   N(12, 2), ;
		      nmonth1dollars N(12, 2),  ;
		      ntax1          N(12, 2), ;
		      cMonth2        C(10), ;
		      nmonth2units   N(12, 2), ;
		      nMonth2dollars N(12, 2),  ;
		      ntax2          N(12, 2), ;
		      cMonth3        C(10), ;
		      nmonth3units   N(12, 2), ;
		      nmonth3dollars N(12, 2),  ;
		      ntax3          N(12, 2))
		INDEX ON crptgroup + cwellid TAG cwellid
		
		DO CASE
		    CASE tnQuarter = 1
		        lcMonth1 = 'January'
		        lcMonth2 = 'February'
		        lcMonth3 = 'March'
		    CASE tnQuarter = 2
		        lcMonth1 = 'April'
		        lcMonth2 = 'May'
		        lcMonth3 = 'June'
		    CASE tnQuarter = 3
		        lcMonth1 = 'July'
		        lcMonth2 = 'August'
		        lcMonth3 = 'September'
		    CASE tnQuarter = 4
		        lcMonth1 = 'October'
		        lcMonth2 = 'November'
		        lcMonth3 = 'December'
		ENDCASE
		
		SELECT  cwellid, cwellname, cpermit1 ;
			FROM wells ;
			WHERE wells.cwellid in (SELECT cid FROM selected)  ;
				AND IIF(tcState <> '**', wells.cTable = tcState, IIF(NOT tlNoTable, NOT EMPTY(cTable) OR wells.lusesev = .T., .T.))  ;
		      AND INLIST(wells.cwellstat,'A','N') ;
				AND lthird_prty = .F. ; 
			ORDER BY cwellname ;
			INTO ARRAY awellsev
		
		lnWellCnt = _TALLY
		
		IF lnWellCnt = 0
		    RETURN
		ENDIF
		
		oProgress = THISFORM.oMessage.ProgressBar('Calculating Quarterly Tax 1 Taxes...')
		jMax      = lnWellCnt
		jCount    = 1
		oProgress.SetProgressRange(0, jMax)
		
		FOR i = 1 TO lnWellCnt
		    SELECT wellhist
		    IF tlProdPrd
		        IF tcGroup = '**'
		            SET FILTER TO hyear = tcYear AND cRecType = 'R'
		        ELSE
		            SET FILTER TO hyear = tcYear AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid = awellsev(i, 1) AND VAL(hperiod) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		                
		                IF EMPTY(m.cDeck)
		                  m.cDeck = thisform.oWellInv.DOIDeckNameLookup(m.hyear, m.hperiod, m.cWellID)
		               ENDIF 
		
		*  Scan to remove the adjusting entries from the tax amounts shown on the report.
		*  They technically belong to the previous quarter, so they shouldn't be part of
		*  the taxes that were withheld for this quarter.
		                SELECT income
		                SCAN FOR cwellid == m.cwellid AND cYear + cPeriod = m.hyear + m.hperiod  ;
		                        AND nRunNo = m.nRunNo AND cRunYear = m.cRunYear  ;
		                        AND cSource = 'OTAX4' AND cRevKey = 'COST'
		                    m.nTotBBLTx4 = m.nTotBBLTx4 - income.nTotalInc
		                ENDSCAN
		
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev4O       = lSev4O
		                    m.lSev4G       = lSev4G
		                    m.cPermit1 = cPermit1
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev4O       = .F.
		                    m.lSev4G       = .F.
		                    m.cPermit1 = ''
		                ENDIF
		
		                IF m.lSev4O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL, m.ntotbbltx4
		                ENDIF
		                IF m.lSev4G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF, m.ntotmcftx4
		                ENDIF
		
		*  If the purchaser withholds taxes on direct pays, remove the bbl and taxes
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ELSE
		                    IF NOT tlNoTable
		                        m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                        m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F., .T., .T., .F.,.F.,.F.,.F.,m.cDeck)
		                    ENDIF
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax = m.ntotbbltx4
		                    lnGasTax = m.ntotmcftx4
		                    lnOthTax = m.ntotothtx4
		                ELSE
		                    lnOilTax = swNetRevenue(m.cwellid, m.nTotBBLTx4, 'O4', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnGasTax = swNetRevenue(m.cwellid, m.ntotmcftx4, 'G4', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnOthTax = swNetRevenue(m.cwellid, m.ntotothtx4, 'P4', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ELSE
		        SELECT wellhist
		        IF tcGroup = '**'
		            SET FILTER TO  YEAR(hdate) = VAL(tcYear) AND cRecType = 'R'
		        ELSE
		            SET FILTER TO YEAR(hdate) = VAL(tcYear) AND cGroup = tcGroup AND cRecType = 'R'
		        ENDIF
		        xmonth = 1
		        FOR x = aquarter(tnQuarter) TO (aquarter(tnQuarter) + 2)
		            SCAN FOR cwellid = awellsev(i, 1) AND MONTH(hdate) = x
		                SCATTER MEMVAR
		                m.nOilInc = m.nGrossOil
		                m.nGasInc = m.nGrossGas
		
		*  Scan to remove the adjusting entries from the tax amounts shown on the report.
		*  They technically belong to the previous quarter, so they shouldn't be part of
		*  the taxes that were withheld for this quarter.
		                SELECT income
		                SCAN FOR cwellid == m.cwellid AND cYear + cPeriod = m.hyear + m.hperiod  ;
		                        AND nRunNo = m.nRunNo AND cRunYear = m.cRunYear  ;
		                        AND cSource = 'OTAX4' AND cRevKey = 'COST'
		                    m.nTotBBLTx4 = m.nTotBBLTx4 - income.nTotalInc
		                ENDSCAN
		
		*
		*  Get the flags for whether the purchaser withholds direct pay taxes
		*
		                SELE wells
		                LOCATE FOR cwellid = m.cwellid
		                IF FOUND()
		                    m.lDirOilPurch = lDirOilPurch
		                    m.lDirGasPurch = lDirGasPurch
		                    m.lSev4O       = lSev4O
		                    m.lSev4G       = lSev4G
		                    m.cPermit1     = cPermit1
		                ELSE
		                    m.lDirOilPurch = .F.
		                    m.lDirGasPurch = .F.
		                    m.lSev4O       = .F.
		                    m.lSev4G       = .F.
		                    m.cPermit1     = ''
		                ENDIF
		
		                IF m.lSev4O AND NOT tlNoTable
		                    STORE 0 TO m.nOilInc, m.nTotBBL
		                ENDIF
		                IF m.lSev4G AND NOT tlNoTable
		                    STORE 0 TO m.nGasInc, m.nTotMCF
		                ENDIF
		
		*  If the purchaser withholds taxes on direct pays, remove the bbl and taxes
		                IF m.lDirOilPurch
		                    m.nTotBBL = swNetRevenue(m.cwellid, m.nTotBBL, 'O', .F.,.F.,.F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nOilInc = swNetRevenue(m.cwellid, m.nOilInc, 'O', .F.,.F.,.F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ENDIF
		                IF m.lDirGasPurch
		                    m.nTotMCF = swNetRevenue(m.cwellid, m.nTotMCF, 'G', .F.,.F., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                    m.nGasInc = swNetRevenue(m.cwellid, m.nGasInc, 'G', .F.,.F., .F.,.F.,.F.,.F.,.F.,m.cDeck)
		                ENDIF
		
		                IF tlNoTable
		                    lnOilTax = swNetRevenue(m.cwellid, m.ntotbbltx4, 'O4', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnGasTax = swNetRevenue(m.cwellid, m.ntotmcftx4, 'G4', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                    lnOthTax = swNetRevenue(m.cwellid, m.ntotothtx4, 'P4', .F., .T., .T., .F., .T., .F., .T., m.cDeck)
		                ELSE
		                    lnOilTax = m.nTotBBLTx4
		                    lnGasTax = m.ntotmcftx4
		                    lnOthTax = m.ntotothtx4
		                ENDIF
		
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('A' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth1units   WITH nmonth1units + m.nTotBBL, ;
		                            ntax1          WITH ntax1 + lnOilTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOilInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth2units   WITH nmonth2units + m.nTotBBL, ;
		                            ntax2          WITH ntax2 + lnOilTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOilInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'A', ;
		                            nmonth3units   WITH nmonth3units + m.nTotBBL, ;
		                            ntax3          WITH ntax3 + lnOilTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOilInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('B' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth1units   WITH nmonth1units + m.nTotMCF, ;
		                            ntax1          WITH ntax1 + lnGasTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nGasInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth2units   WITH nmonth2units + m.nTotMCF, ;
		                            ntax2          WITH ntax2 + lnGasTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nGasInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'B', ;
		                            nmonth3units   WITH nmonth3units + m.nTotMCF, ;
		                            ntax3          WITH ntax3 + lnGasTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nGasInc
		                ENDCASE
		                SELECT taxtemp
		                SET ORDER TO cwellid
		                IF NOT SEEK('C' + awellsev(i, 1))
		                    APPEND BLANK
		                    REPLACE cwellid   WITH awellsev(i, 1), ;
		                        cwellname WITH awellsev(i, 2), ;
		                        cpermit1  WITH m.cpermit1, ;
		                        cMonth1   WITH lcMonth1, ;
		                        cMonth2   WITH lcMonth2, ;
		                        cMonth3   WITH lcMonth3
		                ENDIF
		                DO CASE
		                    CASE xmonth = 1
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth1units   WITH nmonth1units + m.ntotprod, ;
		                            ntax1          WITH ntax1 + lnOthTax,  ;
		                            nmonth1dollars WITH nmonth1dollars + m.nOthInc
		                    CASE xmonth = 2
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth2units   WITH nmonth2units + m.ntotprod, ;
		                            ntax2          WITH ntax2 + lnOthTax,  ;
		                            nMonth2dollars WITH nMonth2dollars + m.nOthInc
		                    CASE xmonth = 3
		                        REPLACE crptgroup WITH 'C', ;
		                            nmonth3units   WITH nmonth3units + m.ntotprod, ;
		                            ntax3          WITH ntax3 + lnOthTax,  ;
		                            nmonth3dollars WITH nmonth3dollars + m.nOthInc
		                ENDCASE
		            ENDSCAN
		            xmonth = xmonth + 1
		        ENDFOR
		    ENDIF
		    oProgress.UpdateProgress(jCount)
		    jCount = jCount + 1
		ENDFOR
		
		
		IF thisform.chkExcludeNoProd.Value = .t.
		   SELECT taxtemp
		   DELETE FOR nmonth1units = 0 AND nmonth1dollars = 0 ;
		          AND nmonth2units = 0 AND nmonth2dollars = 0 ;
		          AND nmonth3units = 0 AND nmonth3dollars = 0
		ENDIF 
		
		oProgress.CloseProgress()
		
		SELECT wellhist
		SET FILTER TO
		
		SELECT taxtemp
		
		
		
	ENDPROC

	PROCEDURE Destroy
		thisform.oWellInv = .Null.
		DODEFAULT()
	ENDPROC

	PROCEDURE Init
		LPARA tcTaxType
		
		IF TYPE('tcTaxType') <> 'C'
		   tcTaxType = 'S'
		ENDIF
		
		SET DELETED ON
		
		
		SELECT wells
		SET ORDER TO cWellID
		
		GO TOP
		THISFORM.swrptlook1.txtBegName.VALUE = cwellname
		THISFORM.swrptlook1.txtBegID.VALUE = cWellID
		
		GO BOTTOM
		THISFORM.swrptlook1.txtEndName.VALUE = cwellname
		THISFORM.swrptlook1.txtEndID.VALUE = cWellID
		
		THISFORM.swyear1.lenabled = .T.
		THISFORM.swyear2.lenabled = .F.
		THISFORM.swperiod1.lenabled = .F.
		THISFORM.swperiod2.lenabled = .F.
		
		thisform.chkprodperiod.value = .f.
		
		thisform.oWellInv = CREATEOBJECT('swbizobj_wellinv')
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE cboTaxType.Init
		this.addlistitem('Tax 1',1,1)
		this.addlistitem('1',1,2)
		this.addlistitem('Tax 2',2,1)
		this.addlistitem('2',2,2)
		this.addlistitem('Tax 3',3,1)
		this.addlistitem('3',3,2)
		this.addlistitem('Tax 4',4,1)
		this.addlistitem('4',4,2)
		
		this.listitemid = 1
	ENDPROC

	PROCEDURE chkSelected.Click
		IF this.Value
		   DO FORM commonsource\selected-ids WITH 'WELL' LINKED 
		   lnCount = RECCOUNT('selected')
		   thisform.lblselected.Caption = TRANSFORM(lnCount) + ' Wells Selected'
		   thisform.lblselected.Visible = .T.
		   thisform.lblbegID.Visible = .F.
		   thisform.lblendID.Visible = .F.
		   thisform.swrptlook1.Visible = .F.
		ELSE
		   thisform.lblselected.Visible = .F.
		   thisform.lblbegID.Visible = .T.
		   thisform.lblendID.Visible = .T.
		   thisform.swrptlook1.Visible = .T.
		ENDIF 
	ENDPROC

	PROCEDURE OpgQuarters.Init
		this.q1.value = 1
	ENDPROC

	PROCEDURE OpgQuarters.Q1.GotFocus
		THISFORM.opgQuarters.VALUE = 1
		
	ENDPROC

	PROCEDURE OpgQuarters.Q2.GotFocus
		THISFORM.opgQuarters.VALUE = 2
	ENDPROC

	PROCEDURE OpgQuarters.Q3.GotFocus
		THISFORM.opgQuarters.VALUE = 3
	ENDPROC

	PROCEDURE OpgQuarters.Q4.GotFocus
		THISFORM.opgQuarters.VALUE = 4
	ENDPROC

	PROCEDURE OpgQuarters.When
		RETURN thisform.opgReportBy.value = 1
	ENDPROC

	PROCEDURE opgReportBy.Init
		this.value = 1
	ENDPROC

	PROCEDURE opgReportBy.Valid
		DO CASE
		   CASE this.value = 1
		      thisform.swYear2.visible = .f.
		      thisform.swPeriod1.visible = .f.
		      thisform.swPeriod2.visible = .f.
		      thisform.lblBegPeriod.Visible = .f.
		      thisform.lblEndPeriod.Visible = .f.
		      thisform.lblEndYear.Visible = .f.
		      thisform.lblBegYear.caption = 'Year:'
		      thisform.lblBegYear.Left = 87
		      thisform.opgQuarters.q1.enabled = .t.
		      thisform.opgQuarters.q2.enabled = .t.
		      thisform.opgQuarters.q3.enabled = .t.
		      thisform.opgQuarters.q4.enabled = .t.
		   CASE this.value = 2   
		      thisform.swYear2.visible = .t.
		      thisform.swPeriod1.visible = .t.
		      thisform.swPeriod2.visible = .t.
		      thisform.lblBegPeriod.Visible = .t.
		      thisform.lblEndPeriod.Visible = .t.
		      thisform.lblEndYear.Visible = .t.
		      thisform.lblBegYear.caption = 'Beginning Year:'
		      thisform.lblBegYear.Left = 37
		      thisform.opgQuarters.q1.enabled = .f.
		      thisform.opgQuarters.q2.enabled = .f.
		      thisform.opgQuarters.q3.enabled = .f.
		      thisform.opgQuarters.q4.enabled = .f.
		ENDCASE      
	ENDPROC

	PROCEDURE Swperiod1.When
		RETURN thisform.opgReportBy.value = 2
	ENDPROC

	PROCEDURE Swperiod2.When
		RETURN thisform.opgReportBy.value = 2
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cwellid,cwellname,cgroup,cwellstat'
		DO FORM ..\custom\picklist WITH 'Wells', lcList, thisform.swrptlook1.txtbegid.value, 4
		
		IF llOK
		   thisform.swrptlook1.txtBegId.value = cwellid
		   thisform.swrptlook1.txtBegName.value = cwellname
		   thisform.swrptlook1.txtBegId.refresh()
		   thisform.swrptlook1.txtBegName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(thisform.swrptlook1.txtBegId)
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cwellid,cwellname,cgroup,cwellstat'
		DO FORM ..\custom\picklist WITH 'Wells', lcList, thisform.swrptlook1.txtendid.value, 4
		
		IF llOK
		   thisform.swrptlook1.txtEndId.value = cwellid
		   thisform.swrptlook1.txtEndName.value = cwellname
		   thisform.swrptlook1.txtEndId.refresh()
		   thisform.swrptlook1.txtEndName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(thisform.swrptlook1.txtEndId)
		
	ENDPROC

	PROCEDURE swstates.Init
		
		*
		*  Load the laStates Array
		*
		SELE cTable+' - '+cDescription AS cTable FROM sevtax INTO ARRAY laStates ORDER BY cTable
		
		IF _tally > 0
		   this.AddListItem('** - All Tables')
		   FOR lnx = 2 TO _tally+1
		      this.addlistitem(laStates[lnX-1])
		   ENDFOR
		      
		  * Set default item to 1st
		  this.listitemid = 1
		
		ENDIF
		
		DODEFAULT()
	ENDPROC

	PROCEDURE Swyear2.When
		RETURN thisform.opgReportBy.value = 2
	ENDPROC

ENDDEFINE
