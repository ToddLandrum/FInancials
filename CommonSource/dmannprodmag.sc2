*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="dmannprodmag.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 174
	Left = 28
	Name = "Dataenvironment"
	Top = 363
	Width = 676

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "annprod", ;
		CursorSource = "annprod", ;
		Database = ..\amdata\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "wells", ;
		CursorSource = "wells", ;
		Database = ..\amdata\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "Form6s", ;
		CursorSource = "Form6s", ;
		Database = ..\amdata\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "revsrc", ;
		CursorSource = "revsrc", ;
		Database = ..\amdata\appdata.dbc, ;
		Height = 90, ;
		Left = 430, ;
		Name = "Cursor4", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formdmannprodmag AS frmformcustom OF "..\custom\cforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="LblProdYear" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblFirstWell" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblLastWell" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swyear1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdcommandbuttoncustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdcommandbuttoncustom2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cntgetfile1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom6" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: buildfile
		*p: cdriveletter
		*p: cstate
		*p: cyear
	*</DefinedPropArrayMethod>

	Caption = "Annual Statement of Production"
	DataSession = 2
	DoCreate = .T.
	Height = 279
	HelpContextID = 605
	Name = "FormDmannprodmag"
	Width = 445
	Mwresize1.lblHighLight.Name = "lblHighLight"
	Mwresize1.lblShading.Name = "lblShading"
	Mwresize1.Name = "Mwresize1"

	ADD OBJECT 'Cmdcommandbuttoncustom1' AS cmdcommandbuttoncustom WITH ;
		Caption = "\<Build File", ;
		Default = .T., ;
		Height = 31, ;
		Left = 125, ;
		Name = "Cmdcommandbuttoncustom1", ;
		TabIndex = 7, ;
		Top = 228, ;
		Width = 78
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdcommandbuttoncustom2' AS cmdcommandbuttoncustom WITH ;
		Caption = "E\<xit", ;
		Height = 31, ;
		Left = 230, ;
		Name = "Cmdcommandbuttoncustom2", ;
		TabIndex = 9, ;
		Top = 228, ;
		Width = 78
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cntgetfile1' AS cntgetfile WITH ;
		cdefaultextension = , ;
		cextensionlist = , ;
		Height = 20, ;
		Left = 101, ;
		lfullpath = .T., ;
		lmustexist = .F., ;
		lpathonly = .F., ;
		Name = "Cntgetfile1", ;
		TabIndex = 6, ;
		Top = 174, ;
		Width = 300, ;
		cmdPath.FontBold = .T., ;
		cmdPath.FontSize = 10, ;
		cmdPath.Height = 20, ;
		cmdPath.Left = 273, ;
		cmdPath.Name = "cmdPath", ;
		cmdPath.TabStop = .F., ;
		cmdPath.Top = 0, ;
		edtPath.FontSize = 8, ;
		edtPath.Height = 20, ;
		edtPath.Left = 0, ;
		edtPath.Margin = 1, ;
		edtPath.Name = "edtPath", ;
		edtPath.Top = 0, ;
		edtPath.Width = 266
		*< END OBJECT: ClassLib="..\common\cmgadget.vcx" BaseClass="container" />

	ADD OBJECT 'LblFirstWell' AS lbllabelcustom WITH ;
		Caption = "First Well:", ;
		Height = 16, ;
		Left = 43, ;
		Name = "LblFirstWell", ;
		TabIndex = 4, ;
		Top = 72, ;
		Width = 49
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom6' AS lbllabelcustom WITH ;
		Caption = "File Location:", ;
		Height = 16, ;
		Left = 24, ;
		Name = "Lbllabelcustom6", ;
		TabIndex = 8, ;
		Top = 178, ;
		Width = 65, ;
		ZOrderSet = 8
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblLastWell' AS lbllabelcustom WITH ;
		Caption = "Last Well:", ;
		Height = 16, ;
		Left = 43, ;
		Name = "LblLastWell", ;
		TabIndex = 5, ;
		Top = 124, ;
		Width = 49
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblProdYear' AS lbllabelcustom WITH ;
		Caption = "Year:", ;
		Height = 16, ;
		Left = 63, ;
		Name = "LblProdYear", ;
		TabIndex = 2, ;
		Top = 43, ;
		Width = 29
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 100, ;
		Name = "Swrptlook1", ;
		TabIndex = 3, ;
		Top = 68, ;
		Width = 216, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		TxtBegID.clistexpression = wells.cwellid, ;
		TxtBegID.clistworkarea = wells, ;
		TxtBegID.Name = "TxtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		TxtEndID.clistexpression = wells.cwellid, ;
		TxtEndID.clistworkarea = wells, ;
		TxtEndID.Name = "TxtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />

	ADD OBJECT 'Swyear1' AS swyear WITH ;
		Left = 100, ;
		lnoinit = .T., ;
		Name = "Swyear1", ;
		TabIndex = 1, ;
		Top = 40
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="textbox" />
	
	PROCEDURE buildfile
		LOCAL lcFileName,lnCount
		
		lcFileName = thisform.cntgetfile1.edtPath.value
		
		if used('prodrpt')
		   use in prodrpt
		endif
		
		THIS.cYear = ALLTRIM(THISFORM.swyear1.VALUE)
		
		IF FILE(lcFileName)
		   IF NOT THISFORM.oMessage.CONFIRM('The production file already exists.  Overwrite?')
		      RETURN 0
		   ENDIF
		   SET SAFETY OFF
		ENDIF
		
		CREATE cursor prodrpt ;
		  (crptYear     c(4), ;
		   cownerNo     c(8), ;  
		   cowner       C(25), ;
		   capia        c(4), ;
		   capib        c(4), ;
		   capic        c(4), ;
		   ccounty      C(5), ;
		   ctownship    C(20), ;
		   cwellnum     C(8), ;
		   cleasename   C(35), ;
		   csection     c(4), ;
		   clot         C(4), ;
		   noilbbl      C(6), ;      
		   ngasmcf      C(6), ;
		   nbrine       C(6), ;
		   ndayson      C(4), ;
		   ctanks       C(5), ;
		   cmaxcap      C(8))
		
		lnCount = 0
		SET DECIMAL TO 0
		
		* Insert header row
		m.crptyear   = 'YR'
		m.cownerno   = 'OWNNUM'
		m.cowner     = 'NAME'
		m.capia      = 'APIA'
		m.capib      = 'APIB'
		m.capic      = 'APIC'
		m.ccounty    = 'COUNT'
		m.ctownship  = 'TOWN'
		m.cwellnum   = 'WELLN'
		m.cleasename = 'LEASE'
		m.csection   = 'SECT'
		m.clot       = 'LOT'
		m.noilbbl    = 'OIL'
		m.ngasmcf    = 'GAS'
		m.nbrine     = 'BRINE'
		m.ndayson    = 'DAYS'
		m.ctanks     = 'TANKS'
		m.cmaxcap    = 'CAPACITY'
		INSERT INTO prodrpt FROM MEMVAR 
		
		m.crptyear   = this.cyear
		m.cowner     = UPPER(m.goApp.ccompanyname)
		
		SELECT annprod
		SCAN FOR cWellState = THIS.cState AND cyear = THIS.cyear AND NOT DELETED()
		   SCATTER MEMVAR
		   m.cpermit = STRTRAN(m.cpermit,'-','')
		   m.cpermit = STRTRAN(m.cpermit,'#','')
		   m.cpermit = STRTRAN(m.cpermit,'(','')
		   m.cpermit = STRTRAN(m.cpermit,')','')
		   m.cpermit = ALLTRIM(m.cpermit)
		   m.capia   = SUBSTR(m.cpermit,3,3)
		   m.capib   = SUBSTR(m.cpermit,6,1)
		   m.capic   = SUBSTR(m.cpermit,7)
		   IF '-' $ cownerno
		      m.cownerno   = strtran(cownerno,'-','')
		   ELSE
		      m.cownerno = cownerno
		   ENDIF
		   m.ccounty    = UPPER(LEFT(m.ccounty,4))
		   m.cwellnum   = m.cwellid
		   m.ctownship  = UPPER(m.ctownship)
		   m.cleasename = UPPER(m.cwellname)
		   m.noilbbl    = TRANSFORM(m.noilbbl)
		   m.ngasmcf    = TRANSFORM(m.ngasmcf)
		   m.nbrine     = TRANSFORM(m.nsaltbbl)
		   m.ndayson    = TRANSFORM(m.ndayson)
		   m.ctanks     = m.cfacility
		   m.cmaxcap    = m.cfacpermit
		   INSERT INTO prodrpt FROM MEMVAR
		   lnCount = lncount + 1
		ENDSCAN
		
		IF lnCount > 0
		   sele prodrpt
		   llError = .F.
		   TRY 
		   copy to (lcFileName) type delimited
		   CATCH TO loError
		     llerror = .t.
		   ENDTRY 
		   IF llError = .F.
		      THISFORM.oMessage.DISPLAY('Created ' + ALLTRIM(STR(lnCount)) + ' Records.')
		   ELSE
		      THISFORM.oMessage.DISPLAY('Unable to create the electronic file. Please try a different file name.')
		   ENDIF    
		ELSE
		   THISFORM.oMessage.DISPLAY('No records found on which to report.')
		ENDIF
		
	ENDPROC

	PROCEDURE Init
		LPARA tcState
		
		DODEFAULT()
		IF TYPE('tcState') <> 'C'
		   tcState = 'OH'
		ENDIF   
		THIS.cstate = tcstate
		
		oMessage = findglobalobject('cmMessage')
		
		SELECT wells
		SET ORDER TO cWellID
		set deleted on
		GO TOP
		
		THISFORM.swrptlook1.txtBegName.VALUE = cwellname
		THISFORM.swrptlook1.txtBegID.VALUE = cWellID
		GO BOTTOM
		
		THISFORM.swrptlook1.txtEndName.VALUE = cwellname
		THISFORM.swrptlook1.txtEndID.VALUE = cWellID
		
		DO CASE
		   CASE tcState = 'OH'
		      THIS.CAPTION = 'Ohio Form 10 Magnetic File'
		      thisform.HelpContextID = 609
		   CASE tcState = 'NY'
		      THIS.CAPTION = 'Create NY Magnetic Media File'   
		      thisform.HelpContextID = 605
		ENDCASE
		
		thisform.cntgetfile1.edtpath.value = specialfolders('CommonDocuments')+'form10.csv'
		
		swselect('annprod')
		SELECT MAX(cyear) as maxyear FROM annprod WHERE cstate==tcState INTO CURSOR tempyear
		thisform.swyear1.Value = maxyear
		
		IF EMPTY(thisform.swyear1.Value)
		   thisform.swyear1.Value = ALLTRIM(STR(YEAR(DATE())))
		ENDIF 
	ENDPROC

	PROCEDURE Cmdcommandbuttoncustom1.Click
		thisform.buildfile()
	ENDPROC

	PROCEDURE Cmdcommandbuttoncustom2.Click
		thisform.release()
	ENDPROC

	PROCEDURE Cntgetfile1.cmdPath.Click
		IF NOT DIRECTORY(THISFORM.cntgetfile1.edtpath.VALUE)
		   THISFORM.cntgetfile1.edtpath.VALUE = ''
		endif
		DODEFAULT()
		
		*!*	lcFileName = ALLT(STRTRAN(LOWER(m.goApp.ccompanyname),' ',''))
		*!*	lcFileName = STRTRAN(lcFileName,',','')
		*!*	lcFileName = STRTRAN(lcFileName,'.','')
		*!*	lcFileName = STRTRAN(lcFileName,'-','')
		*!*	lcFileName = STRTRAN(lcFileName,'#','')
		*!*	lcFileName = STRTRAN(lcFileName,'&','')
		*!*	lcFileName = lcFileName + '.zip'
		THISFORM.cntgetfile1.edtpath.VALUE = ALLT(THISFORM.cntgetfile1.edtpath.VALUE) &&+ lcFileName
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cwellid,cwellname,cgroup,cwellstat'
		DO FORM ..\custom\picklist WITH 'Wells', lcList, thisform.swrptlook1.txtbegid.value, 4
		
		IF llOK
		   thisform.swrptlook1.txtBegId.value = cwellid
		   thisform.swrptlook1.txtBegName.value = cwellname
		   thisform.swrptlook1.txtBegId.refresh()
		   thisform.swrptlook1.txtBegName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(thisform.swrptlook1.txtBegId)
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cwellid,cwellname,cgroup,cwellstat'
		DO FORM ..\CUSTOM\picklist WITH 'Wells', lcList, thisform.swrptlook1.txtendid.value, 4
		
		IF llOK
		   THISFORM.swrptlook1.txtEndId.VALUE = cwellid
		   THISFORM.swrptlook1.txtEndName.VALUE = cwellname
		   THISFORM.swrptlook1.txtEndId.REFRESH()
		   THISFORM.swrptlook1.txtEndName.REFRESH()
		ENDIF
		
		THISFORM.setnextcontrol(THISFORM.swrptlook1.txtEndId)
		
	ENDPROC

	PROCEDURE Swyear1.Valid
		IF EMPTY(this.Value)
		   this.value = ALLTRIM(STR(YEAR(DATE())))
		ENDIF
		
		DODEFAULT()
	ENDPROC

ENDDEFINE
