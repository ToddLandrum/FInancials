*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="apvendrpt.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor9" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 477
	InitialSelectedAlias = "vendor"
	Left = 512
	Name = "Dataenvironment"
	Top = 289
	Width = 583

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "vendor", ;
		BufferModeOverride = 5, ;
		CursorSource = "vendor", ;
		Database = ..\amdata\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "appurchh", ;
		CursorSource = "appurchh", ;
		Database = ..\..\dmie_rv\datafiles\bbloildata\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "appurchd", ;
		CursorSource = "appurchd", ;
		Database = ..\..\dmie_rv\datafiles\bbloildata\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "csdishdr", ;
		CursorSource = "csdishdr", ;
		Database = ..\..\dmie_rv\datafiles\bbloildata\appdata.dbc, ;
		Height = 90, ;
		Left = 430, ;
		Name = "Cursor4", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor5' AS cursor WITH ;
		Alias = "csdisdet", ;
		CursorSource = "csdisdet", ;
		Database = ..\..\dmie_rv\datafiles\bbloildata\appdata.dbc, ;
		Height = 90, ;
		Left = 448, ;
		Name = "Cursor5", ;
		Top = 180, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor6' AS cursor WITH ;
		Alias = "expense", ;
		CursorSource = "expense", ;
		Database = ..\..\dmie_rv\datafiles\bbloildata\appdata.dbc, ;
		Height = 90, ;
		Left = 448, ;
		Name = "Cursor6", ;
		Top = 180, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor7' AS cursor WITH ;
		Alias = "checks", ;
		CursorSource = "checks", ;
		Database = ..\..\dmie_rv\datafiles\bbloildata\appdata.dbc, ;
		Height = 90, ;
		Left = 448, ;
		Name = "Cursor7", ;
		Top = 180, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor8' AS cursor WITH ;
		Alias = "terms", ;
		CursorSource = "terms", ;
		Database = ..\amdata\appdata.dbc, ;
		Height = 90, ;
		Left = 273, ;
		Name = "Cursor8", ;
		Top = 173, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor9' AS cursor WITH ;
		Alias = "finchgs", ;
		CursorSource = "finchgs", ;
		Database = ..\amdata\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor9", ;
		Top = 260, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formapvendlist AS frmrptcriteria OF "..\source\appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="opgSort" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="opgType" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblEndID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblBegID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblType" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblSort" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chklRecalc" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkSelected" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblSelected" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: vendorhistory
	*</DefinedPropArrayMethod>

	Caption = "Vendor Listing"
	DoCreate = .T.
	Height = 412
	HelpContextID = 228
	Name = "FormApvendlist"
	Width = 447
	Swrptcriteriabuttons1.chkExport.Alignment = 0
	Swrptcriteriabuttons1.chkExport.Name = "chkExport"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.cmdPreview.Name = "cmdPreview"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 106
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.TabIndex = 9
	Swrptcriteriabuttons1.Top = 324
	Swrptcriteriabuttons1.ZOrderSet = 0

	ADD OBJECT 'chklRecalc' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Recalculate Purchase/Payment History ", ;
		Left = 156, ;
		Name = "chklRecalc", ;
		TabIndex = 8, ;
		Top = 283, ;
		Value = .F.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkSelected' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Choose Selected Vendors", ;
		Height = 16, ;
		Left = 161, ;
		Name = "chkSelected", ;
		TabIndex = 1, ;
		Top = 151, ;
		Value = .F., ;
		Width = 145, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'lblBegID' AS lblfieldlabelcustom WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Beginning ID:", ;
		Height = 16, ;
		Left = 72, ;
		Name = "lblBegID", ;
		TabIndex = 6, ;
		Top = 178, ;
		Width = 64, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblEndID' AS lblfieldlabelcustom WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Ending ID:", ;
		Height = 16, ;
		Left = 87, ;
		Name = "lblEndID", ;
		TabIndex = 7, ;
		Top = 229, ;
		Width = 49, ;
		ZOrderSet = 4
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblSelected' AS lbllabelcustom WITH ;
		Caption = "All IDs Selected", ;
		ForeColor = 0,0,255, ;
		Height = 16, ;
		Left = 160, ;
		Name = "lblSelected", ;
		TabIndex = 9, ;
		Top = 217, ;
		Visible = .F., ;
		Width = 77, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblSort' AS lblfieldlabelcustom WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Sort By:", ;
		Height = 16, ;
		Left = 95, ;
		Name = "lblSort", ;
		TabIndex = 2, ;
		Top = 44, ;
		Width = 41, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblType' AS lblfieldlabelcustom WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Report Type:", ;
		Height = 16, ;
		Left = 72, ;
		Name = "lblType", ;
		TabIndex = 4, ;
		Top = 102, ;
		Width = 64, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'opgSort' AS opgoptiongroupcustom WITH ;
		BorderStyle = 0, ;
		ButtonCount = 2, ;
		Height = 44, ;
		Left = 156, ;
		Name = "opgSort", ;
		TabIndex = 1, ;
		Top = 38, ;
		Width = 108, ;
		ZOrderSet = 1, ;
		Option1.AutoSize = .T., ;
		Option1.Caption = "Vendor ID", ;
		Option1.FontSize = 8, ;
		Option1.Height = 16, ;
		Option1.Left = 5, ;
		Option1.Name = "optVendID", ;
		Option1.Top = 5, ;
		Option1.Width = 66, ;
		Option2.AutoSize = .T., ;
		Option2.Caption = "Vendor Name", ;
		Option2.FontSize = 8, ;
		Option2.Height = 16, ;
		Option2.Left = 5, ;
		Option2.Name = "optName", ;
		Option2.Top = 24, ;
		Option2.Width = 84
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'opgType' AS opgoptiongroupcustom WITH ;
		AutoSize = .T., ;
		BorderStyle = 0, ;
		ButtonCount = 2, ;
		Height = 45, ;
		Left = 157, ;
		Name = "opgType", ;
		TabIndex = 3, ;
		Top = 96, ;
		Width = 108, ;
		ZOrderSet = 2, ;
		Option1.AutoSize = .T., ;
		Option1.Caption = "Summary Report", ;
		Option1.FontSize = 8, ;
		Option1.Height = 16, ;
		Option1.Left = 5, ;
		Option1.Name = "optSummary", ;
		Option1.Top = 5, ;
		Option1.Width = 98, ;
		Option2.AutoSize = .T., ;
		Option2.Caption = "Detail Report", ;
		Option2.FontSize = 8, ;
		Option2.Height = 16, ;
		Option2.Left = 5, ;
		Option2.Name = "optDetail", ;
		Option2.Top = 24, ;
		Option2.Width = 79
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 156, ;
		Name = "Swrptlook1", ;
		TabIndex = 5, ;
		Top = 175, ;
		ZOrderSet = 3, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		TxtBegID.clistexpression = vendor.cvendorid, ;
		TxtBegID.clistworkarea = vendor, ;
		TxtBegID.Name = "TxtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		TxtEndID.clistexpression = vendor.cvendorid, ;
		TxtEndID.clistworkarea = vendor, ;
		TxtEndID.Name = "TxtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />
	
	PROCEDURE builddata
		tcVendor1  = THISFORM.swrptlook1.txtBegID.VALUE
		tcVendor2  = THISFORM.swrptlook1.txtEndID.VALUE
		tlSelected = THISFORM.chkselected.VALUE
		
		IF NOT tlSelected
		   SELECT cvendorid AS cid FROM vendor ;
		      WHERE BETWEEN(cvendorid,tcVendor1,tcVendor2) ;
		      INTO CURSOR SELECTED ;
		      ORDER BY cid
		ENDIF
		
		cBetween = "vendor.cvendorid in (select cid from selected)"
		
		DO CASE
		   CASE THISFORM.opgSort.VALUE = 1		&&	Vend ID
		      csortby = '1'
		      THISFORM.cTitle1 = ''
		      THISFORM.cTitle2 = ''
		      THISFORM.cSortOrder      = 'Vendor ID'
		      THISFORM.cSelectCriteria = 'Vendors:  ' + ALLTRIM(THISFORM.swrptlook1.txtBegID.VALUE) + ' - ' + THISFORM.swrptlook1.txtEndID.VALUE
		   CASE THISFORM.opgSort.VALUE = 2		&&	Vend Name
		      csortby = '2'
		      THISFORM.cTitle1 = ''
		      THISFORM.cTitle2 = ''
		      THISFORM.cSortOrder      = 'Vendor Name'
		      THISFORM.cSelectCriteria = 'Vendors:  ' + ALLTRIM(THISFORM.swrptlook1.txtBegName.VALUE) + ' - ' + THISFORM.swrptlook1.txtEndname.VALUE
		ENDCASE
		
		DO CASE
		
		   CASE THISFORM.opgType.VALUE = 1		&&	Summary Rpt      
		      SELECT vendor.cvendorid, vendor.cSortField, vendor.cVendName, vendor.caddress1 AS cbaddr1, vendor.caddress2 AS cbaddr2, ;
		         vendor.ccity AS cbcity, vendor.cstate AS cbstate, vendor.czip AS cbzip, vendor.cphone AS cbphone, ;
		         vendor.cfaxphone AS cbfaxphone, vendor.ncurbal, terms.ctermdesc, vendor.cemail ;
		         FROM vendor, terms  ;
		         WHERE &cbetween  ;
		         AND vendor.cidterm = terms.cidterm  ;
		         UNION  ;
		         SELECT vendor.cvendorid, vendor.cSortField, vendor.cVendName, vendor.caddress1 AS cbaddr1, vendor.caddress2 AS cbaddr2, ;
		         vendor.ccity AS cbcity, vendor.cstate AS cbstate, vendor.czip AS cbzip, vendor.cphone AS cbphone, ;
		         vendor.cfaxphone AS cbfaxphone, vendor.ncurbal, SPACE(20) AS ctermdesc, vendor.cemail ;
		         FROM vendor  ;
		         WHERE &cbetween  ;
		         AND EMPTY(vendor.cidterm)  ;
		         ORDER BY &csortby  ;
		         INTO CURSOR vendorlist
		      THISFORM.cReportName = '..\commonsource\apvend1.frx'
		
		   CASE THISFORM.opgType.VALUE = 2		&&	Detail Rpt
		      
		      IF THISFORM.chklRecalc.VALUE = .T.  &&  Recalculate Vendor History
		         THISFORM.VendorHistory()
		      ENDIF
		      
		      SELECT vendor.cvendorid, vendor.cSortField, vendor.cVendName, vendor.caddress1, vendor.caddress2, ;
		         vendor.ccity, vendor.cstate, vendor.czip, vendor.ctaxid, vendor.cphone, ;
		         vendor.ccontact, vendor.lsend1099, vendor.cfaxphone, vendor.cbaddr1, ;
		         vendor.cbaddr2, vendor.cbcity, vendor.cbstate, vendor.cbzip, vendor.mvendnote, ;
		         vendor.cbcontact, vendor.npurchytd, vendor.npurchlytd, vendor.dlastpurch, ;
		         vendor.nlastpurch, vendor.nlastpmt, vendor.ntotpurch, vendor.cbphone, ;
		         vendor.cbfaxphone, vendor.ncurbal, vendor.nbal30_60, vendor.nbal60_90, ;
		         vendor.nbalov90, vendor.ncreditlim, cidterm, SPACE(20) as ctermdesc, cFinCode, 00.0000 as nfinint, vendor.cemail ;
		         FROM vendor  ;
		         WHERE &cbetween  ;         
		         INTO CURSOR vendorlist readwrite ;
		         ORDER BY &csortby
		         
		      swselect('terms')  &&  Fill in terms description
		      SCAN
		         SELECT VendorList
		         SCAN FOR cIDTerm = terms.cidterm
		            replace cTermDesc WITH terms.cTermDesc
		         ENDSCAN
		      ENDSCAN
		      
		      swselect('finchgs')  &&  Fill in finance charge description
		      SCAN
		         SELECT vendorlist
		         SCAN FOR cFinCode = finchgs.cFinCode
		            replace nFinInt WITH finchgs.nFinInt
		         ENDSCAN
		      endscan      
		
		      THISFORM.cReportName = '..\commonsource\apvend2.frx'
		
		ENDCASE
		
		SELECT vendorlist
		IF RECC() > 0
		   RETURN .T.
		ELSE
		   RETURN .F.
		ENDIF
		
		
		
		
	ENDPROC

	PROCEDURE Init
		DODEFAULT()
		SELECT vendor
		set order to cvendorid
		
		THISFORM.opgSort.VALUE = 1
		THISFORM.opgType.VALUE = 1
		
		GO TOP
		THISFORM.swrptlook1.txtBegID.VALUE = cvendorid
		THISFORM.swrptlook1.txtBegName.VALUE = cSortField
		
		GO BOTTOM
		THISFORM.swrptlook1.txtEndID.VALUE = cvendorid
		THISFORM.swrptlook1.txtEndName.VALUE = cSortField
		
		
		
		
	ENDPROC

	PROCEDURE vendorhistory
		SET DELETED ON
		
		tcVendor1  = THISFORM.swrptlook1.txtBegID.VALUE
		tcVendor2  = THISFORM.swrptlook1.txtEndID.VALUE
		
		swselect('vendor')
		SCAN 
		   lcVendor = cVendorID
		   SELECT selected
		   LOCATE FOR cid = lcVendor
		   IF NOT FOUND()
		      LOOP
		   ENDIF 
		   WAIT WIND NOWAIT 'Calculating History Information for vendor: ' + ALLTRIM(vendor.cVendorID)
		   swselect('appurchh')  &&  Total Bills
		   SUM(ninvtot) TO nTotBills1 FOR cvendorid = vendor.cvendorid
		   SUM(ninvtot) TO nTotBillsYTD1 FOR cvendorid = vendor.cvendorid AND YEAR(dInvDate) = YEAR(DATE()) AND dInvDate<=DATE()  &&  YTD Bills
		   SUM(ninvtot) TO nTotBillsLYTD1 FOR cvendorid = vendor.cvendorid AND YEAR(dInvDate) = YEAR(DATE())-1  &&  Last YTD Bills
		   SET ORDER TO invdate DESC
		   GO TOP
		   LOCATE FOR cvendorid = vendor.cvendorid
		   IF FOUND()
		      IF vendor.dLastPurch < appurchh.dInvDate  &&  Only replace if a newer date
		         SELECT vendor
		         REPLACE vendor.dLastPurch WITH appurchh.dInvDate
		      ENDIF
		   ELSE
		      swselect('vendor')
		      replace vendor.dLastPurch WITH {}  &&  Blank it out to start, and the other processing will fill it in, if needed
		   ENDIF
		
		   swselect('csdishdr')  &&  Total Cash Disbusements
		   SUM(nCashAmt) TO nTotBills2 FOR cID = vendor.cvendorid
		   SUM(nCashAmt) TO nTotBillsYTD2 FOR cID = vendor.cvendorid AND YEAR(dDate) = YEAR(DATE()) AND dDate<=DATE()  &&  YTD Cash Disbursements
		   SUM(nCashAmt) TO nTotBillsLYTD2 FOR cID = vendor.cvendorid AND YEAR(dDate) = YEAR(DATE())-1  &&  Last YTD Bills
		   SET ORDER TO DATE DESC
		   GO TOP
		   LOCATE FOR cID = vendor.cvendorid
		   IF FOUND()
		      IF vendor.dLastPurch < csdishdr.dDate  &&  Only replace if a newer date
		         SELECT vendor
		         REPLACE vendor.dLastPurch WITH csdishdr.dDate
		      ENDIF
		   ENDIF
		
		   swselect('expense')  &&  Total non-A/P expenses
		   SUM(nAmount) TO nTotBills3 FOR cvendorid = vendor.cvendorid AND NOT lAPTran  &&  total Expenses
		   SUM(nAmount) TO nTotBillsYTD3 FOR cvendorid = vendor.cvendorid AND NOT lAPTran AND YEAR(dExpDate) = YEAR(DATE()) AND dExpDate <= DATE()  &&  YTD Expenses
		   SUM(nAmount) TO nTotBillsLYTD3 FOR cvendorid = vendor.cvendorid AND NOT lAPTran AND YEAR(dExpDate) = YEAR(DATE())-1  &&  Last YTD Expenses
		   SET ORDER TO dexpDate DESC
		   GO TOP
		   LOCATE FOR cvendorid = vendor.cvendorid
		   IF FOUND()
		      IF vendor.dLastPurch < expense.dExpDate  &&  Only replace if a newer date
		         SELECT vendor
		         REPLACE vendor.dLastPurch WITH expense.dExpDate
		      ENDIF
		   ENDIF
		
		   swselect('checks')  &&  Get the last payment amount and date
		   SET ORDER TO dCheckDate DESC
		   GO TOP
		   LOCATE FOR cID = vendor.cvendorid AND cidType = 'V'
		   IF FOUND()
		      IF vendor.dLastPmt < checks.dCheckDate
		         SELECT vendor
		         REPLACE vendor.dLastPmt WITH checks.dCheckDate, vendor.nLastPmt WITH checks.nAmount
		      ENDIF
		   ELSE  &&  NO payments
		      swselect('vendor')
		      replace vendor.dLastPmt WITH {}
		   ENDIF
		
		   IF apaged(vendor.cvendorid,vendor.cvendorid,DATE(),.T.,'S',.f.,'All')  &&  If there's outstanding items, plug in the balances
		      swselect('vendor')
		      REPLACE vendor.nCurBal WITH vendbal.nCurrent, vendor.nbal30_60 WITH vendbal.nDays31,  ;
		         vendor.nBal60_90 WITH  vendbal.nDays61, vendor.nBalOv90 WITH vendbal.nDays91
		   ENDIF
		
		   swselect('vendor')  &&  Plug totals into the vendor record, if needed
		   IF nTotPurch <> nTotBills1+nTotBills2+nTotBills3  &&  Total purchases
		      REPLACE nTotPurch WITH nTotBills1+nTotBills2+nTotBills3
		   ENDIF
		
		   IF nPurchYTD <> nTotBillsYTD1+nTotBillsYTD2+nTotBillsYTD3  &&  YTD purchases
		      REPLACE nPurchYTD WITH nTotBillsYTD1+nTotBillsYTD2+nTotBillsYTD3
		   ENDIF
		
		   IF nPurchLYTD <> nTotBillsLYTD1+nTotBillsLYTD2+nTotBillsLYTD3  &&  Last YTD purchases
		      REPLACE nPurchLYTD WITH nTotBillsLYTD1+nTotBillsLYTD2+nTotBillsLYTD3
		   ENDIF
		
		ENDSCAN
		
		WAIT CLEAR
		
		swselect('vendor')
		=TABLEUPDATE(.t.)
		
		
	ENDPROC

	PROCEDURE chkSelected.Click
		IF this.Value
		   DO FORM commonsource\selected-ids WITH 'VENDOR' LINKED 
		   lnCount = RECCOUNT('selected')
		   thisform.lblselected.Caption = TRANSFORM(lnCount) + ' Vendors Selected'
		   thisform.lblselected.Visible = .T.
		   thisform.lblbegID.Visible = .F.
		   thisform.lblendID.Visible = .F.
		   thisform.swrptlook1.Visible = .F.
		ELSE
		   thisform.lblselected.Visible = .F.
		   thisform.lblbegID.Visible = .T.
		   thisform.lblendID.Visible = .T.
		   thisform.swrptlook1.Visible = .T.
		ENDIF 
	ENDPROC

	PROCEDURE opgSort.optName.Click
		SELECT vendor
		SET ORDER TO csortfield
		
		GO TOP
		THISFORM.swrptlook1.txtBegID.VALUE = cvendorid
		THISFORM.swrptlook1.txtBegName.VALUE = cSortField
		GO BOTTOM
		THISFORM.swrptlook1.txtEndID.VALUE = cvendorid
		THISFORM.swrptlook1.txtEndName.VALUE = cSortField
		
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE opgSort.optName.GotFocus
		THISFORM.opgSort.VALUE = 2
	ENDPROC

	PROCEDURE opgSort.optVendID.Click
		SELECT vendor
		set order to cvendorid
		  
		GO TOP
		THISFORM.swrptlook1.txtBegID.VALUE = cvendorid
		thisform.swrptlook1.txtBegName.value = cSortField
		GO BOTTOM
		THISFORM.swrptlook1.txtEndID.VALUE = cvendorid
		thisform.swrptlook1.txtEndName.value = cSortField
		
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE opgSort.optVendID.GotFocus
		THISFORM.opgSort.VALUE = 1
		
	ENDPROC

	PROCEDURE opgType.Click
		IF THIS.VALUE = 2
		   THISFORM.chklRecalc.VALUE = .T.
		ELSE
		   THISFORM.chklRecalc.VALUE = .T.
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE opgType.optDetail.GotFocus
		THISFORM.opgType.VALUE = 2
	ENDPROC

	PROCEDURE opgType.optSummary.GotFocus
		THISFORM.opgType.VALUE = 1
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .T.
		
		lcList = 'cvendorid,csortfield'
		
		DO FORM ..\Custom\PickList WITH 'Vendor', lcList, thisform.swrptlook1.txtbegid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtBegID.value = Vendor.cVendorID
		   thisform.swrptlook1.txtBegName.value = Vendor.cSortField
		   thisform.swrptlook1.txtBegID.refresh()
		   thisform.swrptlook1.txtBegName.refresh()
		   thisform.setnextcontrol(thisform.swrptlook1.txtbegid)
		ENDIF   
		
		THISFORM.setnextcontrol(THISFORM.swrptlook1.txtBegID)
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .T.
		
		lcList = 'cvendorid,csortfield'
		
		DO FORM ..\Custom\PickList WITH 'Vendor', lcList, thisform.swrptlook1.txtendid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtEndID.value = Vendor.cVendorID
		   thisform.swrptlook1.txtEndName.value = Vendor.cSortField
		   thisform.swrptlook1.txtEndID.refresh()
		   thisform.swrptlook1.txtEndName.refresh()
		   thisform.setnextcontrol(thisform.swrptlook1.txtEndID)
		ENDIF   
		
		THISFORM.setnextcontrol(THISFORM.swrptlook1.txtEndID)
		
	ENDPROC

	PROCEDURE Swrptlook1.TxtBegID.Valid
		SELECT vendor
		SET ORDER TO cVendorID
		IF SEEK(THIS.VALUE)
		   THIS.PARENT.TxtBegName.SET('value',vendor.cSortField)
		ELSE
		   THIS.PARENT.TxtBegName.SET('value','')
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE Swrptlook1.TxtEndID.Valid
		SELECT vendor
		SET ORDER TO cVendorID
		IF SEEK(THIS.VALUE)
		   THIS.PARENT.TxtEndName.SET('value',vendor.cSortField)
		ELSE
		   THIS.PARENT.TxtEndName.SET('value','')
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

ENDDEFINE
