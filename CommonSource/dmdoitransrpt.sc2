*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="dmdoitransrpt.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />

	DataSource = .NULL.
	Height = 200
	Left = 1
	Name = "Dataenvironment"
	Top = 220
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "doichanges", ;
		CursorSource = "doichanges", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "investor", ;
		CursorSource = "investor", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "wells", ;
		CursorSource = "wells", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formdoitransrpt AS swrptcriteria OF "..\custom\swforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="cboTransfers" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom1" UniqueID="" Timestamp="" />

	Caption = "DOI Transfer Report"
	DoCreate = .T.
	Height = 250
	Name = "FormDOITransRpt"
	Width = 552
	Swrptcriteriabuttons1.chkExport.Alignment = 0
	Swrptcriteriabuttons1.chkExport.Name = "chkExport"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.cmdPreview.Name = "cmdPreview"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 158
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.Top = 156

	ADD OBJECT 'cboTransfers' AS cbocomboboxcustom WITH ;
		BoundColumn = 2, ;
		ColumnCount = 1, ;
		Height = 22, ;
		Left = 96, ;
		Name = "cboTransfers", ;
		Top = 72, ;
		Width = 384
		*< END OBJECT: ClassLib="..\..\custom\ccontrol.vcx" BaseClass="combobox" />

	ADD OBJECT 'Lbllabelcustom1' AS lbllabelcustom WITH ;
		Caption = "Transfer", ;
		Left = 43, ;
		Name = "Lbllabelcustom1", ;
		Top = 74
		*< END OBJECT: ClassLib="..\..\custom\ccontrol.vcx" BaseClass="label" />
	
	PROCEDURE builddata
		LOCAL lnCount, llReturn, lcTime, ltTime, lcOwner
		
		ltTime = CTOT(thisform.cboTransfers.Value)
		
		SELECT * FROM doichanges ;
		  WHERE tdatetime = ltTime ;
		  INTO CURSOR changes readwrite
		 lnCount = _tally
		  
		 SELECT changes
		 INDEX on cRptGroup+cOwnerID+cWellID+cTypeInv+cRunYear+cRunNo TAG cRptGroup
		 
		 thisform.creportname = 'commonsource\dmrdoitransfer'
		  
		IF lnCount > 0
		   llReturn = .T.
		ELSE
		   llReturn = .F.
		ENDIF 
		
		RETURN llReturn
		
		
	ENDPROC

	PROCEDURE report
		LPARA cButton
		
		PRIVATE llPreview
		
		llPreview = .F.
		
		DODEFAULT(cButton)
	ENDPROC

	PROCEDURE cboTransfers.Init
		IF DODEFAULT()
		
		   SELECT tdatetime, cownerid FROM doichanges ;
		      WHERE crptgroup = '1' ;
		      into cursor temp ;
		      order by tdatetime desc, cownerid ;
		      group by tdatetime, cownerid
		      
		    this.AddListItem(' ',1)
		    lnCount = 2  
		    SELECT temp
		    SCAN 
		       SCATTER MEMVAR 
		       m.clog = TTOC(m.tdatetime)
		       this.AddListItem(m.clog +' - From Owner: '+m.cownerid,lnCount,1)
		       this.AddListItem(m.clog,lnCount,2)
		       lnCount = lnCount + 1 
		    ENDSCAN   
		ENDIF 
	ENDPROC

ENDDEFINE
