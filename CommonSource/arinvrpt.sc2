*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="arinvrpt.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Relation1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Relation4" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 489
	Left = 40
	Name = "Dataenvironment"
	Top = 126
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "aropt", ;
		CursorSource = "aropt", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor10' AS cursor WITH ;
		Alias = "options", ;
		CursorSource = "options", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 8, ;
		Name = "Cursor10", ;
		Top = 269, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "arpmtdet", ;
		CursorSource = "arpmtdet", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "arpmthdr", ;
		CursorSource = "arpmthdr", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "investor", ;
		CursorSource = "investor", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor4", ;
		Top = 140, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor5' AS cursor WITH ;
		Alias = "invhdr", ;
		CursorSource = "invhdr", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor5", ;
		Top = 142, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor6' AS cursor WITH ;
		Alias = "invdet", ;
		CursorSource = "invdet", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 304, ;
		Name = "Cursor6", ;
		Top = 143, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor7' AS cursor WITH ;
		Alias = "custs", ;
		CursorSource = "custs", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor7", ;
		Top = 260, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Relation1' AS relation WITH ;
		ChildAlias = "arpmtdet", ;
		ChildOrder = "cbatch", ;
		Name = "Relation1", ;
		ParentAlias = "arpmthdr", ;
		RelationalExpr = "cbatch"
		*< END OBJECT: BaseClass="relation" />

	ADD OBJECT 'Relation4' AS relation WITH ;
		ChildAlias = "invdet", ;
		ChildOrder = "cbatch", ;
		Name = "Relation4", ;
		ParentAlias = "invhdr", ;
		RelationalExpr = "cbatch"
		*< END OBJECT: BaseClass="relation" />

ENDDEFINE

DEFINE CLASS formarinvrpt AS frmrptcriteria OF "..\source\appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Lbllabelcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblBegID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblEndID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtBegDate" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtEndDate" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*p: creport		&& The report type as passed.
	*</DefinedPropArrayMethod>

	Caption = "A/R Invoices and Payments Report"
	DataSession = 2
	DoCreate = .T.
	Height = 247
	HelpContextID = 578
	Name = "Formarinvrpt"
	Width = 329
	SWRPTCRITERIABUTTONS1.CHKSENDFILE.Alignment = 0
	SWRPTCRITERIABUTTONS1.CHKSENDFILE.Name = "CHKSENDFILE"
	SWRPTCRITERIABUTTONS1.cmdclose.Name = "cmdclose"
	SWRPTCRITERIABUTTONS1.CMDPREVIEW.Name = "CMDPREVIEW"
	SWRPTCRITERIABUTTONS1.CMDPRINT.Name = "CMDPRINT"
	SWRPTCRITERIABUTTONS1.Left = 47
	SWRPTCRITERIABUTTONS1.Name = "SWRPTCRITERIABUTTONS1"
	SWRPTCRITERIABUTTONS1.TabIndex = 11
	SWRPTCRITERIABUTTONS1.Top = 178

	ADD OBJECT 'LblBegID' AS lbllabelcustom WITH ;
		Caption = "First Customer:", ;
		Height = 16, ;
		Left = 17, ;
		Name = "LblBegID", ;
		TabIndex = 8, ;
		Top = 65, ;
		Width = 75, ;
		ZOrderSet = 10
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblEndID' AS lbllabelcustom WITH ;
		Caption = "Last Customer:", ;
		Height = 16, ;
		Left = 17, ;
		Name = "LblEndID", ;
		TabIndex = 9, ;
		Top = 116, ;
		Width = 75, ;
		ZOrderSet = 9
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom1' AS lbllabelcustom WITH ;
		Caption = "Date Range", ;
		Left = 17, ;
		Name = "Lbllabelcustom1", ;
		TabIndex = 1, ;
		Top = 26
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom2' AS lbllabelcustom WITH ;
		Caption = "-", ;
		FontBold = .T., ;
		Height = 16, ;
		Left = 199, ;
		Name = "Lbllabelcustom2", ;
		TabIndex = 4, ;
		Top = 26, ;
		Width = 6
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 95, ;
		Name = "Swrptlook1", ;
		TabIndex = 5, ;
		Top = 62, ;
		ZOrderSet = 8, ;
		SWLOOKUPBUTTON1.Name = "SWLOOKUPBUTTON1", ;
		SWLOOKUPBUTTON2.Name = "SWLOOKUPBUTTON2", ;
		TXTBEGID.clistexpression = custs.ccustid, ;
		TXTBEGID.clistworkarea = custs, ;
		TXTBEGID.Name = "TXTBEGID", ;
		TXTBEGNAME.Name = "TXTBEGNAME", ;
		TXTENDID.clistexpression = custs.ccustid, ;
		TXTENDID.clistworkarea = custs, ;
		TXTENDID.Name = "TXTENDID", ;
		TXTENDNAME.Name = "TXTENDNAME"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />

	ADD OBJECT 'txtBegDate' AS dpk WITH ;
		ControlSource = "", ;
		Height = 20, ;
		Left = 96, ;
		Name = "txtBegDate", ;
		TabIndex = 2, ;
		Top = 24, ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\swdate.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtEndDate' AS dpk WITH ;
		ControlSource = "", ;
		Height = 20, ;
		Left = 212, ;
		Name = "txtEndDate", ;
		TabIndex = 3, ;
		Top = 24, ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\swdate.vcx" BaseClass="textbox" />
	
	PROCEDURE builddata
		LOCAL tcOwner1, tcOwner2, tdDate1, tdDate2, tcReport, tlAcctDesc, tlPayments
		
		tcCustID1  = THISFORM.swrptlook1.txtBegID.VALUE
		tcCustID2  = THISFORM.swrptlook1.txtEndID.VALUE
		tdDate1   = THISFORM.txtbegdate.VALUE
		tdDate2   = THISFORM.txtenddate.VALUE
		tcReport  = THISFORM.cReport
		
		THISFORM.cTitle1 = 'A/R Invoices and Payments Report'
		THISFORM.cTitle2 = 'For Date Range: ' + DTOC(tdDate1)+' - '+DTOC(tdDate2)
		THISFORM.cSelectCriteria = 'Customers: ' + ALLTRIM(tcCustID1) + ' - ' + ALLTRIM(tcCustID2)
		THISFORM.cSortOrder = 'Customer ID'
		
		
		THISFORM.cReportName = 'arinvrpt'
		
		CREATE CURSOR jibrpt ;
		   (cCustId     C(10), ;
		   cCustName   C(40), ;
		   cInvNum     C(10), ;
		   dTranDate   D, ;
		   nAmount     N(12,2), ;
		   lPayments   L,  ;
		   cProdYear   C(4), ;
		   cProdPrd    C(2), ;
		   cDepositId  C(8), ;
		   cRecType    C(1))
		INDEX ON cCustId+cInvNum+cRecType TAG rptorder
		
		SELECT invhdr.cInvNum, ;
		   invhdr.cCustId, ;
		   custs.cCustName, ;
		   invhdr.dInvDate AS dTranDate, ;
		   invhdr.ninvtot AS nAmount, ;
		   'I' AS cRecType ;
		   FROM invhdr, custs ;
		   WHERE invhdr.cinvtype = 'I' ;
		   AND BETWEEN(invhdr.cCustId,tcCustID1,tcCustID2) ;
		   AND BETWEEN(invhdr.dInvDate,tdDate1,tdDate2) ;
		   AND invhdr.cCustId = custs.cCustId ;
		   AND invhdr.ninvtot <> 0 ;
		   INTO CURSOR temp ;
		   ORDER BY invhdr.cCustId, invhdr.dInvDate
		
		IF _TALLY > 0
		   SELECT jibrpt
		   APPEND FROM DBF('temp')
		ENDIF
		
		SELECT arpmthdr.dRecDate AS dTranDate, ;
		   arpmthdr.cCustId, ;
		   custs.cCustName, ;
		   arpmthdr.cReference AS cDepositId, ;
		   arpmtdet.cInvNum, ;
		   arpmtdet.nAmtApp+arpmtdet.nDisTaken AS nAmount, ;  && Including the discounts being taken - BH 01/15/2007
		   arpmtdet.dInvDate, ;
		   IIF(tlPayments,.T.,.F.) AS lPayments,  ;
		   'P' AS cRecType ;
		   FROM arpmthdr, arpmtdet, custs ;
		   WHERE BETWEEN(arpmthdr.cCustId,tcCustID1,tcCustID2) ;
		   AND BETWEEN(arpmthdr.dRecDate,tdDate1,tdDate2) ;
		   AND arpmthdr.cCustId = custs.cCustId ;
		   AND arpmthdr.cBatch = arpmtdet.cBatch ;
		   AND arpmtdet.nAmtApp <> 0 ;
		   INTO CURSOR temp ;
		   ORDER BY arpmthdr.cCustId, arpmtdet.dInvDate
		
		IF _TALLY > 0
		   SELECT jibrpt
		   APPEND FROM DBF('temp')
		ENDIF
		
		SELECT jibrpt
		IF RECC() > 0
		   RETURN .T.
		ELSE
		   RETURN .F.
		ENDIF
		
		
		
	ENDPROC

	PROCEDURE Init
		LPARA tcReport
		DODEFAULT()
		
		SELECT custs
		SET ORDER TO ccustid
		GO TOP
		
		THISFORM.swrptlook1.txtBegName.VALUE = cCustName
		THISFORM.swrptlook1.txtBegID.VALUE = cCustID
		GO BOTTOM
		
		THISFORM.swrptlook1.txtEndName.VALUE = cCustName
		THISFORM.swrptlook1.txtEndID.VALUE = cCustID
		
		thisform.txtbegdate.value = DATE() - 30
		thisform.txtenddate.value = DATE()
		
		
	ENDPROC

	PROCEDURE Swrptlook1.SWLOOKUPBUTTON1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'ccustid,ccustname'
		
		DO FORM ..\custom\picklist WITH 'custs', lcList, thisform.swrptlook1.txtbegid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtBegId.value = cCustID
		   thisform.swrptlook1.txtBegName.value = cCustName
		   thisform.swrptlook1.txtBegId.refresh()
		   thisform.swrptlook1.txtBegName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(this.parent.txtBegID)
	ENDPROC

	PROCEDURE Swrptlook1.SWLOOKUPBUTTON2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'ccustid,ccustname'
		
		DO FORM ..\custom\picklist WITH 'custs', lcList, thisform.swrptlook1.txtendid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtEndId.value = ccustid
		   thisform.swrptlook1.txtEndName.value = cCustName
		   thisform.swrptlook1.txtEndId.refresh()
		   thisform.swrptlook1.txtEndName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(this.parent.txtEndID)
	ENDPROC

	PROCEDURE txtBegDate.dropdown
		DODEFAULT()
		thisform.setnextcontrol(this)
		
	ENDPROC

	PROCEDURE txtEndDate.dropdown
		DODEFAULT()
		thisform.setnextcontrol(this)
		
	ENDPROC

ENDDEFINE
