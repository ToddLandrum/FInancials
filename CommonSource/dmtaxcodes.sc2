*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="dmtaxcodes.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 200
	Left = 13
	Name = "Dataenvironment"
	Top = 430
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "taxcodes", ;
		CursorSource = "taxcodes", ;
		Database = s:\program distribution\ampro new\sampledata\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "taxcodes1", ;
		CursorSource = "taxcodes", ;
		Database = s:\program distribution\ampro new\sampledata\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "expcat", ;
		CursorSource = "expcat", ;
		Database = s:\program distribution\ampro new\sampledata\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formdmtaxcodes AS frmdatamanagerformcustom OF "..\custom\cforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="txtCtaxcode" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblCtaxcode" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtCdesc" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblCdesc" UniqueID="" Timestamp="" />

	Caption = "Expense Section Codes"
	clistexpression = cTaxCode
	DoCreate = .T.
	Height = 103
	HelpContextID = 70
	Name = "FormDmtaxcodes"
	Width = 336
	cmdatamanager.Name = "cmdatamanager"
	cmlookupmanager.Name = "cmlookupmanager"

	ADD OBJECT 'lblCdesc' AS lblfieldlabelcustom WITH ;
		Caption = "Description", ;
		Height = 16, ;
		Left = 23, ;
		Name = "lblCdesc", ;
		TabIndex = 4, ;
		Top = 54, ;
		Width = 56
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblCtaxcode' AS lblfieldlabelcustom WITH ;
		Caption = "Code", ;
		Height = 16, ;
		Left = 52, ;
		Name = "lblCtaxcode", ;
		TabIndex = 2, ;
		Top = 24, ;
		Width = 27
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'txtCdesc' AS txttextboxcustom WITH ;
		ControlSource = "taxcodes.cdesc", ;
		Height = 20, ;
		Left = 85, ;
		lrequired = .T., ;
		MaxLength = 30, ;
		Name = "txtCdesc", ;
		TabIndex = 5, ;
		Top = 53, ;
		Width = 216
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtCtaxcode' AS txttextboxcustom WITH ;
		ControlSource = "taxcodes.ctaxcode", ;
		Format = "!", ;
		Height = 20, ;
		Left = 85, ;
		lrequired = .T., ;
		MaxLength = 2, ;
		Name = "txtCtaxcode", ;
		TabIndex = 3, ;
		Top = 23, ;
		Width = 23
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="textbox" />
	
	PROCEDURE list
		LPARAMETERS cworkarea
		LOCAL lcList, lnRecNo
		PRIV llOK
		
		llOK = .F.
		lcList = 'ctaxcode,cdesc'
		
		SELECT taxcodes
		lnRecNo = RECNO()
		
		DO FORM ..\custom\picklist WITH 'Taxcodes', lcList, thisform.txtctaxcode.value, 2
		
		IF NOT llOK
		   SELECT taxcodes
		   GOTO lnRecNo
		ENDIF   
		
		thisform.refresh()
	ENDPROC

	PROCEDURE cmdatamanager.afternew
		LPARAMETERS cworkarea
		
		thisform.setnextcontrol(thisform.txtctaxcode)
		
		DODEFAULT()
	ENDPROC

	PROCEDURE cmdatamanager.beforedelete
		LPARAMETERS cworkarea
		
		SELECT expcat
		LOCATE FOR cTaxCode = taxcodes.cTaxCode
		IF FOUND()
		   THISFORM.oMessage.Warning('There are expense categories that use this section, it cannot be deleted.')
		   RETURN .F.
		ENDIF
		
		DODEFAULT(cworkarea)
		
	ENDPROC

	PROCEDURE txtCtaxcode.Valid
		IF NOT EMPTY(THIS.VALUE)
		   IF THISFORM.isnew('taxcodes')
		      SET DELETED OFF
		      SELECT taxcodes1
		      SET ORDER TO ctaxcode
		      IF SEEK(THIS.VALUE)
		         IF DELETED()
		            THISFORM.cmdatamanager.revertall()
		            SELECT taxcodes
		            SET ORDER TO ctaxcode
		            SEEK(THIS.VALUE)
		            RECALL
		            THISFORM.REFRESH()
		         ELSE
		            IF THISFORM.omessage.CONFIRM('There is already a section with this code.  Would you like to view the existing record?')
		               THISFORM.cmdatamanager.revertall()
		               SELECT taxcodes
		               SET ORDER TO ctaxcode
		               SEEK(THIS.VALUE)
		               THISFORM.REFRESH()
		            ELSE
		               THIS.VALUE = ''
		               RETURN 0
		            ENDIF
		         ENDIF
		      ENDIF
		      set deleted on
		   ENDIF
		ENDIF
		
		dodefault()
	ENDPROC

ENDDEFINE
