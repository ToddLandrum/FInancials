*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="apvendlab.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 558
	Left = 4
	Name = "Dataenvironment"
	Top = 54
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "vendor", ;
		CursorSource = "vendor", ;
		Database = ..\datafiles\data\appdata.dbc, ;
		Height = 491, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 144
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formapvendlab AS frmrptcriteria OF "..\source\appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="opgAddressType" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblEndID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkSelected" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblBegID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblSelected" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkAddress" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="OpgType" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkIncludeReturn" UniqueID="" Timestamp="" />

	Caption = "Vendor Labels/Envelopes"
	DataSession = 2
	DoCreate = .T.
	Height = 432
	HelpContextID = 228
	Name = "Formapvendlab"
	Width = 506
	Swrptcriteriabuttons1.CHKEXPORT.Alignment = 0
	Swrptcriteriabuttons1.CHKEXPORT.Name = "CHKEXPORT"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.cmdPreview.Name = "cmdPreview"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 134
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.TabIndex = 7
	Swrptcriteriabuttons1.Top = 346
	Swrptcriteriabuttons1.ZOrderSet = 0

	ADD OBJECT 'chkAddress' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		AutoSize = .F., ;
		Caption = "Use Billing Address when Mailing Address is not specified.", ;
		Centered = .F., ;
		Height = 30, ;
		Left = 179, ;
		Name = "chkAddress", ;
		TabIndex = 10, ;
		Top = 263, ;
		Value = .T., ;
		Width = 200, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkIncludeReturn' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Include Return Address", ;
		Left = 263, ;
		Name = "chkIncludeReturn", ;
		Top = 41, ;
		Value = .T., ;
		Visible = .F.
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'chkSelected' AS chkcheckboxcustom WITH ;
		Alignment = 0, ;
		Caption = "Choose Selected Vendors", ;
		Height = 16, ;
		Left = 182, ;
		Name = "chkSelected", ;
		TabIndex = 1, ;
		Top = 120, ;
		Value = .F., ;
		Width = 145, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="checkbox" />

	ADD OBJECT 'lblBegID' AS lbllabelcustom WITH ;
		Caption = "First Vendor:", ;
		Height = 16, ;
		Left = 101, ;
		Name = "lblBegID", ;
		TabIndex = 3, ;
		Top = 149, ;
		Width = 65, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblEndID' AS lbllabelcustom WITH ;
		Caption = "Last Vendor:", ;
		Height = 16, ;
		Left = 101, ;
		Name = "lblEndID", ;
		TabIndex = 4, ;
		Top = 199, ;
		Width = 65, ;
		ZOrderSet = 5
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom1' AS lbllabelcustom WITH ;
		Caption = "Print", ;
		Left = 101, ;
		Name = "Lbllabelcustom1", ;
		Top = 20
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom2' AS lbllabelcustom WITH ;
		Caption = "Use:", ;
		Left = 101, ;
		Name = "Lbllabelcustom2", ;
		Top = 86
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'lblSelected' AS lbllabelcustom WITH ;
		Caption = "All IDs Selected", ;
		ForeColor = 0,0,255, ;
		Height = 16, ;
		Left = 181, ;
		Name = "lblSelected", ;
		TabIndex = 9, ;
		Top = 186, ;
		Visible = .F., ;
		Width = 77, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\..\wellprofits\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'opgAddressType' AS opgoptiongroupcustom WITH ;
		AutoSize = .T., ;
		BorderStyle = 0, ;
		ButtonCount = 2, ;
		Height = 26, ;
		Left = 146, ;
		Name = "opgAddressType", ;
		TabIndex = 8, ;
		Top = 81, ;
		Value = 2, ;
		Width = 211, ;
		Option1.AutoSize = .T., ;
		Option1.Caption = "Mailing Address", ;
		Option1.FontSize = 8, ;
		Option1.Height = 16, ;
		Option1.Left = 5, ;
		Option1.Name = "Option1", ;
		Option1.Top = 5, ;
		Option1.Value = 0, ;
		Option1.Width = 95, ;
		Option2.AutoSize = .T., ;
		Option2.Caption = "Billing Address", ;
		Option2.FontSize = 8, ;
		Option2.Height = 16, ;
		Option2.Left = 116, ;
		Option2.Name = "Option2", ;
		Option2.Top = 5, ;
		Option2.Value = 1, ;
		Option2.Width = 90
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'OpgType' AS opgoptiongroupcustom WITH ;
		AutoSize = .T., ;
		BorderStyle = 0, ;
		ButtonCount = 2, ;
		Height = 26, ;
		Left = 146, ;
		Name = "OpgType", ;
		TabIndex = 8, ;
		Top = 13, ;
		Value = 1, ;
		Width = 189, ;
		Option1.AutoSize = .T., ;
		Option1.Caption = "Labels", ;
		Option1.FontSize = 8, ;
		Option1.Height = 16, ;
		Option1.Left = 5, ;
		Option1.Name = "Option1", ;
		Option1.Top = 5, ;
		Option1.Value = 1, ;
		Option1.Width = 50, ;
		Option2.AutoSize = .T., ;
		Option2.Caption = "Envelopes", ;
		Option2.FontSize = 8, ;
		Option2.Height = 16, ;
		Option2.Left = 116, ;
		Option2.Name = "Option2", ;
		Option2.Top = 5, ;
		Option2.Width = 68
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="optiongroup" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 179, ;
		Name = "Swrptlook1", ;
		TabIndex = 2, ;
		Top = 146, ;
		ZOrderSet = 4, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		TxtBegID.clistexpression = vendor.cvendorid, ;
		TxtBegID.clistworkarea = vendor, ;
		TxtBegID.Name = "TxtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		TxtEndID.clistexpression = vendor.cvendorid, ;
		TxtEndID.clistworkarea = vendor, ;
		TxtEndID.Name = "TxtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />
	
	PROCEDURE builddata
		LOCAL lcBegID, lcEndID, lcBegName, lcEndName, llAddress
		
		llAddress = THISFORM.chkAddress.VALUE
		tcVendor1  = THISFORM.swrptlook1.txtBegID.VALUE
		tcVendor2  = THISFORM.swrptlook1.txtEndID.VALUE
		tlSelected = THISFORM.chkselected.VALUE
		
		IF NOT tlSelected
		   SELECT cvendorid AS cid FROM vendor ;
		      WHERE BETWEEN(cvendorid,tcVendor1,tcVendor2) ;
		      INTO CURSOR SELECTED ;
		      ORDER BY cid
		ENDIF
		*
		*   Builds the cursor needed by the report by using
		*   the criteria given in the form
		*
		
		IF THISFORM.opgType.VALUE = 1
		   CREATE CURSOR invlab  ;
		      (cName       c(40),  ;
		      cid          c(10),  ;
		      cSortField   c(40),  ;
		      cName2       c(40),  ;
		      cAddress1    c(40),  ;
		      cAddress2    c(40),  ;
		      cAddress3    c(40))
		   INDEX ON cSortField TAG cSortField
		
		ELSE
		   CREATE CURSOR invlab  ;
		      (cID         c(10), ;
		      cName1       c(60),  ;
		      cName2        c(60), ;
		      cAddress1     c(60), ;
		      cAddress2     c(60),  ;
		      cCity         c(40), ;
		      cState        c(2), ;
		      czipcode      c(10), ;
		      ccompname     c(60), ;
		      cCompAddr1    c(60), ;
		      cCompAddr2    c(60), ;
		      cCompCity     c(40), ;
		      cCompState    c(2), ;
		      cCompZip      c(10))
		ENDIF
		
		IF thisform.opgType.value = 2 
		   IF NOT FILE(m.goapp.cRptsFolder+'envelope10.frx')
		      GetEnvelope()
		   ENDIF 
		   IF thisform.chkINCLUDERETURN.value
		      m.ccompname  = m.goapp.cCompanyName
		      m.cCompAddr1 = m.goapp.cAddress1
		      m.cCompAddr2 = ""
		      m.cCompCity  = m.goapp.cCity
		      m.cCompState = m.goapp.cState
		      m.cCompZip   = m.goapp.czip
		   ELSE
		      m.ccompname  = ""
		      m.cCompAddr1 = ""
		      m.cCompAddr2 = ""
		      m.cCompCity  = ""
		      m.cCompState = ""
		      m.cCompZip   = ""
		   ENDIF
		ENDIF    
		
		DO CASE
		   CASE THISFORM.opgAddressType.VALUE = 1  &&  Mailing Address
		
		      SELECT cVendName AS cName,  ;
		         cvendorid AS cid,  ;
		         '' AS cName2,  ;
		         cAddress1,  ;
		         cAddress2,  ;
		         cCity, czip, cState, ;
		         ALLTRIM(cCity) + ', ' + ALLTRIM(cState) + '  ' + ALLTRIM(czip) AS cAddress3  ;
		         FROM vendor  ;
		         WHERE cvendorid IN (SELECT cid FROM SELECTED) ;
		         INTO CURSOR labtmp
		
		   CASE THISFORM.opgAddressType.VALUE = 2  &&  Billing Address
		
		      SELECT cVendName AS cName,  ;
		         cvendorid AS cid,  ;
		         '' AS cName2,  ;
		         cbAddr1 AS cAddress1,  ;
		         cbAddr2 AS cAddress2,  ;
		         cbcity, cbstate, cbzip, ;
		         ALLTRIM(cbcity) + ', ' + ALLTRIM(cbstate) + '  ' + ALLTRIM(cbzip) AS cAddress3  ;
		         FROM vendor  ;
		         WHERE cvendorid IN (SELECT cid FROM SELECTED) ;
		         INTO CURSOR labtmp
		ENDCASE
		
		
		IF THISFORM.opgType.VALUE = 2
		   IF THISFORM.opgAddressType.VALUE = 2
		      SELECT labtmp
		      SCAN
		         SCATTER MEMVAR
		         m.cName1 = m.cName
		         m.cName2 = ''
		         m.cCity  = m.cbcity
		         m.cState = m.cbstate
		         m.cZipcode = m.cbzip
		         INSERT INTO invlab FROM MEMVAR
		      ENDSCAN
		   ELSE
		      SELECT labtmp
		      SCAN
		         SCATTER MEMVAR
		         m.cName1 = m.cName
		         m.cName2 = ''
		         m.cZipcode   = m.czip
		         INSERT INTO invlab FROM MEMVAR
		      ENDSCAN
		   ENDIF
		   THISFORM.cReportName = m.goapp.cRptsFolder+'envelope10.frx'
		
		ELSE
		   SELECT invlab
		   APPEND FROM DBF('labtmp')
		   THISFORM.cReportName = m.goapp.cRptsFolder+'ownlabl.lbx'
		ENDIF
		
		SELECT invlab
		IF RECC() > 0
		   IF llAddress  &&  Fill in alternate address if the one currently used is blank, and they marked the option to do so
		      SCAN FOR EMPTY(cAddress1) AND EMPTY(cAddress2) AND LEFT(ALLTRIM(cAddress3),1) = ','
		         SELECT vendor
		         LOCATE FOR cvendorid == invlab.cid
		         IF FOUND()
		            IF THISFORM.opgAddressType.VALUE = 1  &&  Mailing address, so get the billing address if possible
		               REPLACE invlab.cAddress1 WITH vendor.cbAddr1, invlab.cAddress2 WITH vendor.cbAddr2,  ;
		                  invlab.cAddress3 WITH ALLTRIM(vendor.cbcity) + ', ' + ALLTRIM(vendor.cbstate) + '  ' + ALLTRIM(vendor.cbzip)
		            ELSE
		               REPLACE invlab.cAddress1 WITH vendor.cAddress1, invlab.cAddress2 WITH vendor.cAddress2,  ;
		                  invlab.cAddress3 WITH ALLTRIM(cCity) + ', ' + ALLTRIM(cState) + '  ' + ALLTRIM(czip)
		            ENDIF
		         ENDIF
		      ENDSCAN
		   ENDIF
		   RETURN .T.
		ELSE
		   RETURN .F.
		ENDIF
		
	ENDPROC

	PROCEDURE Init
		SELECT vendor
		SET ORDER TO cSortfield
		
		GO TOP
		THISFORM.swrptlook1.txtBegName.VALUE = csortfield
		THISFORM.swrptlook1.txtBegID.VALUE = cvendorid
		
		GO BOTTOM
		THISFORM.swrptlook1.txtEndName.VALUE = csortfield
		THISFORM.swrptlook1.txtEndID.VALUE = cvendorid
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE chkSelected.Click
		IF this.Value
		   DO FORM commonsource\selected-ids WITH 'VENDOR' LINKED 
		   lnCount = RECCOUNT('selected')
		   thisform.lblselected.Caption = TRANSFORM(lnCount) + ' Vendors Selected'
		   thisform.lblselected.Visible = .T.
		   thisform.lblbegID.Visible = .F.
		   thisform.lblendID.Visible = .F.
		   thisform.swrptlook1.Visible = .F.
		ELSE
		   thisform.lblselected.Visible = .F.
		   thisform.lblbegID.Visible = .T.
		   thisform.lblendID.Visible = .T.
		   thisform.swrptlook1.Visible = .T.
		ENDIF 
	ENDPROC

	PROCEDURE opgAddressType.Click
		IF THIS.VALUE = 1  &&  Mailing Address
		   THISFORM.chkAddress.CAPTION = 'Use Billing Address for label when Mailing Address is not specified.'
		ELSE
		   THISFORM.chkAddress.CAPTION = 'Use Mailing Address for label when Billing Address is not specified.'
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE opgAddressType.Init
		THIS.VALUE = 2
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE OpgType.Init
		THIS.VALUE = 1
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE OpgType.Valid
		IF DODEFAULT()
		   IF this.Value = 2
		      thisform.chkIncludeReturn.visible = .t.
		   ELSE
		      thisform.chkIncludeReturn.visible = .f.
		   ENDIF 
		ENDIF 
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		
		lcList = 'cvendorid,csortfield'
		DO FORM ..\CUSTOM\picklist WITH 'vendor', lcList, thisform.swrptlook1.txtbegid.value, 2
		IF llOK
		   THISFORM.swrptlook1.txtBegId.VALUE = cvendorid
		   THISFORM.swrptlook1.txtBegName.VALUE = csortfield
		   THISFORM.swrptlook1.txtBegId.REFRESH()
		   THISFORM.swrptlook1.txtBegName.REFRESH()
		   THISFORM.swrptlook1.txtBegId.SETFOCUS()
		ENDIF
		
		THISFORM.setnextcontrol(THISFORM.swrptlook1.txtBegID)
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		
		lcList = 'cvendorid,csortfield'
		DO FORM ..\CUSTOM\picklist WITH 'vendor', lcList, thisform.swrptlook1.txtendid.value, 2
		IF llOK
		   THISFORM.swrptlook1.txtEndId.VALUE = cvendorid
		   THISFORM.swrptlook1.txtEndName.VALUE = csortfield
		   THISFORM.swrptlook1.txtEndId.REFRESH()
		   THISFORM.swrptlook1.txtEndName.REFRESH()
		   THISFORM.swrptlook1.txtEndId.SETFOCUS()
		ENDIF
		
		THISFORM.setnextcontrol(THISFORM.swrptlook1.txtEndID)
		
	ENDPROC

	PROCEDURE Swrptlook1.TxtBegID.Valid
		SELECT vendor
		SET ORDER TO cVendorID
		IF SEEK(THIS.VALUE)
		   THIS.PARENT.TxtBegName.SET('value',vendor.cSortField)
		ELSE
		   THIS.PARENT.TxtBegName.SET('value','')
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

	PROCEDURE Swrptlook1.TxtEndID.Valid
		SELECT vendor
		SET ORDER TO cVendorID
		IF SEEK(THIS.VALUE)
		   THIS.PARENT.TxtEndName.SET('value',vendor.cSortField)
		ELSE
		   THIS.PARENT.TxtEndName.SET('value','')
		ENDIF
		
		DODEFAULT()
		
	ENDPROC

ENDDEFINE
