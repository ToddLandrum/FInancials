*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="dmrprogrpt.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />

	AutoOpenTables = .F.
	DataSource = .NULL.
	Height = 200
	Left = 40
	Name = "Dataenvironment"
	Top = 235
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "programs", ;
		CursorSource = "programs", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "proghsth", ;
		CursorSource = "proghsth", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "proghstd", ;
		CursorSource = "proghstd", ;
		Database = ..\ampro\data\appdata.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		Top = 20, ;
		Width = 95
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS formdmrphist AS frmrptcriteria OF "..\source\appforms.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="LblBegID" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblAccDate" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Lbllabelcustom2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="swdate1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Swrptlook1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="swdate2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LblEndID" UniqueID="" Timestamp="" />

	Caption = "Program/Partnership Distributions"
	DoCreate = .T.
	Height = 248
	HelpContextID = 591
	Name = "FormDmrphist"
	Width = 354
	Swrptcriteriabuttons1.chkSendFile.Alignment = 0
	Swrptcriteriabuttons1.chkSendFile.Name = "chkSendFile"
	Swrptcriteriabuttons1.cmdclose.Name = "cmdclose"
	Swrptcriteriabuttons1.cmdPreview.Name = "cmdPreview"
	Swrptcriteriabuttons1.cmdPrint.Name = "cmdPrint"
	Swrptcriteriabuttons1.Left = 60
	Swrptcriteriabuttons1.Name = "Swrptcriteriabuttons1"
	Swrptcriteriabuttons1.TabIndex = 12
	Swrptcriteriabuttons1.Top = 175
	Swrptcriteriabuttons1.ZOrderSet = 0

	ADD OBJECT 'LblAccDate' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Distribution Date:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 17, ;
		Name = "LblAccDate", ;
		TabIndex = 9, ;
		Top = 27, ;
		Width = 83, ;
		ZOrderSet = 9
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblBegID' AS lbllabelcustom WITH ;
		Alignment = 1, ;
		AutoSize = .T., ;
		Caption = "First Program:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 31, ;
		Name = "LblBegID", ;
		TabIndex = 5, ;
		Top = 66, ;
		Width = 69, ;
		ZOrderSet = 8
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'LblEndID' AS lbllabelcustom WITH ;
		AutoSize = .T., ;
		Caption = "Last Program:", ;
		FontSize = 8, ;
		Height = 16, ;
		Left = 31, ;
		Name = "LblEndID", ;
		TabIndex = 6, ;
		Top = 117, ;
		Width = 69, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'Lbllabelcustom2' AS lbllabelcustom WITH ;
		Caption = "-", ;
		FontBold = .T., ;
		Height = 16, ;
		Left = 222, ;
		Name = "Lbllabelcustom2", ;
		TabIndex = 5, ;
		Top = 27, ;
		Width = 6
		*< END OBJECT: ClassLib="..\custom\ccontrol.vcx" BaseClass="label" />

	ADD OBJECT 'swdate1' AS dpk WITH ;
		ControlSource = "", ;
		Height = 20, ;
		Left = 115, ;
		Name = "swdate1", ;
		TabIndex = 9, ;
		Top = 25, ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\swdate.vcx" BaseClass="textbox" />

	ADD OBJECT 'swdate2' AS dpk WITH ;
		ControlSource = "", ;
		Height = 20, ;
		Left = 237, ;
		Name = "swdate2", ;
		TabIndex = 10, ;
		Top = 25, ;
		Width = 75
		*< END OBJECT: ClassLib="..\custom\swdate.vcx" BaseClass="textbox" />

	ADD OBJECT 'Swrptlook1' AS swrptlook WITH ;
		Left = 115, ;
		Name = "Swrptlook1", ;
		TabIndex = 11, ;
		Top = 63, ;
		ZOrderSet = 6, ;
		Swlookupbutton1.Name = "Swlookupbutton1", ;
		Swlookupbutton2.Name = "Swlookupbutton2", ;
		TxtBegID.clistexpression = programs.cProgCode, ;
		TxtBegID.clistworkarea = programs, ;
		TxtBegID.Name = "TxtBegID", ;
		TxtBegName.Name = "TxtBegName", ;
		TxtEndID.clistexpression = programs.cProgCode, ;
		TxtEndID.clistworkarea = programs, ;
		TxtEndID.Name = "TxtEndID", ;
		TxtEndName.Name = "TxtEndName"
		*< END OBJECT: ClassLib="..\custom\swcontrol.vcx" BaseClass="container" />
	
	PROCEDURE builddata
		LOCAL tcFirstProg, tcLastProg, tdDate1, tdDate2
		
		tcFirstProg = THISFORM.swrptlook1.txtBegID.VALUE
		tcLastProg  = THISFORM.swrptlook1.txtEndID.VALUE
		tdDate1     = THISFORM.swDate1.VALUE
		tdDate2     = THISFORM.swDate2.VALUE
		
		THISFORM.cReportName = 'dmrprogdist'
		THISFORM.cTitle1     = 'Program Distributions'
		THISFORM.cTitle2     = ''
		THISFORM.cSortOrder  = 'Program, Owner'
		THISFORM.cSelectCriteria = 'Programs: ' + ALLTRIM(tcFirstProg) + ' - ' + ALLTRIM(tcLastProg)
		THISFORM.cTitle2     = 'For Distribution Dates ' + DTOC(tdDate1) + ' - ' + DTOC(tdDate2)
		
		SELECT proghsth.dpostdate, ;
		   proghsth.cbatch, ;
		   investor.cownname AS cownname, ;
		   proghsth.creference, ;
		   proghstd.cownerid, ;
		   proghsth.cprogcode, ;
		   programs.cprogname, ;
		   proghstd.npercentage, ;
		   proghstd.namount ;
		   WHERE BETWEEN(proghsth.cprogcode,tcFirstProg,tcLastProg) ;
		   AND BETWEEN(proghsth.dpostdate,tdDate1,tdDate2) ;
		   AND proghsth.cprogcode = programs.cprogcode ;
		   AND proghstd.cownerid = investor.cownerid ;
		   AND proghsth.cbatch   = proghstd.cbatch ;
		   FROM proghsth, proghstd, programs, investor ;
		   INTO CURSOR progdist ;
		   ORDER BY proghsth.dpostdate, proghsth.cprogcode, proghstd.cownerid
		
		SELECT progdist
		IF RECC() > 0
		   RETURN .T.
		ELSE
		   RETURN .F.
		ENDIF
		
	ENDPROC

	PROCEDURE Init
		DODEFAULT()
		SELECT programs
		SET ORDER TO cprogcode
		GO TOP
		
		THISFORM.swrptlook1.txtBegName.VALUE = cprogname
		THISFORM.swrptlook1.txtBegID.VALUE = cprogcode
		GO BOTTOM
		
		THISFORM.swrptlook1.txtEndName.VALUE = cprogname
		THISFORM.swrptlook1.txtEndID.VALUE = cprogcode
		
		SELECT MIN(dPostDate) AS dMinPost FROM proghsth INTO CURSOR mindate 
		SELECT MAX(dPostDate) AS dMaxPost FROM proghsth INTO CURSOR maxdate 
		
		thisform.swdate1.setvalue(mindate.dminpost)
		thisform.swdate2.setvalue(maxdate.dmaxpost)
		
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton1.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cprogcode,cprogname/progname'
		DO FORM ..\custom\picklist WITH 'Programs', lcList, thisform.swrptlook1.txtbegid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtBegId.value = cprogcode
		   thisform.swrptlook1.txtBegName.value = cprogname
		   thisform.swrptlook1.txtBegId.refresh()
		   thisform.swrptlook1.txtBegName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(thisform.swrptlook1.txtBegId)
		
	ENDPROC

	PROCEDURE Swrptlook1.Swlookupbutton2.Click
		LOCAL lcList
		PRIV llOK
		
		llOK = .F.
		lcList = 'cprogcode,cprogname/progname'
		DO FORM ..\custom\picklist WITH 'Programs', lcList, thisform.swrptlook1.txtendid.value, 2
		
		IF llOK
		   thisform.swrptlook1.txtEndId.value = cprogcode
		   thisform.swrptlook1.txtEndName.value = cprogname
		   thisform.swrptlook1.txtEndId.refresh()
		   thisform.swrptlook1.txtEndName.refresh()
		ENDIF   
		
		thisform.setnextcontrol(thisform.swrptlook1.txtEndId)
		
	ENDPROC

ENDDEFINE
